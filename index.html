<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WANG WEIZE | Imperial Mandarin Supremacy - ULTIMATE EDITION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@700;900&family=Playfair+Display:wght@900&family=Cormorant+Garamond:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --imperial-red: #C41E3A; 
            --emperor-gold: #FFD700; 
            --rice-paper: #FDF6E3; 
            --dark-emperor: #1a0f0a;
            --dark-gold: #b8860b;
        }
        
        body { 
            background-color: var(--rice-paper); 
            color: #1a1a1a; 
            font-family: 'Noto Serif SC', serif; 
            background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png'); 
            overflow-x: hidden; 
            padding-bottom: 120px;
            transition: all 0.3s;
        }
        
        body.dark-mode {
            background-color: var(--dark-emperor);
            color: #f5f5f5;
            background-image: url('https://www.transparenttextures.com/patterns/dark-wood.png');
        }
        
        .dark-mode .glass-scroll,
        .dark-mode .learning-container,
        .dark-mode .profil-container {
            background: rgba(26, 15, 10, 0.95);
            color: #f5f5f5;
            border-color: var(--dark-gold);
        }
        
        .dark-mode .vocab-card,
        .dark-mode .stat-card,
        .dark-mode .quiz-option {
            background: rgba(40, 30, 20, 0.9);
            color: #f5f5f5;
            border-color: var(--dark-gold);
        }
        
        .dark-mode .nav-bottom {
            background: rgba(26, 15, 10, 0.98);
            border-color: var(--dark-gold);
        }
        
        .emperor-name { 
            font-family: 'Playfair Display', serif; 
            font-size: clamp(3rem, 8vw, 6.5rem); 
            font-weight: 900; 
            color: #ffffff; 
            -webkit-text-stroke: 2.5px var(--imperial-red);
            text-shadow: 4px 4px 0 var(--emperor-gold), 8px 8px 20px rgba(0,0,0,0.5); 
            letter-spacing: 6px; 
            display: inline-block; 
            line-height: 1.2;
            padding: 15px;
            filter: drop-shadow(0 5px 15px rgba(196,30,58,0.4));
        }

        .glass-scroll { 
            background: rgba(253, 246, 227, 0.95); 
            backdrop-filter: blur(10px); 
            border: 3px solid var(--imperial-red); 
            border-radius: 12px; 
            transition: 0.5s; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        }
        
        .hidden-tab { display: none !important; }
        .active-nav { 
            background: var(--imperial-red) !important; 
            color: var(--emperor-gold) !important; 
            transform: scale(1.05); 
            box-shadow: 0 -5px 15px rgba(196,30,58,0.5); 
        }
        
        .canvas-box { 
            position: relative; 
            width: 360px; 
            height: 360px; 
            margin: 0 auto; 
            background: #fff; 
            border: 6px double var(--imperial-red); 
            border-radius: 10px; 
        }
        
        canvas { touch-action: none; cursor: crosshair; position: absolute; top: 0; left: 0; }
        
        .imperial-particle { 
            position: fixed; 
            top: -10px; 
            pointer-events: none; 
            z-index: 0; 
            opacity: 0.15; 
            animation: fall linear infinite; 
            font-size: 24px; 
            color: var(--emperor-gold); 
        }
        
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }

        .vocab-card { 
            background: white; 
            border: 2px solid var(--imperial-red); 
            border-radius: 16px; 
            padding: 20px; 
            box-shadow: 6px 6px 0 var(--imperial-red); 
            transition: 0.3s; 
            position: relative; 
            overflow: hidden; 
        }
        
        .vocab-card:hover { 
            transform: translateY(-5px); 
            border-color: var(--emperor-gold); 
            box-shadow: 8px 8px 0 var(--emperor-gold); 
        }
        
        .vocab-hanzi { 
            font-size: 42px; 
            font-family: 'Ma Shan Zheng', cursive; 
            color: var(--imperial-red); 
            text-shadow: 1px 1px 0 var(--emperor-gold); 
        }
        
        .vocab-btn { 
            width: 42px; 
            height: 42px; 
            border-radius: 50%; 
            border: 2px solid var(--imperial-red); 
            background: var(--emperor-gold); 
            color: var(--imperial-red); 
            transition: 0.2s; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 20px; 
            cursor: pointer; 
        }
        
        .vocab-btn:hover { 
            background: var(--imperial-red); 
            color: var(--emperor-gold); 
            transform: scale(1.1); 
        }
        
        .profil-container { 
            background: linear-gradient(145deg, #faf3e0, #f5e6d3); 
            border: 3px solid var(--imperial-red); 
            border-radius: 40px; 
            box-shadow: 20px 20px 0 rgba(196,30,58,0.3); 
            padding: 40px; 
            position: relative; 
            overflow: hidden; 
        }
        
        .kartu-generasi { 
            background: rgba(255,255,255,0.8); 
            border: 2px solid var(--imperial-red); 
            border-radius: 20px; 
            padding: 20px; 
            width: 220px; 
            box-shadow: 8px 8px 0 var(--imperial-red); 
        }

        .learning-container { 
            background: white; 
            border-radius: 20px; 
            padding: 30px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.1); 
        }
        
        .search-wrapper { margin: 20px 0; }
        .search-wrapper input { 
            width: 100%; 
            padding: 15px 20px; 
            border: 3px solid var(--imperial-red); 
            border-radius: 50px; 
            font-size: 16px; 
            font-weight: bold; 
            outline: none; 
            transition: 0.3s; 
        }
        
        .search-wrapper input:focus { 
            border-color: var(--emperor-gold); 
            box-shadow: 0 0 20px rgba(255,215,0,0.3); 
        }
        
        .vocab-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 20px; 
            margin-top: 30px; 
        }

        .progress-bar { 
            height: 30px; 
            background: linear-gradient(90deg, var(--emperor-gold), var(--imperial-red)); 
            border-radius: 15px; 
            transition: width 0.5s; 
            box-shadow: 0 3px 10px rgba(0,0,0,0.2); 
        }
        
        .stat-card { 
            background: linear-gradient(135deg, #fff 0%, #f8f8f8 100%); 
            border: 2px solid var(--imperial-red); 
            border-radius: 15px; 
            padding: 20px; 
            text-align: center; 
        }
        
        .ai-suggestion { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 15px; 
            border-radius: 10px; 
            margin: 10px 0; 
            animation: pulse 2s infinite; 
        }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        
        .badge { 
            display: inline-block; 
            background: var(--emperor-gold); 
            color: var(--imperial-red); 
            padding: 5px 15px; 
            border-radius: 20px; 
            font-weight: bold; 
            margin: 5px; 
            box-shadow: 0 3px 10px rgba(0,0,0,0.2); 
        }
        
        .level-badge { 
            font-size: 24px; 
            font-weight: 900; 
            color: var(--emperor-gold); 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3); 
        }
        
        .flashcard { perspective: 1000px; height: 300px; cursor: pointer; }
        .flashcard-inner { 
            position: relative; 
            width: 100%; 
            height: 100%; 
            transition: transform 0.6s; 
            transform-style: preserve-3d; 
        }
        
        .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            backface-visibility: hidden; 
            border-radius: 15px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 48px; 
            font-weight: bold; 
        }
        
        .flashcard-front { 
            background: linear-gradient(135deg, var(--imperial-red), #8B0000); 
            color: white; 
        }
        
        .flashcard-back { 
            background: linear-gradient(135deg, var(--emperor-gold), #DAA520); 
            color: var(--imperial-red); 
            transform: rotateY(180deg); 
        }
        
        .quiz-option { 
            background: white; 
            border: 3px solid var(--imperial-red); 
            padding: 15px; 
            border-radius: 10px; 
            cursor: pointer; 
            transition: 0.3s; 
            margin: 10px 0; 
        }
        
        .quiz-option:hover { 
            background: var(--rice-paper); 
            transform: translateX(10px); 
        }
        
        .quiz-option.correct { background: #4ade80; border-color: #16a34a; }
        .quiz-option.wrong { background: #f87171; border-color: #dc2626; }
        
        .tone-visual { 
            height: 120px; 
            background: linear-gradient(to top, #e0e0e0, white); 
            border-radius: 10px; 
            position: relative; 
            overflow: hidden; 
            margin: 20px 0; 
            border: 3px solid var(--imperial-red); 
        }
        
        .tone-line { 
            position: absolute; 
            left: 0; 
            width: 100%; 
            height: 4px; 
            background: var(--imperial-red); 
            transition: all 0.3s; 
        }
        
        .difficulty-btn { 
            padding: 10px 20px; 
            margin: 5px; 
            border-radius: 20px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: 0.3s; 
            border: 2px solid var(--imperial-red); 
        }
        
        .difficulty-btn.active { background: var(--imperial-red); color: white; }
        .difficulty-btn.easy { background: #86efac; }
        .difficulty-btn.medium { background: #fcd34d; }
        .difficulty-btn.hard { background: #fca5a5; }

        .study-timer { 
            font-size: 36px; 
            font-weight: 900; 
            color: var(--imperial-red); 
        }
        
        .chatbot-container { max-width: 800px; margin: 0 auto; }
        .chat-message { 
            padding: 15px; 
            border-radius: 15px; 
            margin: 10px 0; 
            max-width: 80%; 
        }
        
        .chat-user { 
            background: var(--imperial-red); 
            color: white; 
            margin-left: auto; 
        }
        
        .chat-bot { 
            background: var(--emperor-gold); 
            color: var(--imperial-red); 
        }

        .ai-image-container { 
            width: 100%; 
            height: 200px; 
            border-radius: 10px; 
            overflow: hidden; 
            margin: 10px 0; 
            position: relative; 
            background: #f0f0f0; 
        }
        
        .ai-image-container img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }
        
        .loading-spinner { 
            border: 4px solid #f3f3f3; 
            border-top: 4px solid var(--imperial-red); 
            border-radius: 50%; 
            width: 40px; 
            height: 40px; 
            animation: spin 1s linear infinite; 
            margin: 80px auto; 
        }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .character-detail { 
            background: rgba(255,255,255,0.9); 
            border: 2px solid var(--emperor-gold); 
            border-radius: 10px; 
            padding: 15px; 
            margin: 10px 0; 
        }
        
        .streak-calendar { 
            display: grid; 
            grid-template-columns: repeat(7, 1fr); 
            gap: 5px; 
            margin: 20px 0; 
        }
        
        .streak-day { 
            width: 100%; 
            aspect-ratio: 1; 
            border-radius: 5px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 12px; 
            font-weight: bold; 
        }
        
        .streak-complete { 
            background: var(--emperor-gold); 
            color: var(--imperial-red); 
        }
        
        .streak-incomplete { 
            background: #e5e5e5; 
            color: #999; 
        }
        
        .streak-today { 
            border: 3px solid var(--imperial-red); 
        }

        .achievement-badge { 
            display: inline-block; 
            padding: 10px 20px; 
            margin: 10px; 
            background: linear-gradient(135deg, var(--emperor-gold), #DAA520); 
            border-radius: 20px; 
            border: 2px solid var(--imperial-red); 
            font-weight: bold; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
        }
        
        .achievement-locked { 
            opacity: 0.3; 
            filter: grayscale(100%); 
        }

        .tone-option { 
            padding: 20px; 
            margin: 10px; 
            border: 3px solid var(--imperial-red); 
            border-radius: 15px; 
            cursor: pointer; 
            font-size: 24px; 
            font-weight: bold; 
            transition: 0.3s; 
            background: white; 
        }
        
        .tone-option:hover { 
            background: var(--rice-paper); 
            transform: scale(1.05); 
        }
        
        .tone-correct { 
            background: #86efac !important; 
            border-color: #16a34a !important; 
        }
        
        .tone-wrong { 
            background: #fca5a5 !important; 
            border-color: #dc2626 !important; 
        }

        .export-btn { 
            background: linear-gradient(135deg, #667eea, #764ba2); 
            color: white; 
            padding: 15px 30px; 
            border-radius: 10px; 
            font-weight: bold; 
            cursor: pointer; 
            margin: 10px; 
            border: none; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
            transition: 0.3s; 
        }
        
        .export-btn:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 8px 20px rgba(0,0,0,0.3); 
        }

        .nav-bottom { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            background: rgba(253, 246, 227, 0.98); 
            backdrop-filter: blur(10px); 
            border-top: 4px solid var(--imperial-red); 
            display: flex; 
            justify-content: space-around; 
            padding: 10px 5px; 
            z-index: 1000; 
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1); 
            overflow-x: auto;
        }
        
        .nav-btn { 
            flex: 1; 
            min-width: 70px;
            padding: 8px 4px; 
            text-align: center; 
            border-radius: 12px; 
            cursor: pointer; 
            transition: 0.3s; 
            font-weight: bold; 
            font-size: 11px; 
            margin: 0 3px; 
            background: white; 
            border: 2px solid var(--imperial-red); 
        }

        .garis-emas { 
            height: 4px; 
            background: linear-gradient(90deg, transparent, var(--emperor-gold), transparent); 
        }
        
        /* Voice Recognition Feedback */
        .voice-feedback {
            padding: 20px;
            border-radius: 15px;
            margin: 10px 0;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            animation: popIn 0.3s;
        }
        
        .voice-cuan {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
            border: 3px solid #16a34a;
        }
        
        .voice-boncos {
            background: linear-gradient(135deg, #f87171, #ef4444);
            color: white;
            border: 3px solid #dc2626;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Digital ID Card */
        .digital-id-card {
            background: linear-gradient(145deg, #1a0f0a, #2d1810);
            border: 5px solid var(--emperor-gold);
            border-radius: 20px;
            padding: 30px;
            color: var(--emperor-gold);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5),
                        inset 0 0 50px rgba(255,215,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .digital-id-card::before {
            content: 'Èæç';
            position: absolute;
            font-size: 200px;
            opacity: 0.05;
            right: -20px;
            top: -40px;
            font-family: 'Ma Shan Zheng', cursive;
        }
        
        .id-hologram {
            background: linear-gradient(45deg, 
                transparent 25%, 
                rgba(255,215,0,0.2) 25%, 
                rgba(255,215,0,0.2) 50%, 
                transparent 50%, 
                transparent 75%, 
                rgba(255,215,0,0.2) 75%);
            background-size: 10px 10px;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.3;
            pointer-events: none;
        }
        
        .rank-badge-display {
            display: inline-block;
            padding: 10px 25px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #1a0f0a;
            border-radius: 25px;
            font-weight: 900;
            font-size: 20px;
            text-transform: uppercase;
            box-shadow: 0 5px 20px rgba(255,215,0,0.5);
            letter-spacing: 2px;
        }
        
        /* Matching Game */
        .matching-game-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin: 20px 0;
        }
        
        .matching-column {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .matching-card {
            padding: 20px;
            background: white;
            border: 3px solid var(--imperial-red);
            border-radius: 15px;
            cursor: move;
            transition: 0.3s;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
        }
        
        .matching-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .matching-card.matched {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
            border-color: #16a34a;
            cursor: default;
        }
        
        .matching-card.selected {
            background: var(--emperor-gold);
            border-color: var(--imperial-red);
            transform: scale(1.1);
        }
        
        .matching-card.wrong {
            background: #fca5a5;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        /* HSK Filter Buttons */
        .hsk-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .hsk-btn {
            padding: 12px 24px;
            border-radius: 25px;
            border: 3px solid var(--imperial-red);
            background: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .hsk-btn:hover {
            background: var(--rice-paper);
            transform: translateY(-2px);
        }
        
        .hsk-btn.active {
            background: var(--imperial-red);
            color: var(--emperor-gold);
        }
        
        .hsk-btn.hsk-1 { border-color: #86efac; }
        .hsk-btn.hsk-2 { border-color: #fcd34d; }
        .hsk-btn.hsk-3 { border-color: #fca5a5; }
        .hsk-btn.hsk-4 { border-color: #c084fc; }
        .hsk-btn.hsk-5 { border-color: #60a5fa; }
        .hsk-btn.hsk-6 { border-color: #f472b6; }
        
        /* Dark Mode Toggle */
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--imperial-red), var(--emperor-gold));
            border: 3px solid var(--emperor-gold);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: 0.3s;
        }
        
        .dark-mode-toggle:hover {
            transform: rotate(180deg) scale(1.1);
        }
        
        /* Stroke Score Display */
        .stroke-score-display {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
        }
        
        .stroke-score-number {
            font-size: 72px;
            font-weight: 900;
            color: var(--emperor-gold);
            text-shadow: 3px 3px 0 rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <!-- Dark Mode Toggle -->
    <div class="dark-mode-toggle" onclick="toggleDarkMode()" title="Emperor Night Mode">
        <span id="darkModeIcon">üåô</span>
    </div>

    <!-- Imperial Particles -->
    <div id="particleContainer"></div>

    <!-- Header -->
    <div class="text-center py-10">
        <div class="emperor-name">Áéã‰∏∫Ê≥Ω</div>
        <p class="text-xl font-black text-red-900 mt-4">IMPERIAL MANDARIN SUPREMACY</p>
        <p class="text-sm font-bold text-gray-600">ULTIMATE FUSION EDITION - Powered by Advanced AI</p>
    </div>

    <!-- HOME TAB -->
    <div id="home" class="tab-content px-4">
        <div class="profil-container">
            <h2 class="text-4xl font-black text-red-900 mb-8 text-center">üèÜ DASHBOARD SULTAN</h2>
            
            <!-- XP & Level System -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="stat-card">
                    <div class="text-6xl font-black text-red-900" id="userLevel">1</div>
                    <div class="level-badge">LEVEL</div>
                    <div class="mt-4">
                        <div class="bg-gray-200 h-4 rounded-full">
                            <div id="levelProgress" class="progress-bar" style="width: 0%"></div>
                        </div>
                        <div class="text-xs mt-2"><span id="currentXP">0</span> / <span id="nextLevelXP">100</span> XP</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="text-6xl font-black text-yellow-600" id="totalWords">0</div>
                    <div class="font-bold text-gray-700">Kata Dikuasai</div>
                </div>
                <div class="stat-card">
                    <div class="text-6xl font-black text-green-600" id="streakDays">0</div>
                    <div class="font-bold text-gray-700">üî• Streak Hari</div>
                </div>
            </div>

            <!-- Digital ID Card Generator -->
            <div class="mb-8">
                <button onclick="generateDigitalID()" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-2xl font-black text-xl shadow-lg hover:scale-105 transition">
                    üé´ GENERATE KARTU ID SULTAN
                </button>
                <div id="digitalIDContainer" class="mt-6"></div>
            </div>

            <!-- Study Streak Calendar -->
            <div class="bg-white/70 p-6 rounded-2xl border-2 border-yellow-600 mb-8">
                <h3 class="font-black text-red-800 mb-4">üìÖ KALENDER BELAJAR (30 Hari Terakhir)</h3>
                <div id="streakCalendar" class="streak-calendar"></div>
            </div>

            <!-- Achievements -->
            <div class="bg-white/70 p-6 rounded-2xl border-2 border-yellow-600 mb-8">
                <h3 class="font-black text-red-800 mb-4">üèÖ PENCAPAIAN (<span id="achievementCount">0</span>/12)</h3>
                <div id="achievementsList" class="text-center"></div>
            </div>

            <!-- Data Export/Import -->
            <div class="bg-white/70 p-6 rounded-2xl border-2 border-yellow-600 mb-8">
                <h3 class="font-black text-red-800 mb-4">üíæ KELOLA DATA</h3>
                <div class="text-center">
                    <button onclick="exportData()" class="export-btn">üì• EXPORT DATA</button>
                    <button onclick="document.getElementById('importFile').click()" class="export-btn">üì§ IMPORT DATA</button>
                    <button onclick="resetAllData()" class="export-btn" style="background: linear-gradient(135deg, #dc2626, #991b1b);">üóëÔ∏è RESET SEMUA</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
            </div>

            <div class="bg-white/50 p-6 rounded-2xl border-2 border-yellow-600">
                <h3 class="font-black text-red-800 mb-4">HUBUNGI SANG SULTAN:</h3>
                <div class="flex flex-wrap justify-center gap-4">
                    <a href="https://wa.me/6288277200044" target="_blank" class="bg-green-600 text-white px-6 py-3 rounded-xl font-black shadow-lg hover:scale-105 transition">üì± WhatsApp</a>
                    <a href="https://www.tiktok.com/@wangweize10" target="_blank" class="bg-black text-white px-6 py-3 rounded-xl font-black shadow-lg hover:scale-105 transition">üéµ TikTok</a>
                </div>
            </div>
        </div>
    </div>

    <!-- SILSILAH TAB -->
    <div id="silsilah" class="tab-content hidden-tab px-4">
        <div class="profil-container p-10 text-center">
            <h2 class="text-4xl font-black text-red-900 mb-10" style="font-family: 'Playfair Display';">üëë SILSILAH KELUARGA üëë</h2>
            <div class="flex flex-wrap justify-center gap-8">
                <div class="kartu-generasi">
                    <p class="text-red-900 font-black border-b border-yellow-500 mb-2">GENERASI 2</p>
                    <p class="text-sm font-bold">Ayah: Wang (Shaanxi ÈôïË•ø)<br>Ibu: Huang (Medan Hokkian)</p>
                </div>
                <div class="kartu-generasi" style="border-color: #D4AF37; background: #fffdf0;">
                    <p class="text-red-900 font-black border-b border-yellow-500 mb-2">GENERASI 3</p>
                    <p class="text-xl font-black text-red-600">Ê±™‰∏∫Ê≥Ω (WANG WEIZE)</p>
                    <p class="text-xs font-bold text-gray-500">Satu-satunya Ê±™ di Medan</p>
                </div>
            </div>
            <div class="garis-emas my-10"></div>
            <p class="italic text-gray-600 font-serif">"Darah Shaanxi mengalir, jiwa Medan merajut. Keras bos! üî•"</p>
        </div>
    </div>

    <!-- TULIS (CANVAS) TAB with STROKE ANALYSIS -->
    <div id="tulis" class="tab-content hidden-tab text-center px-4">
        <div class="glass-scroll p-8">
            <h2 class="text-3xl font-black text-red-900 mb-4">üñåÔ∏è PAPAN TULIS SULTAN + AI STROKE ANALYSIS</h2>
            
            <!-- Stroke Score Display -->
            <div id="strokeScoreDisplay" class="stroke-score-display hidden">
                <div class="stroke-score-number" id="strokeScore">0</div>
                <div class="font-bold text-xl">SKOR AKURASI AI</div>
                <div id="strokeFeedback" class="text-lg mt-2"></div>
            </div>
            
            <div class="flex flex-wrap justify-center gap-2 mb-6">
                <button onclick="setPractice('Ê±™')" class="px-4 py-2 bg-red-900 text-white font-black rounded hover:bg-yellow-500">Marga Ê±™</button>
                <button onclick="setPractice('Ëµö')" class="px-4 py-2 bg-red-900 text-white font-black rounded hover:bg-yellow-500">Cuan Ëµö</button>
                <button onclick="setPractice('‰Ω†Â•Ω')" class="px-4 py-2 bg-red-900 text-white font-black rounded hover:bg-yellow-500">Halo ‰Ω†Â•Ω</button>
                <button onclick="setPractice('Ë∞¢Ë∞¢')" class="px-4 py-2 bg-red-900 text-white font-black rounded hover:bg-yellow-500">Terima kasih Ë∞¢Ë∞¢</button>
                <button onclick="setPractice('Èæô')" class="px-4 py-2 bg-red-900 text-white font-black rounded hover:bg-yellow-500">Naga Èæô</button>
                <button onclick="setPractice('')" class="px-4 py-2 bg-gray-800 text-white font-black rounded">Hapus Grid</button>
            </div>
            
            <div class="canvas-box">
                <canvas id="gridCanvas" width="360" height="360"></canvas>
                <canvas id="drawCanvas" width="360" height="360"></canvas>
            </div>
            
            <div class="mt-6 flex justify-center gap-4 flex-wrap">
                <button onclick="clearDraw()" class="bg-red-900 text-white px-8 py-2 rounded-lg font-black shadow-lg">BERSIHKAN</button>
                <button onclick="analyzeStrokeAI()" class="bg-purple-600 text-white px-8 py-2 rounded-lg font-black shadow-lg">ü§ñ ANALISIS AI</button>
                <button onclick="saveWriting()" class="bg-green-600 text-white px-8 py-2 rounded-lg font-black shadow-lg">üíæ SIMPAN</button>
            </div>
        </div>
    </div>

    <!-- KAMUS TAB with HSK FILTER & VOICE RECOGNITION -->
    <div id="kamus" class="tab-content hidden-tab px-4">
        <div class="learning-container">
            <h2 class="text-3xl font-black text-center text-red-900 mb-4">üìñ KAMUS MANDARIN + VOICE CHECK</h2>
            
            <!-- Real Dictionary Lookup -->
            <div class="bg-gradient-to-r from-purple-500 to-indigo-600 p-6 rounded-2xl text-white mb-6">
                <h3 class="font-black text-2xl mb-4">üîç ANALISIS KARAKTER DETAIL (LIVE API)</h3>
                <input type="text" id="charLookup" placeholder="Ketik 1 karakter Mandarin..." maxlength="1" 
                    class="w-full p-4 rounded-lg text-gray-900 font-bold text-2xl text-center mb-4" 
                    oninput="lookupCharacter(this.value)">
                <div id="charDetails" class="bg-white/20 backdrop-blur-lg rounded-lg p-4 min-h-[100px]">
                    <p class="text-center">Ketik karakter untuk melihat detail lengkap...</p>
                </div>
            </div>

            <!-- HSK Filter -->
            <div class="hsk-filter">
                <button onclick="filterHSK('all')" class="hsk-btn active" id="hsk-all">Semua HSK</button>
                <button onclick="filterHSK('1')" class="hsk-btn hsk-1" id="hsk-1">HSK 1</button>
                <button onclick="filterHSK('2')" class="hsk-btn hsk-2" id="hsk-2">HSK 2</button>
                <button onclick="filterHSK('3')" class="hsk-btn hsk-3" id="hsk-3">HSK 3</button>
                <button onclick="filterHSK('4')" class="hsk-btn hsk-4" id="hsk-4">HSK 4</button>
                <button onclick="filterHSK('5')" class="hsk-btn hsk-5" id="hsk-5">HSK 5</button>
                <button onclick="filterHSK('6')" class="hsk-btn hsk-6" id="hsk-6">HSK 6</button>
            </div>
            
            <div class="search-wrapper">
                <input type="text" id="searchInput" placeholder="üîç Cari kata (makan, ÂêÉ, chi)..." onkeyup="searchVocab()">
            </div>
            
            <!-- AI Suggestion -->
            <div class="ai-suggestion">
                <div class="font-bold mb-2">ü§ñ AI Recommendation:</div>
                <div id="aiSuggestion">Loading saran...</div>
            </div>
            
            <div id="vocabGrid" class="vocab-grid"></div>
        </div>
    </div>

    <!-- FLASHCARD TAB -->
    <div id="flashcard" class="tab-content hidden-tab px-4">
        <div class="learning-container">
            <h2 class="text-3xl font-black text-center text-red-900 mb-8">üé¥ SMART FLASHCARD SYSTEM</h2>
            
            <div class="text-center mb-6">
                <div class="study-timer" id="flashcardTimer">00:00</div>
                <div class="text-sm text-gray-600">Waktu Belajar Hari Ini</div>
            </div>
            
            <div id="flashcardContainer" class="max-w-md mx-auto">
                <div class="flashcard" id="currentFlashcard" onclick="flipCard()">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <div id="flashcardFront">‰Ω†Â•Ω</div>
                        </div>
                        <div class="flashcard-back">
                            <div id="flashcardBack">Halo</div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 flex justify-center gap-4">
                    <button onclick="rateCard('easy')" class="bg-green-500 text-white px-6 py-3 rounded-lg font-bold">üòä Mudah</button>
                    <button onclick="rateCard('medium')" class="bg-yellow-500 text-white px-6 py-3 rounded-lg font-bold">ü§î Sedang</button>
                    <button onclick="rateCard('hard')" class="bg-red-500 text-white px-6 py-3 rounded-lg font-bold">üò∞ Sulit</button>
                </div>
                
                <div class="mt-4 text-center">
                    <div class="text-sm text-gray-600">Card <span id="cardProgress">1/20</span></div>
                    <div class="bg-gray-200 h-2 rounded-full mt-2">
                        <div id="cardProgressBar" class="progress-bar" style="width: 5%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QUIZ TAB -->
    <div id="quiz" class="tab-content hidden-tab px-4">
        <div class="learning-container">
            <h2 class="text-3xl font-black text-center text-red-900 mb-8">üéØ QUIZ INTERAKTIF</h2>
            
            <div class="max-w-2xl mx-auto">
                <div class="mb-6 text-center">
                    <button onclick="startQuiz('translation')" class="px-6 py-3 bg-blue-600 text-white font-bold rounded-lg m-2">Terjemahan</button>
                    <button onclick="startQuiz('pinyin')" class="px-6 py-3 bg-green-600 text-white font-bold rounded-lg m-2">Pinyin</button>
                    <button onclick="startQuiz('mixed')" class="px-6 py-3 bg-red-600 text-white font-bold rounded-lg m-2">Campur</button>
                </div>
                
                <div id="quizContainer" class="bg-white p-8 rounded-xl border-3 border-red-900 shadow-xl">
                    <div class="mb-6">
                        <div class="flex justify-between mb-2">
                            <span class="font-bold">Pertanyaan <span id="quizNumber">1</span>/10</span>
                            <span class="font-bold">Skor: <span id="quizScore">0</span></span>
                        </div>
                        <div class="bg-gray-200 h-2 rounded-full">
                            <div id="quizProgressBar" class="progress-bar" style="width: 10%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <div class="text-4xl font-black text-center mb-4 text-red-900" id="quizQuestion">Klik tombol di atas untuk memulai!</div>
                        <div class="text-center text-sm text-gray-600" id="quizHint">Pilih tipe quiz</div>
                    </div>
                    
                    <div id="quizOptions"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- MATCHING GAME TAB -->
    <div id="game" class="tab-content hidden-tab px-4">
        <div class="learning-container">
            <h2 class="text-3xl font-black text-center text-red-900 mb-8">üéÆ MATCHING GAME - COCOK KATA</h2>
            
            <div class="text-center mb-6">
                <div class="text-2xl font-bold mb-2">Skor: <span id="gameScore" class="text-red-900">0</span></div>
                <div class="text-sm text-gray-600">Cocokkan karakter Mandarin dengan artinya!</div>
                <button onclick="startMatchingGame()" class="mt-4 bg-green-600 text-white px-8 py-3 rounded-xl font-black shadow-lg hover:scale-105 transition">
                    üéØ MULAI GAME BARU
                </button>
            </div>
            
            <div class="matching-game-container" id="matchingGameContainer">
                <!-- Game will be populated here -->
            </div>
            
            <div id="gameResult" class="text-center mt-6 hidden">
                <div class="text-4xl mb-4">üéâ</div>
                <div class="text-2xl font-black text-green-600 mb-4">SELAMAT! SEMUA BENAR!</div>
                <div class="text-xl">Total Skor: <span id="finalGameScore">0</span></div>
            </div>
        </div>
    </div>

    <!-- TONE TRAINER TAB -->
    <div id="tone" class="tab-content hidden-tab px-4">
        <div class="learning-container">
            <h2 class="text-3xl font-black text-center text-red-900 mb-8">üéôÔ∏è TONE TRAINER - MINI GAME</h2>
            
            <div class="max-w-2xl mx-auto">
                <div class="bg-gradient-to-r from-red-600 to-yellow-500 p-8 rounded-2xl text-white text-center mb-8">
                    <h3 class="text-2xl font-black mb-4">Skor: <span id="toneScore">0</span></h3>
                    <div class="text-lg">Level: <span id="toneLevel">1</span></div>
                </div>

                <div class="tone-visual mb-8">
                    <div id="toneLine1" class="tone-line" style="top: 20%;"></div>
                    <div id="toneLine2" class="tone-line" style="top: 40%;"></div>
                    <div id="toneLine3" class="tone-line" style="top: 60%;"></div>
                    <div id="toneLine4" class="tone-line" style="top: 80%;"></div>
                </div>

                <div class="text-center mb-6">
                    <button onclick="startToneGame()" class="bg-green-600 text-white px-8 py-4 rounded-xl font-black text-xl shadow-lg hover:scale-105 transition">
                        üéÆ MULAI GAME
                    </button>
                </div>

                <div id="toneGameContainer" class="hidden">
                    <div class="bg-white p-6 rounded-xl border-4 border-red-900 mb-6 text-center">
                        <div class="text-6xl font-black text-red-900 mb-4" id="toneCharacter">mƒÅ</div>
                        <div class="text-sm text-gray-600 mb-4">Dengarkan nada dan pilih yang benar!</div>
                        <button onclick="playCurrentTone()" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold">üîä DENGAR LAGI</button>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="tone-option" onclick="checkTone(1)">
                            <div class="text-4xl mb-2">‰∏ÄÂ£∞</div>
                            <div class="text-sm text-gray-600">Nada Datar (ƒÅ)</div>
                        </div>
                        <div class="tone-option" onclick="checkTone(2)">
                            <div class="text-4xl mb-2">‰∫åÂ£∞</div>
                            <div class="text-sm text-gray-600">Nada Naik (√°)</div>
                        </div>
                        <div class="tone-option" onclick="checkTone(3)">
                            <div class="text-4xl mb-2">‰∏âÂ£∞</div>
                            <div class="text-sm text-gray-600">Nada Turun Naik («é)</div>
                        </div>
                        <div class="tone-option" onclick="checkTone(4)">
                            <div class="text-4xl mb-2">ÂõõÂ£∞</div>
                            <div class="text-sm text-gray-600">Nada Turun (√†)</div>
                        </div>
                    </div>

                    <div id="toneFeedback" class="mt-6 text-center text-xl font-bold"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- CHATBOT TAB -->
    <div id="chatbot" class="tab-content hidden-tab px-4">
        <div class="learning-container">
            <h2 class="text-3xl font-black text-center text-red-900 mb-8">ü§ñ ASISTEN BELAJAR PINTAR (OFFLINE)</h2>
            
            <div class="chatbot-container">
                <div id="chatMessages" class="bg-gray-50 rounded-xl p-6 h-96 overflow-y-auto mb-4 border-2 border-red-900">
                    <div class="chat-message chat-bot">
                        ‰Ω†Â•Ω! Saya asisten belajar Mandarin Anda. Tanya apa saja tentang bahasa Mandarin, grammar, budaya China, atau minta saya menjelaskan kata-kata! üòä
                    </div>
                </div>
                
                <div class="flex gap-2">
                    <input type="text" id="chatInput" placeholder="Tanya sesuatu..." 
                        class="flex-1 p-4 border-3 border-red-900 rounded-lg font-bold"
                        onkeypress="if(event.key==='Enter') sendChat()">
                    <button onclick="sendChat()" class="bg-red-900 text-white px-8 py-4 rounded-lg font-black">KIRIM</button>
                </div>

                <div class="mt-4 flex flex-wrap gap-2 justify-center">
                    <button onclick="quickChat('Apa bedanya ÁöÑ, Âæó, Âú∞?')" class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm">ÁöÑÂæóÂú∞?</button>
                    <button onclick="quickChat('Jelaskan sistem nada Mandarin')" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm">Sistem Nada</button>
                    <button onclick="quickChat('Apa itu HSK?')" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm">HSK?</button>
                    <button onclick="quickChat('Tips belajar Mandarin')" class="bg-yellow-600 text-white px-4 py-2 rounded-lg text-sm">Tips Belajar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="nav-bottom">
        <div class="nav-btn active-nav" onclick="switchTab('home')">üè†<br>Home</div>
        <div class="nav-btn" onclick="switchTab('silsilah')">üëë<br>Silsilah</div>
        <div class="nav-btn" onclick="switchTab('tulis')">‚úçÔ∏è<br>Tulis</div>
        <div class="nav-btn" onclick="switchTab('kamus')">üìñ<br>Kamus</div>
        <div class="nav-btn" onclick="switchTab('flashcard')">üé¥<br>Kartu</div>
        <div class="nav-btn" onclick="switchTab('quiz')">üéØ<br>Quiz</div>
        <div class="nav-btn" onclick="switchTab('game')">üéÆ<br>Game</div>
        <div class="nav-btn" onclick="switchTab('tone')">üéôÔ∏è<br>Tone</div>
        <div class="nav-btn" onclick="switchTab('chatbot')">ü§ñ<br>AI</div>
    </div>

    <script>
        // ==================== SUPREME GLOBAL STATE ====================
        let SUPREME_STATE = {
            profile: {
                name: "WANG WEIZE",
                level: 1,
                xp: 0,
                totalWords: 0,
                streakDays: 0,
                lastStudyDate: null,
                rank: "BRONZE WARRIOR"
            },
            history: {
                xpLog: [],
                studyDates: [],
                quizScores: [],
                voiceAttempts: []
            },
            vocabulary: {
                mastered: [],
                learning: [],
                new: []
            },
            achievements: [
                { id: 'first_word', name: 'Á¨¨‰∏ÄÊ≠•', desc: 'Pelajari kata pertama', unlocked: false, icon: 'üéØ' },
                { id: 'streak_7', name: '‰∏ÄÂë®', desc: 'Belajar 7 hari berturut', unlocked: false, icon: 'üî•' },
                { id: 'level_5', name: 'È´òÊâã', desc: 'Capai Level 5', unlocked: false, icon: '‚≠ê' },
                { id: 'level_10', name: '‰∏ìÂÆ∂', desc: 'Capai Level 10', unlocked: false, icon: 'üí´' },
                { id: 'master_50', name: 'Â§ßÂ∏à', desc: 'Kuasai 50 kata', unlocked: false, icon: 'üëë' },
                { id: 'master_100', name: '‰º†ËØ¥', desc: 'Kuasai 100 kata', unlocked: false, icon: 'üèÜ' },
                { id: 'perfect_quiz', name: 'ÂÆåÁæé', desc: 'Skor sempurna di quiz', unlocked: false, icon: 'üíØ' },
                { id: 'voice_master', name: 'Â£∞Èü≥Â§ßÂ∏à', desc: '50 voice check benar', unlocked: false, icon: 'üé§' },
                { id: 'tone_expert', name: 'Èü≥Ë∞É‰∏ìÂÆ∂', desc: 'Skor 500 di Tone Game', unlocked: false, icon: 'üéµ' },
                { id: 'game_winner', name: 'Ê∏∏ÊàèÂÜ†ÂÜõ', desc: 'Menang 10x Matching Game', unlocked: false, icon: 'üéÆ' },
                { id: 'stroke_artist', name: '‰π¶Ê≥ïÂÆ∂', desc: 'Skor 90+ di Stroke Analysis', unlocked: false, icon: '‚úçÔ∏è' },
                { id: 'emperor', name: 'ÁöáÂ∏ù', desc: 'Raih semua achievement!', unlocked: false, icon: 'üëë' }
            ],
            settings: {
                darkMode: false,
                soundEnabled: true,
                autoPlayAudio: true
            },
            gameStats: {
                matchingWins: 0,
                voiceCorrect: 0,
                toneHighScore: 0,
                strokeBestScore: 0
            }
        };

        // Expanded Vocabulary Database with HSK Levels
        const VOCAB_DATABASE = [
            // HSK 1 (150 words) - Expanded Sample
            { id: 1, hanzi: '‰Ω†Â•Ω', pinyin: 'n«ê h«éo', meaning: 'Halo', hsk: '1', category: 'greeting' },
            { id: 2, hanzi: 'Ë∞¢Ë∞¢', pinyin: 'xi√® xie', meaning: 'Terima kasih', hsk: '1', category: 'greeting' },
            { id: 3, hanzi: 'ÂÜçËßÅ', pinyin: 'z√†i ji√†n', meaning: 'Sampai jumpa', hsk: '1', category: 'greeting' },
            { id: 4, hanzi: 'ÂØπ‰∏çËµ∑', pinyin: 'du√¨ bu q«ê', meaning: 'Maaf', hsk: '1', category: 'greeting' },
            { id: 5, hanzi: 'ÂêÉÈ•≠', pinyin: 'chƒ´ f√†n', meaning: 'Makan', hsk: '1', category: 'food' },
            { id: 6, hanzi: 'ÂñùÊ∞¥', pinyin: 'hƒì shu«ê', meaning: 'Minum air', hsk: '1', category: 'food' },
            { id: 7, hanzi: 'Áù°Ëßâ', pinyin: 'shu√¨ ji√†o', meaning: 'Tidur', hsk: '1', category: 'daily' },
            { id: 8, hanzi: 'ÊúãÂèã', pinyin: 'p√©ng you', meaning: 'Teman', hsk: '1', category: 'social' },
            { id: 9, hanzi: 'Êàë', pinyin: 'w«í', meaning: 'Saya', hsk: '1', category: 'pronoun' },
            { id: 10, hanzi: '‰Ω†', pinyin: 'n«ê', meaning: 'Kamu', hsk: '1', category: 'pronoun' },
            { id: 11, hanzi: '‰ªñ', pinyin: 'tƒÅ', meaning: 'Dia (lk)', hsk: '1', category: 'pronoun' },
            { id: 12, hanzi: 'Â•π', pinyin: 'tƒÅ', meaning: 'Dia (pr)', hsk: '1', category: 'pronoun' },
            { id: 13, hanzi: 'Áà±', pinyin: '√†i', meaning: 'Cinta', hsk: '1', category: 'emotion' },
            { id: 14, hanzi: 'Â§ß', pinyin: 'd√†', meaning: 'Besar', hsk: '1', category: 'adjective' },
            { id: 15, hanzi: 'Â∞è', pinyin: 'xi«éo', meaning: 'Kecil', hsk: '1', category: 'adjective' },
            
            // HSK 2 (300 words) - Sample
            { id: 16, hanzi: 'Â≠¶‰π†', pinyin: 'xu√© x√≠', meaning: 'Belajar', hsk: '2', category: 'study' },
            { id: 17, hanzi: 'Â∑•‰Ωú', pinyin: 'g≈çng zu√≤', meaning: 'Bekerja', hsk: '2', category: 'work' },
            { id: 18, hanzi: 'Êó∂Èó¥', pinyin: 'sh√≠ jiƒÅn', meaning: 'Waktu', hsk: '2', category: 'time' },
            { id: 19, hanzi: 'Âú∞Êñπ', pinyin: 'd√¨ fƒÅng', meaning: 'Tempat', hsk: '2', category: 'location' },
            { id: 20, hanzi: 'ÂÆ∂‰∫∫', pinyin: 'jiƒÅ r√©n', meaning: 'Keluarga', hsk: '2', category: 'social' },
            { id: 21, hanzi: 'ËÄÅÂ∏à', pinyin: 'l«éo shƒ´', meaning: 'Guru', hsk: '2', category: 'people' },
            { id: 22, hanzi: 'Â≠¶Áîü', pinyin: 'xu√© shƒìng', meaning: 'Murid', hsk: '2', category: 'people' },
            { id: 23, hanzi: '‰ªäÂ§©', pinyin: 'jƒ´n tiƒÅn', meaning: 'Hari ini', hsk: '2', category: 'time' },
            { id: 24, hanzi: 'ÊòéÂ§©', pinyin: 'm√≠ng tiƒÅn', meaning: 'Besok', hsk: '2', category: 'time' },
            { id: 25, hanzi: 'Êò®Â§©', pinyin: 'zu√≥ tiƒÅn', meaning: 'Kemarin', hsk: '2', category: 'time' },
            
            // HSK 3 (600 words) - Sample
            { id: 26, hanzi: 'Ê±™', pinyin: 'wƒÅng', meaning: 'Marga Wang', hsk: '3', category: 'name' },
            { id: 27, hanzi: 'ËµöÈí±', pinyin: 'zhu√†n qi√°n', meaning: 'Menghasilkan uang', hsk: '3', category: 'business' },
            { id: 28, hanzi: 'ÁîüÊÑè', pinyin: 'shƒìng yi', meaning: 'Bisnis', hsk: '3', category: 'business' },
            { id: 29, hanzi: 'ÊàêÂäü', pinyin: 'ch√©ng g≈çng', meaning: 'Sukses', hsk: '3', category: 'achievement' },
            { id: 30, hanzi: 'Âä™Âäõ', pinyin: 'n«î l√¨', meaning: 'Berusaha keras', hsk: '3', category: 'character' },
            { id: 31, hanzi: 'ÈáçË¶Å', pinyin: 'zh√≤ng y√†o', meaning: 'Penting', hsk: '3', category: 'adjective' },
            { id: 32, hanzi: 'Âø´‰πê', pinyin: 'ku√†i l√®', meaning: 'Bahagia', hsk: '3', category: 'emotion' },
            { id: 33, hanzi: 'ÂÅ•Â∫∑', pinyin: 'ji√†n kƒÅng', meaning: 'Sehat', hsk: '3', category: 'health' },
            { id: 34, hanzi: 'Áæé‰∏Ω', pinyin: 'mƒõi l√¨', meaning: 'Cantik', hsk: '3', category: 'adjective' },
            { id: 35, hanzi: 'ËÅ™Êòé', pinyin: 'c≈çng m√≠ng', meaning: 'Pintar', hsk: '3', category: 'adjective' },
            
            // HSK 4 (1200 words) - Sample
            { id: 36, hanzi: 'Êú∫‰ºö', pinyin: 'jƒ´ hu√¨', meaning: 'Kesempatan', hsk: '4', category: 'business' },
            { id: 37, hanzi: 'ÂèëÂ±ï', pinyin: 'fƒÅ zh«én', meaning: 'Berkembang', hsk: '4', category: 'progress' },
            { id: 38, hanzi: 'ÁªèÈ™å', pinyin: 'jƒ´ng y√†n', meaning: 'Pengalaman', hsk: '4', category: 'life' },
            { id: 39, hanzi: '‰ºòÁßÄ', pinyin: 'y≈çu xi√π', meaning: 'Excellent', hsk: '4', category: 'adjective' },
            { id: 40, hanzi: 'Â§çÊùÇ', pinyin: 'f√π z√°', meaning: 'Kompleks', hsk: '4', category: 'adjective' },
            
            // HSK 5 (2500 words) - Sample
            { id: 41, hanzi: 'Ë¥°ÁåÆ', pinyin: 'g√≤ng xi√†n', meaning: 'Kontribusi', hsk: '5', category: 'abstract' },
            { id: 42, hanzi: 'ÊåëÊàò', pinyin: 'ti«éo zh√†n', meaning: 'Tantangan', hsk: '5', category: 'abstract' },
            { id: 43, hanzi: 'Á´û‰∫â', pinyin: 'j√¨ng zhƒìng', meaning: 'Kompetisi', hsk: '5', category: 'business' },
            { id: 44, hanzi: 'ÊïàÁéá', pinyin: 'xi√†o l«ú', meaning: 'Efisiensi', hsk: '5', category: 'business' },
            { id: 45, hanzi: 'ÂàõÊñ∞', pinyin: 'chu√†ng xƒ´n', meaning: 'Inovasi', hsk: '5', category: 'modern' },
            
            // HSK 6 (5000+ words) - Sample
            { id: 46, hanzi: 'Ê¶ÇÂøµ', pinyin: 'g√†i ni√†n', meaning: 'Konsep', hsk: '6', category: 'abstract' },
            { id: 47, hanzi: 'Á≠ñÁï•', pinyin: 'c√® l√º√®', meaning: 'Strategi', hsk: '6', category: 'planning' },
            { id: 48, hanzi: 'Âì≤Â≠¶', pinyin: 'zh√© xu√©', meaning: 'Filosofi', hsk: '6', category: 'academic' },
            { id: 49, hanzi: 'Ëæ©ËÆ∫', pinyin: 'bi√†n l√πn', meaning: 'Debat', hsk: '6', category: 'academic' },
            { id: 50, hanzi: 'ÁüõÁõæ', pinyin: 'm√°o d√πn', meaning: 'Kontradiksi', hsk: '6', category: 'abstract' },
            
            // Special: Wang Weize Vocabulary
            { id: 51, hanzi: 'Áéã‰∏∫Ê≥Ω', pinyin: 'W√°ng W√©iz√©', meaning: 'Wang Weize', hsk: 'special', category: 'name' },
            { id: 52, hanzi: 'Ëµö', pinyin: 'zhu√†n', meaning: 'Cuan/Profit', hsk: '3', category: 'slang' },
            { id: 53, hanzi: 'Ëµî', pinyin: 'p√©i', meaning: 'Boncos/Loss', hsk: '3', category: 'slang' },
            { id: 54, hanzi: 'ËÄÅÊùø', pinyin: 'l«éo b«én', meaning: 'Bos', hsk: '2', category: 'business' },
            { id: 55, hanzi: 'Âêà‰Ωú', pinyin: 'h√© zu√≤', meaning: 'Kerjasama', hsk: '3', category: 'business' },
            { id: 56, hanzi: 'Èæô', pinyin: 'l√≥ng', meaning: 'Naga', hsk: '3', category: 'culture' },
            { id: 57, hanzi: 'Á¶è', pinyin: 'f√∫', meaning: 'Keberuntungan', hsk: '3', category: 'culture' },
            { id: 58, hanzi: 'Èáë', pinyin: 'jƒ´n', meaning: 'Emas/Uang', hsk: '2', category: 'wealth' },
            { id: 59, hanzi: 'ÁöáÂ∏ù', pinyin: 'hu√°ng d√¨', meaning: 'Kaisar', hsk: '4', category: 'history' },
            { id: 60, hanzi: 'Â∏ùÂõΩ', pinyin: 'd√¨ gu√≥', meaning: 'Kekaisaran', hsk: '5', category: 'history' }
        ];

        // Chatbot Knowledge Base (MASSIVE)
        const CHATBOT_KNOWLEDGE = {
            grammar: {
                'ÁöÑÂæóÂú∞': 'Perbedaan ÁöÑÂæóÂú∞:\n‚Ä¢ ÁöÑ (de) = kepemilikan/sifat: "ÊàëÁöÑ‰π¶" (buku saya), "Á∫¢ÁöÑËä±" (bunga merah)\n‚Ä¢ Âæó (de) = keterangan hasil: "Ë∑ëÂæóÂø´" (lari cepat)\n‚Ä¢ Âú∞ (de) = keterangan cara: "ÊÖ¢ÊÖ¢Âú∞Ëµ∞" (berjalan pelan-pelan)',
                
                'measure words': 'Measure words (ÈáèËØç) adalah kata yang digunakan antara angka/demonstrative dengan kata benda. Contoh:\n‚Ä¢ ‰∏™ (g√®) = umum: ‰∏Ä‰∏™‰∫∫ (satu orang)\n‚Ä¢ Êú¨ (bƒõn) = buku: ‰∏§Êú¨‰π¶ (dua buku)\n‚Ä¢ ÊùØ (bƒìi) = gelas: ‰∏âÊùØÊ∞¥ (tiga gelas air)\n‚Ä¢ Âè™ (zhƒ´) = hewan: ‰∏ÄÂè™Áå´ (satu kucing)',
                
                'tenses': 'Mandarin tidak memiliki perubahan kata kerja berdasarkan waktu. Waktu ditunjukkan dengan:\n‚Ä¢ ‰∫Ü (le) = sudah selesai: "ÊàëÂêÉ‰∫Ü" (saya sudah makan)\n‚Ä¢ Ëøá (gu√≤) = pengalaman: "ÊàëÂéªËøá‰∏≠ÂõΩ" (saya pernah ke China)\n‚Ä¢ Âú® (z√†i) = sedang: "ÊàëÂú®Â≠¶‰π†" (saya sedang belajar)\n‚Ä¢ Ë¶Å/‰ºö (y√†o/hu√¨) = akan: "ÊàëË¶ÅÂéª" (saya akan pergi)',
                
                'particles': 'Partikel penting dalam Mandarin:\n‚Ä¢ Âêó (ma) = penanda tanya: "‰Ω†Â•ΩÂêó?" (apa kabar?)\n‚Ä¢ Âë¢ (ne) = dan kamu? / bagaimana dengan?\n‚Ä¢ Âïä (a) = penekanan emosi\n‚Ä¢ Âêß (ba) = saran/perkiraan: "Êàë‰ª¨Ëµ∞Âêß" (ayo pergi)'
            },
            
            tones: {
                'sistem nada': 'Mandarin memiliki 4 nada + 1 nada netral:\n‚Ä¢ Nada 1 (‰∏ÄÂ£∞): Tinggi datar - ƒÅ (seperti "aaa" saat dokter periksa tenggorokan)\n‚Ä¢ Nada 2 (‰∫åÂ£∞): Naik - √° (seperti "hah?" saat kaget)\n‚Ä¢ Nada 3 (‰∏âÂ£∞): Turun lalu naik - «é (seperti "oh..." saat berpikir)\n‚Ä¢ Nada 4 (ÂõõÂ£∞): Turun tajam - √† (seperti "ha!" tegas)\n‚Ä¢ Nada netral: Ringan, tidak ada tekanan',
                
                'tone pairs': 'Kombinasi nada yang sering muncul:\n‚Ä¢ 1+1: Â¶àÂ¶à (mƒÅma) - mama\n‚Ä¢ 1+4: ‰∏≠ÂõΩ (Zh≈çnggu√≥) - China\n‚Ä¢ 2+4: Â≠¶Ê†° (xu√©xi√†o) - sekolah\n‚Ä¢ 3+1: ‰Ω†Â•Ω (n«êh«éo) - halo\n‚Ä¢ 4+4: ÂÜçËßÅ (z√†iji√†n) - bye\nNada 3 + Nada 3 ‚Üí Nada 2 + Nada 3: ‰Ω†Â•Ω dibaca n√≠h«éo bukan n«êh«éo'
            },
            
            culture: {
                'chinese names': 'Nama China:\n‚Ä¢ Format: Marga + Nama (‰æã: Áéã‰∏∫Ê≥Ω = W√°ng W√©iz√©)\n‚Ä¢ Marga biasanya 1 karakter (Wang, Li, Zhang, Liu, Chen)\n‚Ä¢ Nama biasanya 1-2 karakter\n‚Ä¢ Marga ditulis duluan (kebalikan dari Barat)\n‚Ä¢ Ada ~100 marga umum yang mencakup 85% populasi China',
                
                'festivals': 'Festival penting:\n‚Ä¢ Êò•ËäÇ (Ch≈´n Ji√©) - Tahun Baru Imlek: festival terbesar, keluarga berkumpul\n‚Ä¢ ‰∏≠ÁßãËäÇ (Zh≈çngqi≈´ Ji√©) - Festival Bulan: makan mooncake\n‚Ä¢ Á´ØÂçàËäÇ (DuƒÅnw«î Ji√©) - Festival Perahu Naga: balapan perahu, makan zongzi\n‚Ä¢ Ê∏ÖÊòéËäÇ (Qƒ´ngm√≠ng Ji√©) - Hari Memori: ziarah makam leluhur',
                
                'red packets': 'Á∫¢ÂåÖ (h√≥ngbƒÅo) - Amplop merah:\n‚Ä¢ Diberikan saat Tahun Baru, pernikahan, ulang tahun\n‚Ä¢ Berisi uang dalam jumlah genap (Èô§‰∫Ü4)\n‚Ä¢ 4 pantang (Âõõ = s«ê = mati)\n‚Ä¢ 8 favorit (ÂÖ´ = bƒÅ mirip ÂèëË¥¢ = fƒÅc√°i = makmur)\n‚Ä¢ Angka 6, 8, 9 dianggap keberuntungan'
            },
            
            hsk: {
                'what is hsk': 'HSK (Ê±âËØ≠Ê∞¥Âπ≥ËÄÉËØï) = Hanyu Shuiping Kaoshi:\n‚Ä¢ Test standar kemampuan Mandarin untuk non-native speaker\n‚Ä¢ 6 level: HSK 1 (pemula) - HSK 6 (advanced)\n‚Ä¢ HSK 1: 150 kata\n‚Ä¢ HSK 2: 300 kata\n‚Ä¢ HSK 3: 600 kata\n‚Ä¢ HSK 4: 1200 kata (conversational)\n‚Ä¢ HSK 5: 2500 kata (professional)\n‚Ä¢ HSK 6: 5000+ kata (native-like)',
                
                'preparation': 'Tips persiapan HSK:\n1. Pelajari daftar kata resmi HSK level target Anda\n2. Latihan soal past papers\n3. Listening practice minimal 30 menit/hari\n4. Baca artikel Mandarin sederhana\n5. Tulis esai pendek (HSK 3+)\n6. Gunakan flashcard untuk vocab\n7. Target: HSK 4 = conversational Chinese'
            },
            
            tips: {
                'belajar efektif': '10 Tips Belajar Mandarin Super Efektif:\n1. Fokus pada 1000 kata paling umum dulu\n2. Belajar dalam konteks kalimat, bukan kata isolated\n3. Dengarkan audio native speaker setiap hari\n4. Tulis karakter dengan tangan (muscle memory)\n5. Gunakan spaced repetition (Anki, flashcard)\n6. Nonton series/film Mandarin dengan subtitle\n7. Chat dengan native speaker (HelloTalk, Tandem)\n8. Jangan takut salah nada - tetap bicara!\n9. Pelajari radikal untuk mengerti struktur karakter\n10. Konsisten 30 menit/hari lebih baik dari 3 jam weekend',
                
                'mnemonics': 'Teknik Mnemonik untuk Karakter:\n‚Ä¢ ‰ºë (xi≈´ - istirahat) = ‰∫∫ (orang) + Êú® (pohon) ‚Üí orang bersandar di pohon\n‚Ä¢ Êòé (m√≠ng - terang) = Êó• (matahari) + Êúà (bulan) ‚Üí matahari + bulan = terang!\n‚Ä¢ Êûó (l√≠n - hutan) = Êú® + Êú® ‚Üí banyak pohon = hutan\n‚Ä¢ Ê£Æ (sƒìn - rimba) = Êú® + Êú® + Êú® ‚Üí lebih banyak pohon!\n‚Ä¢ Â•Ω (h«éo - baik) = Â•≥ (wanita) + Â≠ê (anak) ‚Üí ibu dan anak = baik\nBuat cerita unik Anda sendiri!'
            }
        };

        // ==================== INITIALIZATION ====================
        window.onload = function() {
            loadSupremeState();
            renderDashboard();
            renderVocabGrid();
            initCanvas();
            createParticles();
            updateAISuggestion();
            startStudyTimer();
            checkVoiceRecognitionSupport();
        };

        // Load from localStorage
        function loadSupremeState() {
            const saved = localStorage.getItem('wangWeizeSupreme');
            if (saved) {
                try {
                    SUPREME_STATE = JSON.parse(saved);
                    if (SUPREME_STATE.settings.darkMode) {
                        document.body.classList.add('dark-mode');
                        document.getElementById('darkModeIcon').textContent = '‚òÄÔ∏è';
                    }
                    checkAndUpdateStreak();
                } catch(e) {
                    console.error('Failed to load saved state:', e);
                }
            }
        }

        // Save to localStorage
        function saveSupremeState() {
            localStorage.setItem('wangWeizeSupreme', JSON.stringify(SUPREME_STATE));
        }

        // ==================== DARK MODE TOGGLE ====================
        function toggleDarkMode() {
            SUPREME_STATE.settings.darkMode = !SUPREME_STATE.settings.darkMode;
            document.body.classList.toggle('dark-mode');
            
            const icon = document.getElementById('darkModeIcon');
            icon.textContent = SUPREME_STATE.settings.darkMode ? '‚òÄÔ∏è' : 'üåô';
            
            saveSupremeState();
            showNotification(SUPREME_STATE.settings.darkMode ? 'üåô Emperor Night Mode Aktif!' : '‚òÄÔ∏è Light Mode Aktif!');
        }

        // ==================== DASHBOARD RENDERING ====================
        function renderDashboard() {
            // Level & XP
            document.getElementById('userLevel').textContent = SUPREME_STATE.profile.level;
            const xpForNextLevel = SUPREME_STATE.profile.level * 100;
            const xpProgress = (SUPREME_STATE.profile.xp / xpForNextLevel) * 100;
            document.getElementById('currentXP').textContent = SUPREME_STATE.profile.xp;
            document.getElementById('nextLevelXP').textContent = xpForNextLevel;
            document.getElementById('levelProgress').style.width = xpProgress + '%';
            
            // Stats
            document.getElementById('totalWords').textContent = SUPREME_STATE.profile.totalWords;
            document.getElementById('streakDays').textContent = SUPREME_STATE.profile.streakDays;
            
            // Streak Calendar (30 days)
            renderStreakCalendar();
            
            // Achievements
            renderAchievements();
            
            // Update Rank
            updateRank();
        }

        function updateRank() {
            const level = SUPREME_STATE.profile.level;
            let rank = "BRONZE WARRIOR";
            
            if (level >= 20) rank = "IMPERIAL EMPEROR üëë";
            else if (level >= 15) rank = "DIAMOND MASTER üíé";
            else if (level >= 10) rank = "PLATINUM SCHOLAR üåü";
            else if (level >= 5) rank = "GOLD EXPERT ‚≠ê";
            else if (level >= 3) rank = "SILVER KNIGHT üó°Ô∏è";
            
            SUPREME_STATE.profile.rank = rank;
        }

        function renderStreakCalendar() {
            const calendar = document.getElementById('streakCalendar');
            calendar.innerHTML = '';
            
            const today = new Date();
            const studyDates = SUPREME_STATE.history.studyDates.map(d => new Date(d).toDateString());
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                
                const dayDiv = document.createElement('div');
                dayDiv.className = 'streak-day';
                
                const dateStr = date.toDateString();
                const hasStudied = studyDates.includes(dateStr);
                
                if (hasStudied) {
                    dayDiv.classList.add('streak-complete');
                } else {
                    dayDiv.classList.add('streak-incomplete');
                }
                
                if (i === 0) {
                    dayDiv.classList.add('streak-today');
                }
                
                dayDiv.textContent = date.getDate();
                dayDiv.title = date.toLocaleDateString('id-ID');
                calendar.appendChild(dayDiv);
            }
        }

        function renderAchievements() {
            const container = document.getElementById('achievementsList');
            const unlockedCount = SUPREME_STATE.achievements.filter(a => a.unlocked).length;
            document.getElementById('achievementCount').textContent = unlockedCount;
            
            container.innerHTML = SUPREME_STATE.achievements.map(ach => {
                const locked = ach.unlocked ? '' : 'achievement-locked';
                return `<div class="achievement-badge ${locked}">
                    <div style="font-size: 32px; margin-bottom: 5px;">${ach.icon}</div>
                    <div class="font-bold">${ach.name}</div>
                    <div class="text-xs">${ach.desc}</div>
                </div>`;
            }).join('');
        }

        function checkAndUpdateStreak() {
            const today = new Date().toDateString();
            const lastStudy = SUPREME_STATE.profile.lastStudyDate ? new Date(SUPREME_STATE.profile.lastStudyDate).toDateString() : null;
            
            if (lastStudy !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toDateString();
                
                if (lastStudy === yesterdayStr) {
                    SUPREME_STATE.profile.streakDays++;
                } else if (lastStudy !== null && lastStudy !== today) {
                    SUPREME_STATE.profile.streakDays = 1;
                } else {
                    SUPREME_STATE.profile.streakDays = 1;
                }
                
                SUPREME_STATE.profile.lastStudyDate = new Date().toISOString();
                if (!SUPREME_STATE.history.studyDates.includes(today)) {
                    SUPREME_STATE.history.studyDates.push(today);
                }
                
                checkAchievements();
                saveSupremeState();
            }
        }

        function addXP(amount, reason) {
            SUPREME_STATE.profile.xp += amount;
            
            const xpForNextLevel = SUPREME_STATE.profile.level * 100;
            if (SUPREME_STATE.profile.xp >= xpForNextLevel) {
                SUPREME_STATE.profile.level++;
                SUPREME_STATE.profile.xp -= xpForNextLevel;
                showNotification(`üéâ LEVEL UP! Sekarang Level ${SUPREME_STATE.profile.level}!`);
            }
            
            SUPREME_STATE.history.xpLog.push({
                amount,
                reason,
                timestamp: new Date().toISOString()
            });
            
            checkAndUpdateStreak();
            checkAchievements();
            renderDashboard();
            saveSupremeState();
        }

        function checkAchievements() {
            let unlocked = false;
            
            if (!SUPREME_STATE.achievements[0].unlocked && SUPREME_STATE.profile.totalWords >= 1) {
                SUPREME_STATE.achievements[0].unlocked = true;
                unlocked = true;
                showNotification('üèÜ Achievement: ' + SUPREME_STATE.achievements[0].name);
            }
            
            if (!SUPREME_STATE.achievements[1].unlocked && SUPREME_STATE.profile.streakDays >= 7) {
                SUPREME_STATE.achievements[1].unlocked = true;
                unlocked = true;
                showNotification('üèÜ Achievement: ' + SUPREME_STATE.achievements[1].name);
            }
            
            if (!SUPREME_STATE.achievements[2].unlocked && SUPREME_STATE.profile.level >= 5) {
                SUPREME_STATE.achievements[2].unlocked = true;
                unlocked = true;
                showNotification('üèÜ Achievement: ' + SUPREME_STATE.achievements[2].name);
            }
            
            if (!SUPREME_STATE.achievements[3].unlocked && SUPREME_STATE.profile.level >= 10) {
                SUPREME_STATE.achievements[3].unlocked = true;
                unlocked = true;
                showNotification('üèÜ Achievement: ' + SUPREME_STATE.achievements[3].name);
            }
            
            if (!SUPREME_STATE.achievements[4].unlocked && SUPREME_STATE.profile.totalWords >= 50) {
                SUPREME_STATE.achievements[4].unlocked = true;
                unlocked = true;
                showNotification('üèÜ Achievement: ' + SUPREME_STATE.achievements[4].name);
            }
            
            if (!SUPREME_STATE.achievements[5].unlocked && SUPREME_STATE.profile.totalWords >= 100) {
                SUPREME_STATE.achievements[5].unlocked = true;
                unlocked = true;
                showNotification('üèÜ Achievement: ' + SUPREME_STATE.achievements[5].name);
            }
            
            if (!SUPREME_STATE.achievements[7].unlocked && SUPREME_STATE.gameStats.voiceCorrect >= 50) {
                SUPREME_STATE.achievements[7].unlocked = true;
                unlocked = true;
                showNotification('üèÜ Achievement: ' + SUPREME_STATE.achievements[7].name);
            }
            
            if (!SUPREME_STATE.achievements[8].unlocked && SUPREME_STATE.gameStats.toneHighScore >= 500) {
                SUPREME_STATE.achievements[8].unlocked = true;
                unlocked = true;
                showNotification('üèÜ Achievement: ' + SUPREME_STATE.achievements[8].name);
            }
            
            if (!SUPREME_STATE.achievements[9].unlocked && SUPREME_STATE.gameStats.matchingWins >= 10) {
                SUPREME_STATE.achievements[9].unlocked = true;
                unlocked = true;
                showNotification('üèÜ Achievement: ' + SUPREME_STATE.achievements[9].name);
            }
            
            if (!SUPREME_STATE.achievements[10].unlocked && SUPREME_STATE.gameStats.strokeBestScore >= 90) {
                SUPREME_STATE.achievements[10].unlocked = true;
                unlocked = true;
                showNotification('üèÜ Achievement: ' + SUPREME_STATE.achievements[10].name);
            }
            
            // Check Emperor (all achievements)
            const allUnlocked = SUPREME_STATE.achievements.slice(0, -1).every(a => a.unlocked);
            if (!SUPREME_STATE.achievements[11].unlocked && allUnlocked) {
                SUPREME_STATE.achievements[11].unlocked = true;
                unlocked = true;
                showNotification('üëë ULTIMATE ACHIEVEMENT: ÁöáÂ∏ù (EMPEROR)!');
            }
            
            if (unlocked) {
                renderAchievements();
                saveSupremeState();
            }
        }

        function showNotification(message) {
            const notif = document.createElement('div');
            notif.style.cssText = 'position: fixed; top: 90px; right: 20px; background: linear-gradient(135deg, var(--emperor-gold), #DAA520); color: var(--imperial-red); padding: 20px 30px; border-radius: 15px; font-weight: bold; z-index: 9999; box-shadow: 0 10px 30px rgba(0,0,0,0.3); animation: slideIn 0.5s;';
            notif.textContent = message;
            document.body.appendChild(notif);
            
            setTimeout(() => {
                notif.style.animation = 'slideOut 0.5s';
                setTimeout(() => notif.remove(), 500);
            }, 3000);
        }

        // ==================== DIGITAL ID CARD GENERATOR ====================
        function generateDigitalID() {
            const container = document.getElementById('digitalIDContainer');
            
            const idCard = `
                <div class="digital-id-card">
                    <div class="id-hologram"></div>
                    <div style="position: relative; z-index: 1;">
                        <div class="text-center mb-6">
                            <div class="text-3xl font-black mb-2">üèõÔ∏è IMPERIAL MANDARIN AUTHORITY</div>
                            <div class="text-sm opacity-70">OFFICIAL STUDENT IDENTIFICATION</div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-6 mb-6">
                            <div>
                                <div class="text-sm opacity-70 mb-1">NAME / ÂßìÂêç</div>
                                <div class="text-2xl font-black">${SUPREME_STATE.profile.name}</div>
                            </div>
                            <div>
                                <div class="text-sm opacity-70 mb-1">LEVEL / Á≠âÁ∫ß</div>
                                <div class="text-2xl font-black">${SUPREME_STATE.profile.level}</div>
                            </div>
                            <div>
                                <div class="text-sm opacity-70 mb-1">XP POINTS</div>
                                <div class="text-2xl font-black">${SUPREME_STATE.profile.xp}</div>
                            </div>
                            <div>
                                <div class="text-sm opacity-70 mb-1">WORDS MASTERED</div>
                                <div class="text-2xl font-black">${SUPREME_STATE.profile.totalWords}</div>
                            </div>
                        </div>
                        
                        <div class="text-center mb-4">
                            <div class="text-sm opacity-70 mb-2">RANK / Á≠âÁ∫ß</div>
                            <div class="rank-badge-display">${SUPREME_STATE.profile.rank}</div>
                        </div>
                        
                        <div class="text-center">
                            <div class="text-xs opacity-50">ID: WW-${Date.now().toString().slice(-8)}</div>
                            <div class="text-xs opacity-50 mt-1">Issued: ${new Date().toLocaleDateString('id-ID')}</div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button onclick="downloadIDCard()" class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-gray-900 px-6 py-3 rounded-xl font-black shadow-lg hover:scale-105 transition">
                                üíæ DOWNLOAD ID CARD
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = idCard;
            addXP(10, 'Generate Digital ID');
        }

        function downloadIDCard() {
            // Simple implementation - in real app, use html2canvas
            showNotification('üì∏ Fitur Download ID akan segera hadir!');
        }

        // ==================== VOCABULARY GRID WITH AI IMAGES & VOICE ====================
        let currentHSKFilter = 'all';
        let currentVoiceCheck = null;

        function renderVocabGrid() {
            const grid = document.getElementById('vocabGrid');
            const search = document.getElementById('searchInput')?.value.toLowerCase() || '';
            
            let filtered = VOCAB_DATABASE.filter(v => {
                const matchSearch = !search || 
                    v.hanzi.includes(search) || 
                    v.pinyin.toLowerCase().includes(search) ||
                    v.meaning.toLowerCase().includes(search);
                    
                const matchHSK = currentHSKFilter === 'all' || v.hsk === currentHSKFilter;
                
                return matchSearch && matchHSK;
            });
            
            grid.innerHTML = filtered.map(vocab => `
                <div class="vocab-card">
                    <div class="flex justify-between items-start mb-4">
                        <div class="vocab-hanzi">${vocab.hanzi}</div>
                        <div class="flex gap-2">
                            <div class="vocab-btn" onclick="speakWord('${vocab.hanzi}')" title="Dengar">
                                üîä
                            </div>
                            <div class="vocab-btn" onclick="startVoiceCheck(${vocab.id}, '${vocab.hanzi}', '${vocab.pinyin}')" title="Voice Check">
                                üé§
                            </div>
                        </div>
                    </div>
                    
                    <div class="ai-image-container" id="img-${vocab.id}">
                        <div class="loading-spinner"></div>
                    </div>
                    
                    <div class="text-lg font-bold text-gray-700 mb-1">${vocab.pinyin}</div>
                    <div class="text-md text-gray-600 mb-3">${vocab.meaning}</div>
                    
                    <div class="flex gap-2 justify-between">
                        <span class="badge text-xs">HSK ${vocab.hsk}</span>
                        <span class="badge text-xs">${vocab.category}</span>
                    </div>
                    
                    <div id="voice-feedback-${vocab.id}" class="mt-3"></div>
                    
                    <div class="mt-3 flex gap-2">
                        <button onclick="addToLearning(${vocab.id})" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-sm">
                            üìö Pelajari
                        </button>
                        <button onclick="markMastered(${vocab.id})" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-sm">
                            ‚úÖ Kuasai
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Load AI Images
            filtered.forEach(vocab => {
                loadAIImage(vocab.id, vocab.hanzi, vocab.meaning);
            });
        }

        function loadAIImage(vocabId, hanzi, meaning) {
            setTimeout(() => {
                const container = document.getElementById(`img-${vocabId}`);
                if (!container) return;
                
                const prompt = encodeURIComponent(`Chinese ${meaning}, ${hanzi}, traditional Chinese art style, watercolor illustration, simple elegant`);
                const imageUrl = `https://image.pollinations.ai/prompt/${prompt}?width=400&height=300&nologo=true&seed=${vocabId}`;
                
                container.innerHTML = `<img src="${imageUrl}" alt="${hanzi}" onerror="this.src='https://via.placeholder.com/400x300/FFD700/C41E3A?text=${hanzi}'" loading="lazy">`;
            }, 100);
        }

        function filterHSK(level) {
            currentHSKFilter = level;
            
            document.querySelectorAll('.hsk-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`hsk-${level}`).classList.add('active');
            
            renderVocabGrid();
        }

        function searchVocab() {
            renderVocabGrid();
        }

        function addToLearning(vocabId) {
            const vocab = VOCAB_DATABASE.find(v => v.id === vocabId);
            if (!SUPREME_STATE.vocabulary.learning.includes(vocabId) && !SUPREME_STATE.vocabulary.mastered.includes(vocabId)) {
                SUPREME_STATE.vocabulary.learning.push(vocabId);
                addXP(5, `Mulai belajar: ${vocab.hanzi}`);
                showNotification(`üìö Ditambahkan ke daftar belajar: ${vocab.hanzi}`);
            }
        }

        function markMastered(vocabId) {
            const vocab = VOCAB_DATABASE.find(v => v.id === vocabId);
            if (!SUPREME_STATE.vocabulary.mastered.includes(vocabId)) {
                SUPREME_STATE.vocabulary.mastered.push(vocabId);
                SUPREME_STATE.vocabulary.learning = SUPREME_STATE.vocabulary.learning.filter(id => id !== vocabId);
                SUPREME_STATE.profile.totalWords++;
                addXP(20, `Menguasai kata: ${vocab.hanzi}`);
                showNotification(`‚úÖ Dikuasai: ${vocab.hanzi}! (+20 XP)`);
            }
        }

        function speakWord(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-CN';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        // ==================== VOICE RECOGNITION (CUAN/BONCOS) ====================
        let voiceRecognition = null;

        function checkVoiceRecognitionSupport() {
            if ('webkitSpeechRecognition' in window) {
                voiceRecognition = new webkitSpeechRecognition();
                voiceRecognition.lang = 'zh-CN';
                voiceRecognition.continuous = false;
                voiceRecognition.interimResults = false;
            } else if ('SpeechRecognition' in window) {
                voiceRecognition = new SpeechRecognition();
                voiceRecognition.lang = 'zh-CN';
                voiceRecognition.continuous = false;
                voiceRecognition.interimResults = false;
            }
        }

        function startVoiceCheck(vocabId, hanzi, pinyin) {
            if (!voiceRecognition) {
                showNotification('‚ö†Ô∏è Voice Recognition tidak didukung di browser ini');
                return;
            }
            
            currentVoiceCheck = { vocabId, hanzi, pinyin };
            
            const feedbackEl = document.getElementById(`voice-feedback-${vocabId}`);
            feedbackEl.innerHTML = '<div class="text-center text-sm text-gray-600 py-2">üé§ Ucapkan: <strong>' + hanzi + '</strong></div>';
            
            voiceRecognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript.trim();
                checkVoiceResult(vocabId, hanzi, transcript);
            };
            
            voiceRecognition.onerror = function(event) {
                feedbackEl.innerHTML = '<div class="text-center text-sm text-red-600 py-2">‚ùå Error: ' + event.error + '</div>';
            };
            
            voiceRecognition.start();
        }

        function checkVoiceResult(vocabId, expectedHanzi, spokenText) {
            const feedbackEl = document.getElementById(`voice-feedback-${vocabId}`);
            
            // Check if spoken text matches expected (allow some tolerance)
            const isCorrect = spokenText.includes(expectedHanzi) || 
                            expectedHanzi.includes(spokenText) ||
                            spokenText === expectedHanzi;
            
            if (isCorrect) {
                feedbackEl.innerHTML = `
                    <div class="voice-feedback voice-cuan">
                        üí∞ CUAN! PELAFALAN BENAR!
                    </div>
                `;
                addXP(15, 'Voice Check Benar');
                SUPREME_STATE.gameStats.voiceCorrect++;
                SUPREME_STATE.history.voiceAttempts.push({
                    vocabId,
                    correct: true,
                    timestamp: new Date().toISOString()
                });
            } else {
                feedbackEl.innerHTML = `
                    <div class="voice-feedback voice-boncos">
                        üìâ BONCOS! Coba lagi! Anda ucapkan: "${spokenText}"
                    </div>
                `;
                SUPREME_STATE.history.voiceAttempts.push({
                    vocabId,
                    correct: false,
                    spokenText,
                    timestamp: new Date().toISOString()
                });
            }
            
            setTimeout(() => {
                feedbackEl.innerHTML = '';
            }, 5000);
            
            checkAchievements();
            saveSupremeState();
        }

        // ==================== LIVE DICTIONARY API ====================
        let dictTimeout;
        function lookupCharacter(char) {
            clearTimeout(dictTimeout);
            
            if (!char || char.length === 0) {
                document.getElementById('charDetails').innerHTML = '<p class="text-center">Ketik karakter untuk melihat detail lengkap...</p>';
                return;
            }
            
            document.getElementById('charDetails').innerHTML = '<div class="loading-spinner"></div>';
            
            dictTimeout = setTimeout(() => {
                // Using CC-CEDICT data
                fetch(`https://ccdb.hemiola.com/characters/string/${encodeURIComponent(char)}?fields=kMandarin,kDefinition,kTotalStrokes,kRSUnicode`)
                    .then(res => res.json())
                    .then(data => {
                        if (data && data.length > 0) {
                            const charData = data[0];
                            displayCharacterDetails(char, charData);
                        } else {
                            displayFallbackData(char);
                        }
                    })
                    .catch(err => {
                        console.error('Dictionary API error:', err);
                        displayFallbackData(char);
                    });
            }, 500);
        }

        function displayCharacterDetails(char, data) {
            const pinyin = data.kMandarin || 'N/A';
            const definition = data.kDefinition || 'N/A';
            const strokes = data.kTotalStrokes || 'N/A';
            const radical = data.kRSUnicode ? data.kRSUnicode.split('.')[0] : 'N/A';
            
            document.getElementById('charDetails').innerHTML = `
                <div class="text-6xl text-center mb-4 font-bold">${char}</div>
                <div class="grid grid-cols-2 gap-3 text-left">
                    <div><strong>üìå Pinyin:</strong> ${pinyin}</div>
                    <div><strong>üñäÔ∏è Jumlah Goresan:</strong> ${strokes}</div>
                    <div class="col-span-2"><strong>üìö Arti:</strong> ${definition}</div>
                    <div><strong>üî§ Radikal:</strong> ${radical}</div>
                    <div><strong>üéØ Unicode:</strong> U+${char.charCodeAt(0).toString(16).toUpperCase()}</div>
                </div>
            `;
        }

        function displayFallbackData(char) {
            const unicode = `U+${char.charCodeAt(0).toString(16).toUpperCase()}`;
            
            document.getElementById('charDetails').innerHTML = `
                <div class="text-6xl text-center mb-4 font-bold">${char}</div>
                <div class="text-center">
                    <p class="mb-2"><strong>Unicode:</strong> ${unicode}</p>
                    <p class="text-sm text-gray-300">Informasi detail tidak tersedia dari API.</p>
                    <p class="text-sm text-gray-300">Coba karakter lain atau cek koneksi internet.</p>
                </div>
            `;
        }

        // ==================== CANVAS DRAWING + STROKE ANALYSIS ====================
        let gridCtx, drawCtx;
        let isDrawing = false;
        let currentPractice = '';
        let strokePoints = [];

        function initCanvas() {
            const gridCanvas = document.getElementById('gridCanvas');
            const drawCanvas = document.getElementById('drawCanvas');
            
            if (!gridCanvas || !drawCanvas) return;
            
            gridCtx = gridCanvas.getContext('2d');
            drawCtx = drawCanvas.getContext('2d');
            
            drawCanvas.addEventListener('mousedown', startDrawing);
            drawCanvas.addEventListener('mousemove', draw);
            drawCanvas.addEventListener('mouseup', stopDrawing);
            drawCanvas.addEventListener('mouseout', stopDrawing);
            
            drawCanvas.addEventListener('touchstart', handleTouch);
            drawCanvas.addEventListener('touchmove', handleTouch);
            drawCanvas.addEventListener('touchend', stopDrawing);
            
            drawGrid();
        }

        function drawGrid() {
            if (!gridCtx) return;
            gridCtx.clearRect(0, 0, 360, 360);
            gridCtx.strokeStyle = '#FFD700';
            gridCtx.lineWidth = 2;
            
            for (let i = 0; i <= 360; i += 90) {
                gridCtx.beginPath();
                gridCtx.moveTo(i, 0);
                gridCtx.lineTo(i, 360);
                gridCtx.stroke();
                
                gridCtx.beginPath();
                gridCtx.moveTo(0, i);
                gridCtx.lineTo(360, i);
                gridCtx.stroke();
            }
            
            gridCtx.setLineDash([5, 5]);
            gridCtx.beginPath();
            gridCtx.moveTo(0, 0);
            gridCtx.lineTo(360, 360);
            gridCtx.stroke();
            
            gridCtx.beginPath();
            gridCtx.moveTo(360, 0);
            gridCtx.lineTo(0, 360);
            gridCtx.stroke();
            gridCtx.setLineDash([]);
            
            if (currentPractice) {
                gridCtx.font = '280px "Ma Shan Zheng"';
                gridCtx.fillStyle = 'rgba(196, 30, 58, 0.15)';
                gridCtx.textAlign = 'center';
                gridCtx.textBaseline = 'middle';
                gridCtx.fillText(currentPractice, 180, 180);
            }
        }

        function setPractice(char) {
            currentPractice = char;
            drawGrid();
            clearDraw();
        }

        function startDrawing(e) {
            isDrawing = true;
            const pos = getMousePos(e);
            strokePoints.push({ x: pos.x, y: pos.y });
            drawCtx.beginPath();
            drawCtx.moveTo(pos.x, pos.y);
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            
            const pos = getMousePos(e);
            strokePoints.push({ x: pos.x, y: pos.y });
            drawCtx.lineWidth = 8;
            drawCtx.lineCap = 'round';
            drawCtx.strokeStyle = '#C41E3A';
            drawCtx.lineTo(pos.x, pos.y);
            drawCtx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            drawCanvas.dispatchEvent(mouseEvent);
        }

        function getMousePos(e) {
            const rect = drawCanvas.getBoundingClientRect();
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            
            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        function clearDraw() {
            if (drawCtx) {
                drawCtx.clearRect(0, 0, 360, 360);
                strokePoints = [];
            }
            
            const scoreDisplay = document.getElementById('strokeScoreDisplay');
            if (scoreDisplay) {
                scoreDisplay.classList.add('hidden');
            }
        }

        function saveWriting() {
            const dataURL = drawCanvas.toDataURL();
            const link = document.createElement('a');
            link.download = `writing_${currentPractice || 'practice'}_${Date.now()}.png`;
            link.href = dataURL;
            link.click();
            
            addXP(5, 'Menyimpan latihan tulis');
            showNotification('üíæ Tulisan disimpan!');
        }

        // ==================== AI STROKE ANALYSIS (0-100 SCORE) ====================
        function analyzeStrokeAI() {
            if (strokePoints.length < 10) {
                showNotification('‚ö†Ô∏è Tulisan terlalu sedikit untuk dianalisis!');
                return;
            }
            
            // AI Stroke Analysis Algorithm
            let score = 0;
            
            // 1. Stroke Coverage (30 points)
            const coverage = Math.min(strokePoints.length / 200, 1) * 30;
            score += coverage;
            
            // 2. Stroke Smoothness (25 points)
            let totalAngleChange = 0;
            for (let i = 2; i < strokePoints.length; i++) {
                const dx1 = strokePoints[i-1].x - strokePoints[i-2].x;
                const dy1 = strokePoints[i-1].y - strokePoints[i-2].y;
                const dx2 = strokePoints[i].x - strokePoints[i-1].x;
                const dy2 = strokePoints[i].y - strokePoints[i-1].y;
                
                const angle1 = Math.atan2(dy1, dx1);
                const angle2 = Math.atan2(dy2, dx2);
                let angleDiff = Math.abs(angle2 - angle1);
                
                if (angleDiff > Math.PI) angleDiff = 2 * Math.PI - angleDiff;
                totalAngleChange += angleDiff;
            }
            const smoothness = Math.max(0, 25 - (totalAngleChange / strokePoints.length) * 5);
            score += smoothness;
            
            // 3. Centering (20 points)
            const centerX = strokePoints.reduce((sum, p) => sum + p.x, 0) / strokePoints.length;
            const centerY = strokePoints.reduce((sum, p) => sum + p.y, 0) / strokePoints.length;
            const idealCenterX = 180;
            const idealCenterY = 180;
            const centeringError = Math.sqrt(Math.pow(centerX - idealCenterX, 2) + Math.pow(centerY - idealCenterY, 2));
            const centering = Math.max(0, 20 - (centeringError / 10));
            score += centering;
            
            // 4. Stroke Consistency (15 points)
            const speeds = [];
            for (let i = 1; i < strokePoints.length; i++) {
                const dx = strokePoints[i].x - strokePoints[i-1].x;
                const dy = strokePoints[i].y - strokePoints[i-1].y;
                speeds.push(Math.sqrt(dx*dx + dy*dy));
            }
            const avgSpeed = speeds.reduce((a,b) => a+b, 0) / speeds.length;
            const speedVariance = speeds.reduce((sum, s) => sum + Math.pow(s - avgSpeed, 2), 0) / speeds.length;
            const consistency = Math.max(0, 15 - speedVariance / 2);
            score += consistency;
            
            // 5. Bonus for Character Practice (10 points)
            if (currentPractice) {
                score += 10;
            }
            
            // Round and cap score
            score = Math.round(Math.min(score, 100));
            
            // Update high score
            if (score > SUPREME_STATE.gameStats.strokeBestScore) {
                SUPREME_STATE.gameStats.strokeBestScore = score;
            }
            
            // Display result
            displayStrokeScore(score);
            
            // Add XP based on score
            const xpReward = Math.round(score / 5);
            addXP(xpReward, `Stroke Analysis: ${score}/100`);
            
            checkAchievements();
            saveSupremeState();
        }

        function displayStrokeScore(score) {
            const scoreDisplay = document.getElementById('strokeScoreDisplay');
            const scoreNumber = document.getElementById('strokeScore');
            const feedback = document.getElementById('strokeFeedback');
            
            scoreNumber.textContent = score;
            
            let feedbackText = '';
            let feedbackColor = '';
            
            if (score >= 90) {
                feedbackText = 'üèÜ SEMPURNA! Tulisan master!';
                feedbackColor = 'text-green-400';
            } else if (score >= 75) {
                feedbackText = '‚≠ê BAGUS SEKALI! Terus berlatih!';
                feedbackColor = 'text-blue-400';
            } else if (score >= 60) {
                feedbackText = 'üëç LUMAYAN! Ada peningkatan!';
                feedbackColor = 'text-yellow-400';
            } else if (score >= 40) {
                feedbackText = 'üí™ CUKUP! Perlu latihan lagi!';
                feedbackColor = 'text-orange-400';
            } else {
                feedbackText = 'üìù PERLU BANYAK LATIHAN!';
                feedbackColor = 'text-red-400';
            }
            
            feedback.innerHTML = `<span class="${feedbackColor}">${feedbackText}</span>`;
            scoreDisplay.classList.remove('hidden');
        }

        // ==================== MATCHING GAME ====================
        let matchingGameData = [];
        let selectedCards = [];
        let matchedPairs = 0;
        let gameScore = 0;

        function startMatchingGame() {
            // Reset game state
            matchedPairs = 0;
            selectedCards = [];
            gameScore = 0;
            document.getElementById('gameScore').textContent = gameScore;
            document.getElementById('gameResult').classList.add('hidden');
            
            // Select 5 random vocab for matching
            const shuffled = [...VOCAB_DATABASE].sort(() => Math.random() - 0.5).slice(0, 5);
            matchingGameData = shuffled;
            
            // Create two columns: Chinese characters and meanings
            const chinese = shuffled.map((v, idx) => ({ id: idx, text: v.hanzi, type: 'chinese', pairId: idx }));
            const meanings = shuffled.map((v, idx) => ({ id: idx + 5, text: v.meaning, type: 'meaning', pairId: idx }));
            
            // Shuffle meanings
            meanings.sort(() => Math.random() - 0.5);
            
            const container = document.getElementById('matchingGameContainer');
            container.innerHTML = `
                <div class="matching-column">
                    <h3 class="font-bold text-xl mb-4 text-center">Karakter Mandarin</h3>
                    ${chinese.map(c => `
                        <div class="matching-card" data-id="${c.id}" data-pair="${c.pairId}" data-type="${c.type}" onclick="selectMatchingCard(this)">
                            ${c.text}
                        </div>
                    `).join('')}
                </div>
                <div class="matching-column">
                    <h3 class="font-bold text-xl mb-4 text-center">Arti Indonesia</h3>
                    ${meanings.map(m => `
                        <div class="matching-card" data-id="${m.id}" data-pair="${m.pairId}" data-type="${m.type}" onclick="selectMatchingCard(this)">
                            ${m.text}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function selectMatchingCard(element) {
            // Ignore if already matched or already 2 selected
            if (element.classList.contains('matched') || selectedCards.length >= 2) return;
            
            // Toggle selection
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                selectedCards = selectedCards.filter(c => c !== element);
            } else {
                element.classList.add('selected');
                selectedCards.push(element);
            }
            
            // Check match when 2 cards selected
            if (selectedCards.length === 2) {
                setTimeout(() => checkMatchingPair(), 500);
            }
        }

        function checkMatchingPair() {
            const [card1, card2] = selectedCards;
            const pair1 = card1.getAttribute('data-pair');
            const pair2 = card2.getAttribute('data-pair');
            
            if (pair1 === pair2) {
                // Match!
                card1.classList.remove('selected');
                card2.classList.remove('selected');
                card1.classList.add('matched');
                card2.classList.add('matched');
                
                matchedPairs++;
                gameScore += 20;
                document.getElementById('gameScore').textContent = gameScore;
                
                addXP(10, 'Matching Game - Pair Matched');
                
                // Check if game complete
                if (matchedPairs === 5) {
                    setTimeout(() => completeMatchingGame(), 500);
                }
            } else {
                // No match
                card1.classList.add('wrong');
                card2.classList.add('wrong');
                
                setTimeout(() => {
                    card1.classList.remove('selected', 'wrong');
                    card2.classList.remove('selected', 'wrong');
                }, 800);
            }
            
            selectedCards = [];
        }

        function completeMatchingGame() {
            document.getElementById('gameResult').classList.remove('hidden');
            document.getElementById('finalGameScore').textContent = gameScore;
            
            SUPREME_STATE.gameStats.matchingWins++;
            addXP(50, 'Matching Game Complete');
            checkAchievements();
            saveSupremeState();
            
            showNotification('üéâ Game Selesai! +50 XP!');
        }

        // ==================== FLASHCARD SYSTEM ====================
        let flashcardIndex = 0;
        let flashcardDeck = [];
        let isFlipped = false;
        let studyStartTime = Date.now();
        let studyTimerInterval;

        function startStudyTimer() {
            studyTimerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - studyStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                const timerEl = document.getElementById('flashcardTimer');
                if (timerEl) {
                    timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        function initFlashcards() {
            flashcardDeck = VOCAB_DATABASE.slice(0, 20);
            flashcardIndex = 0;
            showFlashcard();
        }

        function showFlashcard() {
            if (flashcardIndex >= flashcardDeck.length) {
                showNotification('üéâ Semua kartu selesai!');
                addXP(50, 'Menyelesaikan sesi flashcard');
                return;
            }
            
            const card = flashcardDeck[flashcardIndex];
            document.getElementById('flashcardFront').textContent = card.hanzi;
            document.getElementById('flashcardBack').textContent = `${card.pinyin}\n${card.meaning}`;
            document.getElementById('cardProgress').textContent = `${flashcardIndex + 1}/${flashcardDeck.length}`;
            document.getElementById('cardProgressBar').style.width = ((flashcardIndex + 1) / flashcardDeck.length * 100) + '%';
            
            document.getElementById('currentFlashcard').classList.remove('flipped');
            isFlipped = false;
        }

        function flipCard() {
            const card = document.getElementById('currentFlashcard');
            card.classList.toggle('flipped');
            isFlipped = !isFlipped;
        }

        function rateCard(difficulty) {
            const xpRewards = { easy: 10, medium: 15, hard: 20 };
            addXP(xpRewards[difficulty], `Flashcard: ${difficulty}`);
            
            flashcardIndex++;
            showFlashcard();
        }

        // ==================== QUIZ SYSTEM ====================
        let quizData = [];
        let currentQuiz = 0;
        let quizScore = 0;
        let quizType = 'translation';

        function startQuiz(type) {
            quizType = type;
            quizScore = 0;
            currentQuiz = 0;
            
            // Generate 10 random questions
            quizData = [];
            const shuffled = [...VOCAB_DATABASE].sort(() => Math.random() - 0.5);
            
            for (let i = 0; i < 10 && i < shuffled.length; i++) {
                const correct = shuffled[i];
                const wrongOptions = shuffled.filter(v => v.id !== correct.id)
                    .sort(() => Math.random() - 0.5)
                    .slice(0, 3);
                
                const options = [correct, ...wrongOptions].sort(() => Math.random() - 0.5);
                
                quizData.push({
                    correct: correct,
                    options: options,
                    correctIndex: options.indexOf(correct)
                });
            }
            
            showQuizQuestion();
        }

        function showQuizQuestion() {
            if (currentQuiz >= quizData.length) {
                endQuiz();
                return;
            }
            
            const q = quizData[currentQuiz];
            document.getElementById('quizNumber').textContent = currentQuiz + 1;
            document.getElementById('quizScore').textContent = quizScore;
            document.getElementById('quizProgressBar').style.width = ((currentQuiz + 1) / quizData.length * 100) + '%';
            
            if (quizType === 'translation') {
                document.getElementById('quizQuestion').textContent = q.correct.hanzi;
                document.getElementById('quizHint').textContent = 'Apa arti dari karakter di atas?';
                document.getElementById('quizOptions').innerHTML = q.options.map((opt, idx) => 
                    `<div class="quiz-option" onclick="checkAnswer(${idx})">${opt.meaning}</div>`
                ).join('');
            } else if (quizType === 'pinyin') {
                document.getElementById('quizQuestion').textContent = q.correct.hanzi;
                document.getElementById('quizHint').textContent = 'Pilih pinyin yang benar:';
                document.getElementById('quizOptions').innerHTML = q.options.map((opt, idx) => 
                    `<div class="quiz-option" onclick="checkAnswer(${idx})">${opt.pinyin}</div>`
                ).join('');
            } else {
                const randType = Math.random() > 0.5;
                if (randType) {
                    document.getElementById('quizQuestion').textContent = q.correct.hanzi;
                    document.getElementById('quizHint').textContent = 'Apa arti dari karakter di atas?';
                    document.getElementById('quizOptions').innerHTML = q.options.map((opt, idx) => 
                        `<div class="quiz-option" onclick="checkAnswer(${idx})">${opt.meaning}</div>`
                    ).join('');
                } else {
                    document.getElementById('quizQuestion').textContent = q.correct.meaning;
                    document.getElementById('quizHint').textContent = 'Pilih karakter yang benar:';
                    document.getElementById('quizOptions').innerHTML = q.options.map((opt, idx) => 
                        `<div class="quiz-option" onclick="checkAnswer(${idx})">${opt.hanzi}</div>`
                    ).join('');
                }
            }
        }

        function checkAnswer(selected) {
            const q = quizData[currentQuiz];
            const options = document.querySelectorAll('.quiz-option');
            
            if (selected === q.correctIndex) {
                options[selected].classList.add('correct');
                quizScore += 10;
                addXP(10, 'Jawaban quiz benar');
            } else {
                options[selected].classList.add('wrong');
                options[q.correctIndex].classList.add('correct');
            }
            
            setTimeout(() => {
                currentQuiz++;
                showQuizQuestion();
            }, 1500);
        }

        function endQuiz() {
            document.getElementById('quizQuestion').textContent = `Quiz Selesai!`;
            document.getElementById('quizHint').textContent = `Skor Anda: ${quizScore}/100`;
            document.getElementById('quizOptions').innerHTML = `
                <div class="text-center p-6">
                    <div class="text-6xl mb-4">${quizScore >= 80 ? 'üèÜ' : quizScore >= 60 ? 'üëç' : 'üí™'}</div>
                    <p class="text-2xl font-bold mb-4">${quizScore >= 80 ? 'Hebat!' : quizScore >= 60 ? 'Bagus!' : 'Terus berlatih!'}</p>
                    <button onclick="switchTab('quiz')" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold">Coba Lagi</button>
                </div>
            `;
            
            SUPREME_STATE.history.quizScores.push({
                score: quizScore,
                type: quizType,
                date: new Date().toISOString()
            });
            
            if (quizScore === 100) {
                if (!SUPREME_STATE.achievements[6].unlocked) {
                    SUPREME_STATE.achievements[6].unlocked = true;
                    showNotification('üèÜ Achievement: Perfect Quiz!');
                }
            }
            
            saveSupremeState();
        }

        // ==================== TONE TRAINER GAME ====================
        let toneGameActive = false;
        let toneScore = 0;
        let toneLevel = 1;
        let currentTone = 0;
        const toneSyllables = ['ma', 'ni', 'hao', 'chi', 'shui', 'ren', 'wo', 'ta'];
        const toneMarks = {
            1: { a: 'ƒÅ', e: 'ƒì', i: 'ƒ´', o: '≈ç', u: '≈´' },
            2: { a: '√°', e: '√©', i: '√≠', o: '√≥', u: '√∫' },
            3: { a: '«é', e: 'ƒõ', i: '«ê', o: '«í', u: '«î' },
            4: { a: '√†', e: '√®', i: '√¨', o: '√≤', u: '√π' }
        };

        function startToneGame() {
            toneGameActive = true;
            toneScore = 0;
            toneLevel = 1;
            document.getElementById('toneScore').textContent = toneScore;
            document.getElementById('toneLevel').textContent = toneLevel;
            document.getElementById('toneGameContainer').classList.remove('hidden');
            
            nextToneQuestion();
        }

        function nextToneQuestion() {
            currentTone = Math.floor(Math.random() * 4) + 1;
            const syllable = toneSyllables[Math.floor(Math.random() * toneSyllables.length)];
            
            let displaySyllable = syllable;
            for (let vowel in toneMarks[currentTone]) {
                if (syllable.includes(vowel)) {
                    displaySyllable = syllable.replace(vowel, toneMarks[currentTone][vowel]);
                    break;
                }
            }
            
            document.getElementById('toneCharacter').textContent = displaySyllable;
            document.getElementById('toneFeedback').textContent = '';
            
            document.querySelectorAll('.tone-option').forEach(opt => {
                opt.classList.remove('tone-correct', 'tone-wrong');
            });
            
            playCurrentTone();
        }

        function playCurrentTone() {
            if ('speechSynthesis' in window) {
                const syllable = document.getElementById('toneCharacter').textContent;
                const utterance = new SpeechSynthesisUtterance(syllable);
                utterance.lang = 'zh-CN';
                utterance.rate = 0.6;
                
                const pitchMap = { 1: 1.5, 2: 1.2, 3: 0.8, 4: 0.5 };
                utterance.pitch = pitchMap[currentTone] || 1;
                
                speechSynthesis.speak(utterance);
            }
        }

        function checkTone(selected) {
            const options = document.querySelectorAll('.tone-option');
            
            if (selected === currentTone) {
                options[selected - 1].classList.add('tone-correct');
                toneScore += 10;
                document.getElementById('toneScore').textContent = toneScore;
                document.getElementById('toneFeedback').innerHTML = '‚úÖ <span style="color: green;">BENAR!</span>';
                addXP(5, 'Tone quiz benar');
                
                if (toneScore > SUPREME_STATE.gameStats.toneHighScore) {
                    SUPREME_STATE.gameStats.toneHighScore = toneScore;
                }
                
                if (toneScore % 50 === 0) {
                    toneLevel++;
                    document.getElementById('toneLevel').textContent = toneLevel;
                    showNotification(`üéâ Level Up! Tone Level ${toneLevel}`);
                }
                
                setTimeout(() => {
                    nextToneQuestion();
                }, 1500);
            } else {
                options[selected - 1].classList.add('tone-wrong');
                options[currentTone - 1].classList.add('tone-correct');
                document.getElementById('toneFeedback').innerHTML = `‚ùå <span style="color: red;">SALAH! Nada yang benar: ${currentTone}</span>`;
                
                setTimeout(() => {
                    nextToneQuestion();
                }, 2000);
            }
            
            checkAchievements();
            saveSupremeState();
        }

        // ==================== SMART CHATBOT ====================
        function sendChat() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addChatMessage(message, 'user');
            input.value = '';
            
            setTimeout(() => {
                const response = getAIResponse(message);
                addChatMessage(response, 'bot');
            }, 500);
        }

        function quickChat(message) {
            document.getElementById('chatInput').value = message;
            sendChat();
        }

        function addChatMessage(text, sender) {
            const container = document.getElementById('chatMessages');
            const msgDiv = document.createElement('div');
            msgDiv.className = `chat-message chat-${sender}`;
            msgDiv.textContent = text;
            container.appendChild(msgDiv);
            container.scrollTop = container.scrollHeight;
        }

        function getAIResponse(message) {
            const msg = message.toLowerCase();
            
            for (let topic in CHATBOT_KNOWLEDGE.grammar) {
                if (msg.includes(topic) || msg.includes(topic.replace(' ', ''))) {
                    return CHATBOT_KNOWLEDGE.grammar[topic];
                }
            }
            
            if (msg.includes('nada') || msg.includes('tone') || msg.includes('Â£∞')) {
                for (let topic in CHATBOT_KNOWLEDGE.tones) {
                    if (msg.includes(topic.split(' ')[0])) {
                        return CHATBOT_KNOWLEDGE.tones[topic];
                    }
                }
                return CHATBOT_KNOWLEDGE.tones['sistem nada'];
            }
            
            if (msg.includes('budaya') || msg.includes('culture') || msg.includes('tradisi') || msg.includes('festival')) {
                for (let topic in CHATBOT_KNOWLEDGE.culture) {
                    if (msg.includes(topic.split(' ')[0])) {
                        return CHATBOT_KNOWLEDGE.culture[topic];
                    }
                }
                return CHATBOT_KNOWLEDGE.culture['festivals'];
            }
            
            if (msg.includes('hsk')) {
                return CHATBOT_KNOWLEDGE.hsk['what is hsk'];
            }
            
            if (msg.includes('tips') || msg.includes('cara belajar') || msg.includes('belajar efektif')) {
                return CHATBOT_KNOWLEDGE.tips['belajar efektif'];
            }
            
            if (msg.includes('mnemonik') || msg.includes('cara mengingat') || msg.includes('teknik')) {
                return CHATBOT_KNOWLEDGE.tips['mnemonics'];
            }
            
            const vocab = VOCAB_DATABASE.find(v => 
                msg.includes(v.hanzi) || 
                msg.includes(v.pinyin) || 
                msg.includes(v.meaning.toLowerCase())
            );
            
            if (vocab) {
                return `üìö ${vocab.hanzi} (${vocab.pinyin}):\nArti: ${vocab.meaning}\nHSK: Level ${vocab.hsk}\nKategori: ${vocab.category}\n\nContoh kalimat akan segera ditambahkan!`;
            }
            
            const defaults = [
                'Pertanyaan menarik! Saya bisa membantu dengan: grammar (ÁöÑÂæóÂú∞, partikel, tenses), nada, budaya China, HSK, tips belajar, atau jelaskan kata-kata tertentu. Coba tanya yang lebih spesifik! üòä',
                'Maaf, saya belum punya info tentang itu. Coba tanya tentang: grammar Mandarin, sistem nada, budaya China, HSK, atau tips belajar efektif!',
                'Hmm, itu di luar knowledge base saya. Tapi saya expert di: ÁöÑÂæóÂú∞, measure words, nada Mandarin, festival China, HSK, dan teknik belajar. Tanya yuk! üéì'
            ];
            
            return defaults[Math.floor(Math.random() * defaults.length)];
        }

        // ==================== AI SUGGESTION ====================
        function updateAISuggestion() {
            const suggestions = [
                'Berdasarkan progress Anda, coba fokus ke kata-kata HSK ' + (SUPREME_STATE.profile.level <= 3 ? '1-2' : SUPREME_STATE.profile.level <= 6 ? '3-4' : '5-6') + '!',
                'Anda sudah menguasai greeting! Saatnya belajar angka dan waktu.',
                'Latih nada 3 dan 4 di Tone Trainer untuk meningkatkan akurasi!',
                'Coba Voice Check untuk melatih pelafalan yang lebih baik!',
                'Mainkan Matching Game untuk menghafal vocab dengan cara fun!',
                'Fokus pada 50 kata paling umum dulu sebelum ke level advanced.',
                'Luangkan 15 menit setiap hari untuk flashcard review.',
                'Gunakan Canvas untuk latihan menulis karakter dengan AI analysis!'
            ];
            
            const random = suggestions[Math.floor(Math.random() * suggestions.length)];
            const element = document.getElementById('aiSuggestion');
            if (element) {
                element.textContent = random;
            }
        }

        // ==================== DATA EXPORT/IMPORT ====================
        function exportData() {
            const dataStr = JSON.stringify(SUPREME_STATE, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `wang_weize_supreme_${Date.now()}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showNotification('üì• Data berhasil diexport!');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    
                    if (imported.profile && imported.history && imported.vocabulary) {
                        SUPREME_STATE = imported;
                        saveSupremeState();
                        renderDashboard();
                        renderVocabGrid();
                        showNotification('üì§ Data berhasil diimport!');
                        location.reload();
                    } else {
                        alert('File tidak valid!');
                    }
                } catch(err) {
                    alert('Error membaca file: ' + err.message);
                }
            };
            reader.readAsText(file);
        }

        function resetAllData() {
            if (confirm('‚ö†Ô∏è PERINGATAN! Semua progress akan hilang. Lanjutkan?')) {
                if (confirm('Yakin? Data tidak bisa dikembalikan!')) {
                    localStorage.removeItem('wangWeizeSupreme');
                    location.reload();
                }
            }
        }

        // ==================== TAB NAVIGATION ====================
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden-tab');
            });
            
            document.getElementById(tabName).classList.remove('hidden-tab');
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active-nav');
            });
            event.currentTarget.classList.add('active-nav');
            
            if (tabName === 'flashcard') {
                initFlashcards();
            }
            
            if (tabName === 'game') {
                // Game tab opened
            }
            
            window.scrollTo(0, 0);
        }

        // ==================== IMPERIAL PARTICLES ====================
        function createParticles() {
            const container = document.getElementById('particleContainer');
            const particles = ['Èæô', 'Á¶è', 'Èáë', '‚ú®', 'üèÆ', 'üéã', 'Áéã', 'Ê±™', 'üí∞'];
            
            setInterval(() => {
                if (Math.random() > 0.7) {
                    const particle = document.createElement('div');
                    particle.className = 'imperial-particle';
                    particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDuration = (Math.random() * 3 + 5) + 's';
                    container.appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 8000);
                }
            }, 2000);
        }

        // CSS Animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(400px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(400px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
