<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÆ Wang Weize | Supreme Imlek Edition - ANGPAO GRINDING SYSTEM üßß</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@700;900&family=Playfair+Display:wght@900&family=Cormorant+Garamond:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --imperial-red: #8B0000; 
            --deep-red: #B22222;
            --emperor-gold: #FFD700; 
            --luxury-gold: #FFC107;
            --rice-paper: #FDF6E3; 
        }
        body { 
            background: linear-gradient(135deg, #1a0000 0%, #4a0000 100%);
            color: var(--emperor-gold); 
            font-family: 'Noto Serif SC', serif; 
            overflow-x: hidden; 
            padding-bottom: 120px; 
            position: relative;
        }
        
        /* WELCOME OVERLAY - ANGPAO SPLASH */
        #welcomeOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(139,0,0,0.98) 0%, rgba(178,34,34,0.98) 100%);
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            transition: opacity 1s ease-out;
        }
        
        #welcomeOverlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        
        .angpao-btn {
            background: linear-gradient(135deg, var(--emperor-gold), var(--luxury-gold));
            color: var(--imperial-red);
            font-size: 28px;
            font-weight: 900;
            padding: 30px 60px;
            border-radius: 20px;
            border: 5px solid var(--imperial-red);
            cursor: pointer;
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.5), inset 0 -5px 15px rgba(0,0,0,0.2);
            animation: pulse-angpao 2s infinite;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.3s;
        }
        
        .angpao-btn:hover {
            transform: scale(1.1);
        }
        
        @keyframes pulse-angpao {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .welcome-title {
            font-size: 48px;
            color: var(--emperor-gold);
            margin-bottom: 40px;
            text-shadow: 0 0 20px rgba(255,215,0,0.5);
            font-family: 'Playfair Display', serif;
        }
        
        /* AUDIO CONTROLS */
        .audio-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            background: linear-gradient(135deg, var(--emperor-gold), var(--luxury-gold));
            border: 3px solid var(--imperial-red);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(255,215,0,0.5);
            transition: transform 0.3s;
        }
        
        .audio-controls:hover {
            transform: scale(1.1);
        }
        
        .audio-controls span {
            font-size: 30px;
        }
        
        /* ANGPAO WALLET DISPLAY */
        .angpao-wallet {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--emperor-gold), var(--luxury-gold));
            padding: 20px 30px;
            border-radius: 20px;
            border: 4px solid var(--imperial-red);
            box-shadow: 0 10px 30px rgba(255,215,0,0.5);
            z-index: 9998;
            min-width: 300px;
        }
        
        .angpao-wallet-title {
            font-size: 16px;
            color: var(--imperial-red);
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .angpao-saldo {
            font-size: 32px;
            color: var(--imperial-red);
            font-weight: 900;
            font-family: monospace;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .withdraw-btn {
            background: var(--imperial-red);
            color: var(--emperor-gold);
            padding: 12px 25px;
            border-radius: 15px;
            border: 3px solid var(--emperor-gold);
            font-weight: 900;
            cursor: pointer;
            margin-top: 15px;
            width: 100%;
            font-size: 16px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(139,0,0,0.5);
        }
        
        .withdraw-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(139,0,0,0.7);
        }
        
        .withdraw-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* WITHDRAWAL MODAL */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 99998;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #fff 0%, #f8f8f8 100%);
            padding: 40px;
            border-radius: 30px;
            border: 5px solid var(--emperor-gold);
            box-shadow: 0 20px 60px rgba(255,215,0,0.5);
            max-width: 500px;
            width: 90%;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: var(--imperial-red);
            font-weight: bold;
        }
        
        .modal-title {
            font-size: 32px;
            color: var(--imperial-red);
            font-weight: 900;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 16px;
            color: var(--imperial-red);
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 15px;
            border: 3px solid var(--emperor-gold);
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            outline: none;
            transition: 0.3s;
        }
        
        .form-input:focus, .form-select:focus {
            border-color: var(--imperial-red);
            box-shadow: 0 0 15px rgba(255,215,0,0.3);
        }
        
        .submit-btn {
            background: linear-gradient(135deg, var(--emperor-gold), var(--luxury-gold));
            color: var(--imperial-red);
            padding: 18px;
            border-radius: 20px;
            border: 4px solid var(--imperial-red);
            font-weight: 900;
            font-size: 20px;
            cursor: pointer;
            width: 100%;
            margin-top: 25px;
            transition: transform 0.3s;
            box-shadow: 0 10px 25px rgba(255,215,0,0.5);
        }
        
        .submit-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(255,215,0,0.7);
        }
        
        .emperor-name { 
            font-family: 'Playfair Display', serif; 
            font-size: clamp(3rem, 8vw, 6.5rem); 
            font-weight: 900; 
            color: #ffffff; 
            -webkit-text-stroke: 2.5px var(--imperial-red);
            text-shadow: 4px 4px 0 var(--emperor-gold), 8px 8px 20px rgba(255,215,0,0.8); 
            letter-spacing: 6px; 
            display: inline-block; 
            line-height: 1.2;
            padding: 15px;
            filter: drop-shadow(0 5px 15px rgba(255,215,0,0.4));
        }
        
        .gong-xi {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 48px;
            color: var(--emperor-gold);
            text-shadow: 0 0 20px rgba(255,215,0,0.8), 3px 3px 6px rgba(0,0,0,0.5);
            margin-top: 20px;
            letter-spacing: 8px;
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 20px rgba(255,215,0,0.8), 3px 3px 6px rgba(0,0,0,0.5); }
            to { text-shadow: 0 0 40px rgba(255,215,0,1), 3px 3px 10px rgba(0,0,0,0.7); }
        }

        .glass-scroll { 
            background: rgba(253, 246, 227, 0.95); 
            backdrop-filter: blur(10px); 
            border: 3px solid var(--emperor-gold); 
            border-radius: 12px; 
            transition: 0.5s; 
            box-shadow: 0 10px 30px rgba(255,215,0,0.3); 
        }
        
        .hidden-tab { display: none !important; }
        .active-nav { 
            background: var(--emperor-gold) !important; 
            color: var(--imperial-red) !important; 
            transform: scale(1.05); 
            box-shadow: 0 -5px 15px rgba(255,215,0,0.5); 
        }
        
        .canvas-box { 
            position: relative; 
            width: 360px; 
            height: 360px; 
            margin: 0 auto; 
            background: #fff; 
            border: 6px double var(--emperor-gold); 
            border-radius: 10px; 
        }
        
        canvas { touch-action: none; cursor: crosshair; position: absolute; top: 0; left: 0; }
        
        .imperial-particle { 
            position: fixed; 
            top: -10px; 
            pointer-events: none; 
            z-index: 0; 
            opacity: 0.25; 
            animation: fall linear infinite; 
            font-size: 28px; 
        }
        
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }

        .vocab-card { 
            background: white; 
            border: 2px solid var(--emperor-gold); 
            border-radius: 16px; 
            padding: 20px; 
            box-shadow: 6px 6px 0 var(--emperor-gold); 
            transition: 0.3s; 
        }
        
        .vocab-card:hover { 
            transform: translateY(-5px); 
            border-color: var(--imperial-red); 
            box-shadow: 8px 8px 0 var(--imperial-red); 
        }
        
        .vocab-hanzi { 
            font-size: 42px; 
            font-family: 'Ma Shan Zheng', cursive; 
            color: var(--imperial-red); 
            text-shadow: 1px 1px 0 var(--emperor-gold); 
        }
        
        .vocab-btn { 
            width: 42px; 
            height: 42px; 
            border-radius: 50%; 
            border: 2px solid var(--emperor-gold); 
            background: var(--imperial-red); 
            color: var(--emperor-gold); 
            transition: 0.2s; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 20px; 
        }
        
        .vocab-btn:hover { 
            background: var(--emperor-gold); 
            color: var(--imperial-red); 
            transform: scale(1.1); 
        }
        
        .profil-container { 
            background: linear-gradient(145deg, #faf3e0, #f5e6d3); 
            border: 3px solid var(--emperor-gold); 
            border-radius: 40px; 
            box-shadow: 20px 20px 0 rgba(255,215,0,0.3); 
            padding: 40px; 
            position: relative; 
            overflow: hidden; 
        }
        
        .kartu-generasi { 
            background: rgba(255,255,255,0.8); 
            border: 2px solid var(--emperor-gold); 
            border-radius: 20px; 
            padding: 20px; 
            width: 220px; 
            box-shadow: 8px 8px 0 var(--emperor-gold); 
        }

        .learning-container { 
            background: white; 
            border-radius: 20px; 
            padding: 30px; 
            box-shadow: 0 15px 40px rgba(255,215,0,0.2); 
        }
        
        .search-wrapper { margin: 20px 0; }
        .search-wrapper input { 
            width: 100%; 
            padding: 15px 20px; 
            border: 3px solid var(--emperor-gold); 
            border-radius: 50px; 
            font-size: 16px; 
            font-weight: bold; 
            outline: none; 
            transition: 0.3s; 
        }
        
        .search-wrapper input:focus { 
            border-color: var(--imperial-red); 
            box-shadow: 0 0 20px rgba(255,215,0,0.3); 
        }
        
        .vocab-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 20px; 
            margin-top: 30px; 
        }

        .progress-bar { 
            height: 30px; 
            background: linear-gradient(90deg, var(--emperor-gold), var(--imperial-red)); 
            border-radius: 15px; 
            transition: width 0.5s; 
            box-shadow: 0 3px 10px rgba(255,215,0,0.3); 
        }
        
        .stat-card { 
            background: linear-gradient(135deg, #fff 0%, #f8f8f8 100%); 
            border: 2px solid var(--emperor-gold); 
            border-radius: 15px; 
            padding: 20px; 
            text-align: center; 
        }
        
        .ai-suggestion { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 15px; 
            border-radius: 10px; 
            margin: 10px 0; 
            animation: pulse 2s infinite; 
        }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        
        .badge { 
            display: inline-block; 
            background: var(--emperor-gold); 
            color: var(--imperial-red); 
            padding: 5px 15px; 
            border-radius: 20px; 
            font-weight: bold; 
            margin: 5px; 
            box-shadow: 0 3px 10px rgba(255,215,0,0.3); 
        }
        
        .level-badge { 
            font-size: 24px; 
            font-weight: 900; 
            color: var(--emperor-gold); 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3); 
        }
        
        .flashcard { perspective: 1000px; height: 300px; cursor: pointer; }
        .flashcard-inner { 
            position: relative; 
            width: 100%; 
            height: 100%; 
            transition: transform 0.6s; 
            transform-style: preserve-3d; 
        }
        
        .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            backface-visibility: hidden; 
            border-radius: 15px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 48px; 
            font-weight: bold; 
        }
        
        .flashcard-front { 
            background: linear-gradient(135deg, var(--imperial-red), #8B0000); 
            color: white; 
        }
        
        .flashcard-back { 
            background: linear-gradient(135deg, var(--emperor-gold), #DAA520); 
            color: var(--imperial-red); 
            transform: rotateY(180deg); 
        }
        
        .quiz-option { 
            background: white; 
            border: 3px solid var(--emperor-gold); 
            padding: 15px; 
            border-radius: 10px; 
            cursor: pointer; 
            transition: 0.3s; 
            margin: 10px 0; 
        }
        
        .quiz-option:hover { 
            background: var(--rice-paper); 
            transform: translateX(10px); 
        }
        
        .quiz-option.correct { background: #4ade80; border-color: #16a34a; }
        .quiz-option.wrong { background: #f87171; border-color: #dc2626; }
        
        .tone-visual { 
            height: 80px; 
            background: linear-gradient(to top, #e0e0e0, white); 
            border-radius: 10px; 
            position: relative; 
            overflow: hidden; 
            margin: 20px 0; 
        }
        
        .tone-line { 
            position: absolute; 
            left: 0; 
            width: 100%; 
            height: 4px; 
            background: var(--imperial-red); 
            transition: all 0.3s; 
        }
        
        .radical-part { 
            display: inline-block; 
            padding: 5px 10px; 
            margin: 5px; 
            background: rgba(255,215,0,0.2); 
            border: 2px solid var(--emperor-gold); 
            border-radius: 8px; 
            font-family: 'Ma Shan Zheng', cursive; 
            font-size: 24px; 
            cursor: help; 
            transition: 0.3s; 
        }
        
        .radical-part:hover { 
            background: var(--emperor-gold); 
            transform: scale(1.2); 
        }
        
        .stroke-analysis { 
            border: 2px dashed var(--emperor-gold); 
            padding: 15px; 
            border-radius: 10px; 
            margin: 15px 0; 
            background: rgba(255,215,0,0.1); 
        }
        
        .srs-indicator { height: 10px; border-radius: 5px; margin: 10px 0; }
        .srs-new { background: #60a5fa; }
        .srs-learning { background: #fbbf24; }
        .srs-review { background: #34d399; }
        .srs-master { background: #a78bfa; }
        
        .context-sentence { 
            background: rgba(255,255,255,0.9); 
            border-left: 4px solid var(--emperor-gold); 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            font-style: italic; 
        }
        
        .pronunciation-heat { display: inline-block; padding: 3px 8px; border-radius: 5px; margin: 2px; }
        .heat-1 { background: #dcfce7; }
        .heat-2 { background: #fef3c7; }
        .heat-3 { background: #fecaca; }
        
        .streak-day { 
            width: 30px; 
            height: 30px; 
            border-radius: 5px; 
            display: inline-block; 
            margin: 3px; 
        }
        
        .streak-complete { background: var(--emperor-gold); }
        .streak-incomplete { background: #e5e5e5; }
        
        .leaderboard-item { 
            background: white; 
            border: 2px solid var(--emperor-gold); 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 10px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        .rank-medal { font-size: 32px; }
        
        .ar-viewer { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 30px; 
            border-radius: 15px; 
            text-align: center; 
            margin: 20px 0; 
        }
        
        .waveform { 
            height: 60px; 
            background: #f0f0f0; 
            border-radius: 10px; 
            position: relative; 
            overflow: hidden; 
        }
        
        .wave-bar { 
            display: inline-block; 
            width: 4px; 
            background: var(--imperial-red); 
            margin: 0 2px; 
            animation: wave 1s infinite ease-in-out; 
        }
        
        @keyframes wave { 0%, 100% { height: 10px; } 50% { height: 50px; } }
        
        .achievement-popup { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: linear-gradient(135deg, var(--emperor-gold), #DAA520); 
            color: var(--imperial-red); 
            padding: 20px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(255,215,0,0.5); 
            z-index: 1000; 
            animation: slideIn 0.5s; 
        }
        
        @keyframes slideIn { from { transform: translateX(400px); } to { transform: translateX(0); } }
        
        .study-timer { 
            font-size: 48px; 
            font-weight: 900; 
            color: var(--emperor-gold); 
            text-align: center; 
            font-family: monospace; 
        }
        
        .difficulty-btn { 
            padding: 10px 20px; 
            margin: 5px; 
            border: 2px solid var(--emperor-gold); 
            border-radius: 20px; 
            cursor: pointer; 
            transition: 0.3s; 
            background: white; 
        }
        
        .difficulty-btn.active { 
            background: var(--imperial-red); 
            color: white; 
        }
    </style>
</head>
<body>
    <!-- AUDIO BGM -->
    <audio id="bgm" loop preload="auto">
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>

    <!-- WELCOME OVERLAY - ANGPAO SPLASH SCREEN -->
    <div id="welcomeOverlay">
        <div class="welcome-title">üèÆ ÊÅ≠ÂñúÂèëË¥¢ üèÆ</div>
        <button class="angpao-btn" onclick="openAngpao()">
            üßß KLIK UNTUK BUKA ANGPAO<br>DARI BOSS WANG WEIZE
        </button>
    </div>

    <!-- AUDIO CONTROLS -->
    <div class="audio-controls" id="audioToggle" style="display:none;">
        <span id="audioIcon">üîä</span>
    </div>

    <!-- ANGPAO WALLET DISPLAY -->
    <div class="angpao-wallet" style="display:none;" id="angpaoWallet">
        <div class="angpao-wallet-title">üí∞ SALDO ANGPAO üí∞</div>
        <div class="angpao-saldo">Rp <span id="saldoDisplay">0</span></div>
        <button class="withdraw-btn" id="withdrawBtn" onclick="openWithdrawModal()">
            üè¶ TARIK SALDO ANGPAO
        </button>
    </div>

    <!-- WITHDRAWAL MODAL -->
    <div class="modal-overlay" id="withdrawModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeWithdrawModal()">&times;</span>
            <div class="modal-title">üßß KLAIM ANGPAO üßß</div>
            <form id="withdrawForm" onsubmit="submitWithdraw(event)">
                <div class="form-group">
                    <label class="form-label">E-Wallet</label>
                    <select class="form-select" id="ewallet" required>
                        <option value="">Pilih E-Wallet</option>
                        <option value="DANA">üí≥ DANA</option>
                        <option value="OVO">üí≥ OVO</option>
                        <option value="GoPay">üí≥ GoPay</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Nama Lengkap</label>
                    <input type="text" class="form-input" id="fullname" placeholder="Masukkan nama lengkap" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Nomor Rekening / HP</label>
                    <input type="text" class="form-input" id="accountno" placeholder="08xxxxxxxxxx" required>
                </div>
                <button type="submit" class="submit-btn">
                    üéâ KLAIM KE BOSS WANG WEIZE
                </button>
            </form>
        </div>
    </div>

    <!-- Particle Container -->
    <div id="particle-container"></div>

    <!-- Header -->
    <div class="text-center py-12 relative z-10">
        <h1 class="emperor-name">WANG WEIZE</h1>
        <div class="gong-xi">ÊÅ≠ÂñúÂèëË¥¢</div>
        <p class="text-2xl mt-4 font-bold" style="color: var(--emperor-gold); text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
            ‚ö° Imperial Mandarin Authority - Supreme Imlek Edition ‚ö°
        </p>
    </div>

    <!-- Navigation -->
    <div class="flex justify-center mb-8 gap-3 flex-wrap px-4 relative z-10">
        <button class="px-6 py-3 rounded-lg font-bold transition-all duration-300 active-nav" style="background: var(--emperor-gold); color: var(--imperial-red); border: 2px solid var(--imperial-red);" onclick="showTab('profil')">
            üëë Profil Sultan
        </button>
        <button class="px-6 py-3 rounded-lg font-bold transition-all duration-300" style="background: rgba(255,255,255,0.9); color: var(--imperial-red); border: 2px solid var(--emperor-gold);" onclick="showTab('latihan')">
            ‚úçÔ∏è Latihan Menulis
        </button>
        <button class="px-6 py-3 rounded-lg font-bold transition-all duration-300" style="background: rgba(255,255,255,0.9); color: var(--imperial-red); border: 2px solid var(--emperor-gold);" onclick="showTab('vocab')">
            üìö Kosakata VIP
        </button>
        <button class="px-6 py-3 rounded-lg font-bold transition-all duration-300" style="background: rgba(255,255,255,0.9); color: var(--imperial-red); border: 2px solid var(--emperor-gold);" onclick="showTab('flashcard')">
            üé¥ Flashcard Master
        </button>
        <button class="px-6 py-3 rounded-lg font-bold transition-all duration-300" style="background: rgba(255,255,255,0.9); color: var(--imperial-red); border: 2px solid var(--emperor-gold);" onclick="showTab('quiz')">
            üéØ Quiz Challenge
        </button>
        <button class="px-6 py-3 rounded-lg font-bold transition-all duration-300" style="background: rgba(255,255,255,0.9); color: var(--imperial-red); border: 2px solid var(--emperor-gold);" onclick="showTab('ai')">
            ü§ñ AI Tutor Pro
        </button>
        <button class="px-6 py-3 rounded-lg font-bold transition-all duration-300" style="background: rgba(255,255,255,0.9); color: var(--imperial-red); border: 2px solid var(--emperor-gold);" onclick="showTab('progress')">
            üìä Progress Elite
        </button>
    </div>

    <!-- Main Content Container -->
    <div class="max-w-7xl mx-auto px-4 relative z-10">
        
        <!-- PROFIL TAB -->
        <div id="tab-profil" class="tab-content">
            <div class="profil-container">
                <div class="text-center mb-10">
                    <h2 class="text-5xl font-black mb-6" style="color: var(--imperial-red); text-shadow: 3px 3px 6px rgba(255,215,0,0.5);">
                        üëë PROFIL SULTAN MANDARIN üëë
                    </h2>
                    <div class="text-6xl mb-4">üêâ</div>
                    <div class="text-3xl font-bold mb-2" style="color: var(--imperial-red);">Ê±™‰∏∫Ê≥Ω (WƒÅng W√©iz√©)</div>
                    <div class="level-badge mb-4">Level <span id="userLevel">1</span> - Rookie Emperor</div>
                    <div class="mb-4">
                        <span class="badge">üìö XP: <span id="xpDisplay">0</span></span>
                        <span class="badge">üî• Streak: <span id="streakDisplay">0</span> hari</span>
                        <span class="badge">‚úÖ Akurasi: <span id="accuracyDisplay">0</span>%</span>
                    </div>
                </div>

                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="stat-card">
                        <div class="text-4xl mb-3">üìù</div>
                        <div class="text-3xl font-black mb-2" style="color: var(--imperial-red);"><span id="charactersWritten">0</span></div>
                        <div class="text-sm font-semibold" style="color: var(--emperor-gold);">Karakter Ditulis</div>
                    </div>
                    <div class="stat-card">
                        <div class="text-4xl mb-3">üéØ</div>
                        <div class="text-3xl font-black mb-2" style="color: var(--imperial-red);"><span id="quizzesCompleted">0</span></div>
                        <div class="text-sm font-semibold" style="color: var(--emperor-gold);">Quiz Diselesaikan</div>
                    </div>
                    <div class="stat-card">
                        <div class="text-4xl mb-3">‚è±Ô∏è</div>
                        <div class="text-3xl font-black mb-2" style="color: var(--imperial-red);"><span id="studyTime">0</span> min</div>
                        <div class="text-sm font-semibold" style="color: var(--emperor-gold);">Waktu Belajar</div>
                    </div>
                </div>

                <div class="flex flex-wrap gap-6 justify-center">
                    <div class="kartu-generasi">
                        <div class="text-center">
                            <div class="text-5xl mb-4">üêâ</div>
                            <div class="text-2xl font-black mb-2" style="color: var(--imperial-red);">Generasi Z</div>
                            <div class="text-sm font-semibold mb-2" style="color: var(--emperor-gold);">Tech-Savvy Dragon</div>
                            <p class="text-xs leading-relaxed" style="color: #666;">
                                Menguasai bahasa digital dan tradisional. Multitasking master yang paham TikTok dan Hanzi!
                            </p>
                        </div>
                    </div>
                    
                    <div class="kartu-generasi">
                        <div class="text-center">
                            <div class="text-5xl mb-4">üí∞</div>
                            <div class="text-2xl font-black mb-2" style="color: var(--imperial-red);">Money Maker</div>
                            <div class="text-sm font-semibold mb-2" style="color: var(--emperor-gold);">Cuan Hunter Pro</div>
                            <p class="text-xs leading-relaxed" style="color: #666;">
                                Belajar bahasa = investasi masa depan. Setiap karakter = step closer to global domination!
                            </p>
                        </div>
                    </div>
                    
                    <div class="kartu-generasi">
                        <div class="text-center">
                            <div class="text-5xl mb-4">‚ö°</div>
                            <div class="text-2xl font-black mb-2" style="color: var(--imperial-red);">Speed Learner</div>
                            <div class="text-sm font-semibold mb-2" style="color: var(--emperor-gold);">Lightning Brain</div>
                            <p class="text-xs leading-relaxed" style="color: #666;">
                                Belajar cepat, ingat kuat. Skip boring stuff, langsung ke action! Time is money, bro!
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- LATIHAN TAB -->
        <div id="tab-latihan" class="tab-content hidden-tab">
            <div class="glass-scroll p-8">
                <h2 class="text-4xl font-black text-center mb-6" style="color: var(--imperial-red);">
                    ‚úçÔ∏è Latihan Menulis Hanzi (Mi Zi Ge)
                </h2>
                
                <div class="canvas-box">
                    <canvas id="grid-canvas" width="360" height="360"></canvas>
                    <canvas id="draw-canvas" width="360" height="360"></canvas>
                </div>

                <div class="mt-6 flex justify-center gap-4 flex-wrap">
                    <button class="px-6 py-3 rounded-lg font-bold transition-all" style="background: var(--imperial-red); color: var(--emperor-gold); border: 2px solid var(--emperor-gold);" onclick="clearCanvas()">
                        üóëÔ∏è Hapus
                    </button>
                    <button class="px-6 py-3 rounded-lg font-bold transition-all" style="background: var(--emperor-gold); color: var(--imperial-red); border: 2px solid var(--imperial-red);" onclick="saveDrawing()">
                        üíæ Simpan Karya
                    </button>
                </div>

                <div class="mt-8 bg-white rounded-xl p-6 border-4" style="border-color: var(--emperor-gold);">
                    <h3 class="text-2xl font-bold mb-4 text-center" style="color: var(--imperial-red);">üìú Riwayat Tulisan Terbaru</h3>
                    <div id="writing-history" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
                </div>
            </div>
        </div>

        <!-- VOCAB TAB -->
        <div id="tab-vocab" class="tab-content hidden-tab">
            <div class="learning-container">
                <h2 class="text-4xl font-black text-center mb-6" style="color: var(--imperial-red);">
                    üìö Kosakata VIP Premium
                </h2>

                <div class="search-wrapper">
                    <input type="text" id="vocab-search" placeholder="üîç Cari kosakata (Hanzi, Pinyin, atau Indonesia)..." oninput="searchVocab()">
                </div>

                <div class="flex justify-center gap-3 flex-wrap mb-6">
                    <button class="difficulty-btn active" onclick="filterDifficulty('all')">Semua</button>
                    <button class="difficulty-btn" onclick="filterDifficulty('beginner')">üå± Pemula</button>
                    <button class="difficulty-btn" onclick="filterDifficulty('intermediate')">üî• Menengah</button>
                    <button class="difficulty-btn" onclick="filterDifficulty('advanced')">üíé Mahir</button>
                </div>

                <div id="vocab-container" class="vocab-grid"></div>
            </div>
        </div>

        <!-- FLASHCARD TAB -->
        <div id="tab-flashcard" class="tab-content hidden-tab">
            <div class="learning-container">
                <h2 class="text-4xl font-black text-center mb-8" style="color: var(--imperial-red);">
                    üé¥ Flashcard Master System
                </h2>

                <div class="flashcard" id="flashcard" onclick="flipCard()">
                    <div class="flashcard-inner" id="flashcard-inner">
                        <div class="flashcard-front">
                            <div id="flashcard-question" style="font-family: 'Ma Shan Zheng', cursive;">‰Ω†Â•Ω</div>
                        </div>
                        <div class="flashcard-back">
                            <div id="flashcard-answer">N«ê h«éo<br><small style="font-size:24px;">Halo</small></div>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-8">
                    <p class="text-xl mb-4" style="color: var(--imperial-red); font-weight: bold;">
                        Kartu <span id="flashcard-count">1</span> dari <span id="flashcard-total">10</span>
                    </p>
                    <div class="flex justify-center gap-4">
                        <button class="px-8 py-4 rounded-xl font-bold transition-all text-xl" style="background: var(--emperor-gold); color: var(--imperial-red); border: 3px solid var(--imperial-red);" onclick="prevFlashcard()">
                            ‚¨ÖÔ∏è Sebelumnya
                        </button>
                        <button class="px-8 py-4 rounded-xl font-bold transition-all text-xl" style="background: var(--imperial-red); color: var(--emperor-gold); border: 3px solid var(--emperor-gold);" onclick="nextFlashcard()">
                            Selanjutnya ‚û°Ô∏è
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- QUIZ TAB -->
        <div id="tab-quiz" class="tab-content hidden-tab">
            <div class="learning-container">
                <h2 class="text-4xl font-black text-center mb-8" style="color: var(--imperial-red);">
                    üéØ Ultimate Quiz Challenge
                </h2>

                <div id="quizContent">
                    <div class="text-center mb-8">
                        <p class="text-2xl mb-6" style="color: var(--emperor-gold); font-weight: bold;">
                            Soal <span id="quizNumber">1</span> dari 10
                        </p>
                        <div class="bg-white rounded-2xl p-8 border-4 mb-6" style="border-color: var(--emperor-gold);">
                            <p id="quizQuestion" class="text-3xl font-bold mb-2" style="color: var(--imperial-red); font-family: 'Ma Shan Zheng', cursive;">
                                ‰Ω†Â•Ω
                            </p>
                            <p class="text-lg" style="color: var(--emperor-gold); font-weight: 600;">Apa arti dari karakter di atas?</p>
                        </div>
                    </div>

                    <div id="quizOptions" class="max-w-2xl mx-auto"></div>

                    <div class="text-center mt-8">
                        <button id="nextQuizBtn" class="px-10 py-4 rounded-xl font-bold text-xl transition-all hidden" style="background: var(--emperor-gold); color: var(--imperial-red); border: 3px solid var(--imperial-red);" onclick="nextQuiz()">
                            Soal Berikutnya ‚û°Ô∏è
                        </button>
                    </div>
                </div>

                <div id="quizResults" class="hidden">
                    <div class="text-center bg-white rounded-3xl p-12 border-4" style="border-color: var(--emperor-gold);">
                        <div class="text-7xl mb-6">üèÜ</div>
                        <h3 class="text-4xl font-black mb-4" style="color: var(--imperial-red);">Quiz Selesai!</h3>
                        <p class="text-3xl mb-6" style="color: var(--emperor-gold); font-weight: 900;">
                            Skor: <span id="quizScore">0</span>/10
                        </p>
                        <p class="text-2xl mb-8" style="color: var(--imperial-red); font-weight: bold;">
                            Grade: <span id="quizGrade">-</span>
                        </p>
                        <button class="px-10 py-4 rounded-xl font-bold text-xl transition-all" style="background: var(--imperial-red); color: var(--emperor-gold); border: 3px solid var(--emperor-gold);" onclick="resetQuiz(); startQuiz();">
                            üîÑ Ulangi Quiz
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI TUTOR TAB -->
        <div id="tab-ai" class="tab-content hidden-tab">
            <div class="learning-container">
                <h2 class="text-4xl font-black text-center mb-8" style="color: var(--imperial-red);">
                    ü§ñ AI Tutor Pro - Character Analysis
                </h2>

                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white rounded-2xl p-6 border-4" style="border-color: var(--emperor-gold);">
                        <h3 class="text-2xl font-bold mb-4" style="color: var(--imperial-red);">üîç Analisis Karakter</h3>
                        <input type="text" id="analyzeChar" class="w-full p-4 border-4 rounded-xl text-4xl text-center font-bold mb-4" style="border-color: var(--emperor-gold); color: var(--imperial-red); font-family: 'Ma Shan Zheng', cursive;" placeholder="Ëæì" maxlength="1">
                        
                        <div class="mb-4">
                            <h4 class="font-bold mb-2" style="color: var(--emperor-gold);">Radikal:</h4>
                            <div id="radicals" class="text-lg"></div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-bold mb-2" style="color: var(--emperor-gold);">Etimologi:</h4>
                            <p id="etymology" class="text-sm leading-relaxed"></p>
                        </div>
                        
                        <div>
                            <h4 class="font-bold mb-2" style="color: var(--emperor-gold);">Urutan Goresan:</h4>
                            <p id="strokeOrder" class="text-sm"></p>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6 border-4" style="border-color: var(--emperor-gold);">
                        <h3 class="text-2xl font-bold mb-4" style="color: var(--imperial-red);">üéµ Tone Practice</h3>
                        <div class="tone-visual mb-4">
                            <div class="tone-line" style="top: 20%;"></div>
                        </div>
                        
                        <div class="grid grid-cols-4 gap-3 mb-6">
                            <button class="px-4 py-3 rounded-lg font-bold transition-all" style="background: var(--emperor-gold); color: var(--imperial-red); border: 2px solid var(--imperial-red);" onclick="playTone(1)">
                                1st<br>mƒÅ
                            </button>
                            <button class="px-4 py-3 rounded-lg font-bold transition-all" style="background: var(--emperor-gold); color: var(--imperial-red); border: 2px solid var(--imperial-red);" onclick="playTone(2)">
                                2nd<br>m√°
                            </button>
                            <button class="px-4 py-3 rounded-lg font-bold transition-all" style="background: var(--emperor-gold); color: var(--imperial-red); border: 2px solid var(--imperial-red);" onclick="playTone(3)">
                                3rd<br>m«é
                            </button>
                            <button class="px-4 py-3 rounded-lg font-bold transition-all" style="background: var(--emperor-gold); color: var(--imperial-red); border: 2px solid var(--imperial-red);" onclick="playTone(4)">
                                4th<br>m√†
                            </button>
                        </div>
                        
                        <button class="w-full px-6 py-4 rounded-xl font-bold text-lg transition-all" style="background: var(--imperial-red); color: var(--emperor-gold); border: 3px solid var(--emperor-gold);" onclick="startToneQuiz()">
                            üéØ Start Tone Quiz
                        </button>
                    </div>
                </div>

                <div class="mt-8 bg-white rounded-2xl p-6 border-4" style="border-color: var(--emperor-gold);">
                    <h3 class="text-2xl font-bold mb-4" style="color: var(--imperial-red);">üí¨ Contextual Sentences</h3>
                    <select id="contextTopic" class="w-full p-3 border-3 rounded-xl mb-4 font-bold" style="border-color: var(--emperor-gold);" onchange="loadContextSentences()">
                        <option value="Perkenalan">üëã Perkenalan</option>
                        <option value="Bisnis">üíº Bisnis</option>
                        <option value="Makanan">üçú Makanan</option>
                    </select>
                    <div id="contextSentences"></div>
                </div>
            </div>
        </div>

        <!-- PROGRESS TAB -->
        <div id="tab-progress" class="tab-content hidden-tab">
            <div class="learning-container">
                <h2 class="text-4xl font-black text-center mb-8" style="color: var(--imperial-red);">
                    üìä Progress Tracking Elite
                </h2>

                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="stat-card">
                        <h4 class="text-lg font-bold mb-3" style="color: var(--emperor-gold);">XP Progress</h4>
                        <div class="mb-2">
                            <div class="w-full bg-gray-200 rounded-full h-4">
                                <div id="xpBar" class="progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <p class="text-sm font-semibold" style="color: var(--imperial-red);">
                            <span id="xpProgress">0</span> / 1000 XP
                        </p>
                    </div>
                    
                    <div class="stat-card">
                        <h4 class="text-lg font-bold mb-3" style="color: var(--emperor-gold);">Vocab Mastered</h4>
                        <div class="mb-2">
                            <div class="w-full bg-gray-200 rounded-full h-4">
                                <div id="vocabBar" class="progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <p class="text-sm font-semibold" style="color: var(--imperial-red);">
                            <span id="vocabMastered">0</span> / 50
                        </p>
                    </div>
                    
                    <div class="stat-card">
                        <h4 class="text-lg font-bold mb-3" style="color: var(--emperor-gold);">Study Streak</h4>
                        <div class="text-5xl mb-2">üî•</div>
                        <p class="text-3xl font-black" style="color: var(--imperial-red);">
                            <span id="streakCount">0</span> hari
                        </p>
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-6 border-4 mb-8" style="border-color: var(--emperor-gold);">
                    <h3 class="text-2xl font-bold mb-4 text-center" style="color: var(--imperial-red);">üìÖ Study Calendar (30 Hari)</h3>
                    <div id="streakCalendar" class="flex flex-wrap justify-center gap-2"></div>
                </div>

                <div class="bg-white rounded-2xl p-6 border-4" style="border-color: var(--emperor-gold);">
                    <h3 class="text-2xl font-bold mb-4 text-center" style="color: var(--imperial-red);">üèÖ Achievement Badges</h3>
                    <div class="flex flex-wrap justify-center gap-4">
                        <div class="badge">üå± First Step</div>
                        <div class="badge">‚úçÔ∏è 10 Characters</div>
                        <div class="badge">üìö 50 Vocab</div>
                        <div class="badge">üî• 7 Day Streak</div>
                        <div class="badge">üéØ Quiz Master</div>
                        <div class="badge">‚ö° Speed Learner</div>
                        <div class="badge">üíé 100 XP</div>
                        <div class="badge">üèÜ Elite Status</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Footer -->
    <div class="text-center py-10 mt-20 relative z-10">
        <p class="text-xl font-bold" style="color: var(--emperor-gold);">
            üêâ Wang Weize's Supreme Imlek Edition üêâ
        </p>
        <p class="text-sm mt-2" style="color: var(--luxury-gold);">
            Belajar Bahasa Mandarin Level Sultan | Powered by AI & Grind
        </p>
    </div>

    <script>
        // ============================================
        // ANGPAO WALLET SYSTEM - HARDCORE GRINDING
        // ============================================
        let saldoAngpao = parseInt(localStorage.getItem('saldoAngpao')) || 0;
        
        function updateAngpaoDisplay() {
            document.getElementById('saldoDisplay').textContent = saldoAngpao.toLocaleString('id-ID');
            
            // Enable/disable withdraw button
            const withdrawBtn = document.getElementById('withdrawBtn');
            if (saldoAngpao >= 1000000) {
                withdrawBtn.disabled = false;
                withdrawBtn.style.opacity = '1';
            } else {
                withdrawBtn.disabled = true;
                withdrawBtn.style.opacity = '0.5';
            }
        }
        
        function addAngpao(amount) {
            saldoAngpao += amount;
            localStorage.setItem('saldoAngpao', saldoAngpao);
            updateAngpaoDisplay();
        }
        
        function openWithdrawModal() {
            if (saldoAngpao < 1000000) {
                alert('‚ùå Kerja keras lagi bos! Saldo belum 1 Juta! Jangan harap gampang dapat Cuan! üí™');
                return;
            }
            document.getElementById('withdrawModal').classList.add('active');
        }
        
        function closeWithdrawModal() {
            document.getElementById('withdrawModal').classList.remove('active');
            document.getElementById('withdrawForm').reset();
        }
        
        function submitWithdraw(event) {
            event.preventDefault();
            
            const ewallet = document.getElementById('ewallet').value;
            const fullname = document.getElementById('fullname').value;
            const accountno = document.getElementById('accountno').value;
            
            if (!ewallet || !fullname || !accountno) {
                alert('‚ö†Ô∏è Semua field harus diisi!');
                return;
            }
            
            // Build WhatsApp message
            const message = `Halo Boss Wang Weize, saya sudah selesai misi belajar dan mau tarik Angpao Rp 1.000.000.

Data Pencairan:
Metode: ${ewallet}
Nama: ${fullname}
No Rek/HP: ${accountno}`;
            
            const whatsappURL = `https://wa.me/6288277200044?text=${encodeURIComponent(message)}`;
            
            // Open WhatsApp
            window.open(whatsappURL, '_blank');
            
            // Close modal
            closeWithdrawModal();
        }

        // ============================================
        // AUDIO & WELCOME OVERLAY SYSTEM
        // ============================================
        const bgmAudio = document.getElementById('bgm');
        let isPlaying = false;
        
        function openAngpao() {
            // Play BGM
            bgmAudio.play().then(() => {
                isPlaying = true;
                updateAudioIcon();
            }).catch(err => {
                console.log('Audio play prevented:', err);
            });
            
            // Fade out overlay
            const overlay = document.getElementById('welcomeOverlay');
            overlay.classList.add('fade-out');
            
            // Show audio controls and wallet after fade
            setTimeout(() => {
                overlay.style.display = 'none';
                document.getElementById('audioToggle').style.display = 'flex';
                document.getElementById('angpaoWallet').style.display = 'block';
                updateAngpaoDisplay();
            }, 1000);
        }
        
        function toggleAudio() {
            if (isPlaying) {
                bgmAudio.pause();
                isPlaying = false;
            } else {
                bgmAudio.play();
                isPlaying = true;
            }
            updateAudioIcon();
        }
        
        function updateAudioIcon() {
            document.getElementById('audioIcon').textContent = isPlaying ? 'üîä' : 'üîá';
        }
        
        document.getElementById('audioToggle').addEventListener('click', toggleAudio);

        // ============================================
        // USER STATS & XP SYSTEM (INTEGRATED WITH ANGPAO)
        // ============================================
        let userStats = {
            xp: 0,
            level: 1,
            charactersWritten: 0,
            quizzesCompleted: 0,
            studyTime: 0,
            studyStreak: 0,
            accuracy: 0,
            vocabMastered: 0
        };

        function addXP(amount) {
            userStats.xp += amount;
            
            // HARDCORE ANGPAO INTEGRATION - Saldo = XP * 5
            addAngpao(amount * 5);
            
            // Level up logic
            const xpPerLevel = 1000;
            if (userStats.xp >= xpPerLevel * userStats.level) {
                userStats.level++;
                showAchievement(`üéâ Level Up! Sekarang Level ${userStats.level}!`);
            }
            
            saveUserData();
            updateStatsDisplay();
        }

        function saveUserData() {
            localStorage.setItem('userStats', JSON.stringify(userStats));
        }

        function loadUserData() {
            const saved = localStorage.getItem('userStats');
            if (saved) {
                userStats = JSON.parse(saved);
            }
            updateStatsDisplay();
        }

        function updateStatsDisplay() {
            document.getElementById('userLevel').textContent = userStats.level;
            document.getElementById('xpDisplay').textContent = userStats.xp;
            document.getElementById('streakDisplay').textContent = userStats.studyStreak;
            document.getElementById('accuracyDisplay').textContent = Math.round(userStats.accuracy);
            document.getElementById('charactersWritten').textContent = userStats.charactersWritten;
            document.getElementById('quizzesCompleted').textContent = userStats.quizzesCompleted;
            document.getElementById('studyTime').textContent = userStats.studyTime;
            
            // Progress bars
            const xpProgress = userStats.xp % 1000;
            document.getElementById('xpBar').style.width = (xpProgress / 10) + '%';
            document.getElementById('xpProgress').textContent = xpProgress;
            
            document.getElementById('vocabBar').style.width = (userStats.vocabMastered * 2) + '%';
            document.getElementById('vocabMastered').textContent = userStats.vocabMastered;
            
            document.getElementById('streakCount').textContent = userStats.studyStreak;
        }

        function showAchievement(text) {
            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `<div class="text-3xl mb-2">üèÜ</div><div class="font-bold">${text}</div>`;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 3000);
        }

        // ============================================
        // NAVIGATION SYSTEM
        // ============================================
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden-tab');
            });
            
            // Show selected tab
            document.getElementById('tab-' + tabName).classList.remove('hidden-tab');
            
            // Update nav buttons
            document.querySelectorAll('button[onclick^="showTab"]').forEach(btn => {
                btn.classList.remove('active-nav');
                btn.style.background = 'rgba(255,255,255,0.9)';
                btn.style.color = 'var(--imperial-red)';
            });
            
            event.target.classList.add('active-nav');
        }

        // ============================================
        // CANVAS DRAWING SYSTEM (MI ZI GE)
        // ============================================
        let gridCanvas, drawCanvas, gridCtx, drawCtx;
        let isDrawing = false;
        let lastX = 0, lastY = 0;

        function initDraw() {
            gridCanvas = document.getElementById('grid-canvas');
            drawCanvas = document.getElementById('draw-canvas');
            gridCtx = gridCanvas.getContext('2d');
            drawCtx = drawCanvas.getContext('2d');
            
            drawMiZiGrid();
            
            // Mouse events
            drawCanvas.addEventListener('mousedown', startDraw);
            drawCanvas.addEventListener('mousemove', draw);
            drawCanvas.addEventListener('mouseup', stopDraw);
            drawCanvas.addEventListener('mouseout', stopDraw);
            
            // Touch events
            drawCanvas.addEventListener('touchstart', handleTouch);
            drawCanvas.addEventListener('touchmove', handleTouch);
            drawCanvas.addEventListener('touchend', stopDraw);
        }

        function drawMiZiGrid() {
            const w = gridCanvas.width;
            const h = gridCanvas.height;
            gridCtx.strokeStyle = '#ddd';
            gridCtx.lineWidth = 1;
            
            // Outer border
            gridCtx.strokeStyle = '#999';
            gridCtx.lineWidth = 3;
            gridCtx.strokeRect(0, 0, w, h);
            
            // Center cross
            gridCtx.strokeStyle = '#ccc';
            gridCtx.lineWidth = 2;
            gridCtx.beginPath();
            gridCtx.moveTo(w/2, 0);
            gridCtx.lineTo(w/2, h);
            gridCtx.moveTo(0, h/2);
            gridCtx.lineTo(w, h/2);
            gridCtx.stroke();
            
            // Diagonals
            gridCtx.strokeStyle = '#eee';
            gridCtx.lineWidth = 1;
            gridCtx.beginPath();
            gridCtx.moveTo(0, 0);
            gridCtx.lineTo(w, h);
            gridCtx.moveTo(w, 0);
            gridCtx.lineTo(0, h);
            gridCtx.stroke();
        }

        function startDraw(e) {
            isDrawing = true;
            const rect = drawCanvas.getBoundingClientRect();
            lastX = e.clientX - rect.left;
            lastY = e.clientY - rect.top;
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = drawCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            drawCtx.strokeStyle = '#000';
            drawCtx.lineWidth = 4;
            drawCtx.lineCap = 'round';
            drawCtx.lineJoin = 'round';
            
            drawCtx.beginPath();
            drawCtx.moveTo(lastX, lastY);
            drawCtx.lineTo(x, y);
            drawCtx.stroke();
            
            lastX = x;
            lastY = y;
        }

        function stopDraw() {
            isDrawing = false;
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 'mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            drawCanvas.dispatchEvent(mouseEvent);
        }

        function clearCanvas() {
            drawCtx.clearRect(0, 0, drawCanvas.width, drawCanvas.height);
        }

        function saveDrawing() {
            const dataURL = drawCanvas.toDataURL();
            const drawings = JSON.parse(localStorage.getItem('drawings') || '[]');
            drawings.unshift(dataURL);
            if (drawings.length > 8) drawings.pop();
            localStorage.setItem('drawings', JSON.stringify(drawings));
            
            userStats.charactersWritten++;
            addXP(10);
            updateWritingHistory();
            
            showAchievement('‚úÖ Tulisan tersimpan! +10 XP');
            clearCanvas();
        }

        function updateWritingHistory() {
            const drawings = JSON.parse(localStorage.getItem('drawings') || '[]');
            const container = document.getElementById('writing-history');
            container.innerHTML = drawings.slice(0, 8).map((img, i) => 
                `<div class="border-4 rounded-lg overflow-hidden" style="border-color: var(--emperor-gold);">
                    <img src="${img}" class="w-full h-auto">
                </div>`
            ).join('');
        }

        // ============================================
        // VOCABULARY SYSTEM
        // ============================================
        const vocabData = [
            {hanzi: '‰Ω†Â•Ω', pinyin: 'N«ê h«éo', meaning: 'Halo', level: 'beginner'},
            {hanzi: 'Ë∞¢Ë∞¢', pinyin: 'Xi√®xie', meaning: 'Terima kasih', level: 'beginner'},
            {hanzi: 'ÂØπ‰∏çËµ∑', pinyin: 'Du√¨b√πq«ê', meaning: 'Maaf', level: 'beginner'},
            {hanzi: 'ÂÜçËßÅ', pinyin: 'Z√†iji√†n', meaning: 'Sampai jumpa', level: 'beginner'},
            {hanzi: 'ÊòØ', pinyin: 'Sh√¨', meaning: 'Adalah/Ya', level: 'beginner'},
            {hanzi: '‰∏ç', pinyin: 'B√π', meaning: 'Tidak', level: 'beginner'},
            {hanzi: 'Êàë', pinyin: 'W«í', meaning: 'Saya', level: 'beginner'},
            {hanzi: '‰Ω†', pinyin: 'N«ê', meaning: 'Kamu', level: 'beginner'},
            {hanzi: '‰ªñ', pinyin: 'TƒÅ', meaning: 'Dia (laki-laki)', level: 'beginner'},
            {hanzi: 'Â•π', pinyin: 'TƒÅ', meaning: 'Dia (perempuan)', level: 'beginner'},
            {hanzi: 'Â•Ω', pinyin: 'H«éo', meaning: 'Baik', level: 'beginner'},
            {hanzi: 'ÂêÉ', pinyin: 'Chƒ´', meaning: 'Makan', level: 'beginner'},
            {hanzi: 'Âñù', pinyin: 'Hƒì', meaning: 'Minum', level: 'beginner'},
            {hanzi: 'Â≠¶‰π†', pinyin: 'Xu√©x√≠', meaning: 'Belajar', level: 'intermediate'},
            {hanzi: 'Â∑•‰Ωú', pinyin: 'G≈çngzu√≤', meaning: 'Bekerja', level: 'intermediate'},
            {hanzi: 'Ê±™‰∏∫Ê≥Ω', pinyin: 'WƒÅng W√©iz√©', meaning: 'Wang Weize (nama)', level: 'advanced'},
            {hanzi: 'ËµöÈí±', pinyin: 'Zhu√†nqi√°n', meaning: 'Menghasilkan uang', level: 'intermediate'},
            {hanzi: 'ÊàêÂäü', pinyin: 'Ch√©ngg≈çng', meaning: 'Sukses', level: 'intermediate'},
            {hanzi: 'Âä™Âäõ', pinyin: 'N«îl√¨', meaning: 'Berusaha keras', level: 'intermediate'},
            {hanzi: 'ÂïÜ‰∏ö', pinyin: 'ShƒÅngy√®', meaning: 'Bisnis', level: 'advanced'}
        ];

        let currentDifficulty = 'all';
        let currentSearchTerm = '';

        function renderVocab(data) {
            const container = document.getElementById('vocab-container');
            container.innerHTML = data.map((item, index) => `
                <div class="vocab-card">
                    <div class="vocab-hanzi mb-3">${item.hanzi}</div>
                    <div class="text-lg font-semibold mb-1" style="color: var(--emperor-gold);">${item.pinyin}</div>
                    <div class="text-gray-700 mb-4">${item.meaning}</div>
                    <div class="flex gap-2 justify-center">
                        <button class="vocab-btn" onclick="spk('${item.pinyin}')" title="Dengarkan">üîä</button>
                        <button class="vocab-btn" onclick="addToFlashcards(${index})" title="Tambah ke Flashcard">üìå</button>
                    </div>
                </div>
            `).join('');
        }

        function searchVocab() {
            currentSearchTerm = document.getElementById('vocab-search').value.toLowerCase();
            filterVocab();
        }

        function filterDifficulty(level) {
            currentDifficulty = level;
            
            // Update button styles
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            filterVocab();
        }

        function filterVocab() {
            let filtered = vocabData;
            
            if (currentDifficulty !== 'all') {
                filtered = filtered.filter(v => v.level === currentDifficulty);
            }
            
            if (currentSearchTerm) {
                filtered = filtered.filter(v => 
                    v.hanzi.includes(currentSearchTerm) ||
                    v.pinyin.toLowerCase().includes(currentSearchTerm) ||
                    v.meaning.toLowerCase().includes(currentSearchTerm)
                );
            }
            
            renderVocab(filtered);
        }

        function spk(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-CN';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        function addToFlashcards(index) {
            showAchievement('üìå Ditambahkan ke Flashcard!');
            userStats.vocabMastered++;
            addXP(5);
        }

        // ============================================
        // FLASHCARD SYSTEM
        // ============================================
        let flashcardIndex = 0;
        const flashcardData = vocabData.slice(0, 10);

        function updateFlashcard() {
            const card = flashcardData[flashcardIndex];
            document.getElementById('flashcard-question').textContent = card.hanzi;
            document.getElementById('flashcard-answer').innerHTML = `${card.pinyin}<br><small style="font-size:24px;">${card.meaning}</small>`;
            document.getElementById('flashcard-count').textContent = flashcardIndex + 1;
            document.getElementById('flashcard-total').textContent = flashcardData.length;
            
            // Reset flip
            document.getElementById('flashcard').classList.remove('flipped');
        }

        function flipCard() {
            document.getElementById('flashcard').classList.toggle('flipped');
        }

        function nextFlashcard() {
            flashcardIndex = (flashcardIndex + 1) % flashcardData.length;
            updateFlashcard();
        }

        function prevFlashcard() {
            flashcardIndex = (flashcardIndex - 1 + flashcardData.length) % flashcardData.length;
            updateFlashcard();
        }

        // ============================================
        // QUIZ SYSTEM
        // ============================================
        let currentQuizIndex = 0;
        let quizScore = 0;
        let quizData = [];

        function startQuiz() {
            currentQuizIndex = 0;
            quizScore = 0;
            quizData = shuffleArray(vocabData).slice(0, 10);
            
            document.getElementById('quizContent').classList.remove('hidden');
            document.getElementById('quizResults').classList.add('hidden');
            
            showQuizQuestion();
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function showQuizQuestion() {
            if (currentQuizIndex >= quizData.length) {
                showQuizResults();
                return;
            }
            
            const question = quizData[currentQuizIndex];
            document.getElementById('quizNumber').textContent = currentQuizIndex + 1;
            document.getElementById('quizQuestion').textContent = question.hanzi;
            
            // Generate options
            const correctAnswer = question.meaning;
            const wrongAnswers = vocabData
                .filter(v => v.meaning !== correctAnswer)
                .map(v => v.meaning);
            
            const shuffled = shuffleArray(wrongAnswers).slice(0, 3);
            shuffled.push(correctAnswer);
            const options = shuffleArray(shuffled);
            
            const optionsHTML = options.map((opt, i) => 
                `<div class="quiz-option" onclick="selectAnswer(this, '${opt}', '${correctAnswer}')">
                    ${String.fromCharCode(65 + i)}. ${opt}
                </div>`
            ).join('');
            
            document.getElementById('quizOptions').innerHTML = optionsHTML;
            document.getElementById('nextQuizBtn').classList.add('hidden');
        }

        function selectAnswer(element, selected, correct) {
            // Disable all options
            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            if (selected === correct) {
                element.classList.add('correct');
                quizScore++;
                addXP(10);
            } else {
                element.classList.add('wrong');
                // Highlight correct answer
                document.querySelectorAll('.quiz-option').forEach(opt => {
                    if (opt.textContent.includes(correct)) {
                        opt.classList.add('correct');
                    }
                });
            }
            
            document.getElementById('nextQuizBtn').classList.remove('hidden');
        }

        function nextQuiz() {
            currentQuizIndex++;
            showQuizQuestion();
        }

        function showQuizResults() {
            document.getElementById('quizContent').classList.add('hidden');
            document.getElementById('quizResults').classList.remove('hidden');
            
            document.getElementById('quizScore').textContent = quizScore;
            
            const percentage = (quizScore / quizData.length) * 100;
            let grade = 'F';
            if (percentage >= 90) grade = 'A';
            else if (percentage >= 80) grade = 'B';
            else if (percentage >= 70) grade = 'C';
            else if (percentage >= 60) grade = 'D';
            
            document.getElementById('quizGrade').textContent = grade;
            
            userStats.quizzesCompleted++;
            userStats.accuracy = percentage;
            saveUserData();
            updateStatsDisplay();
        }

        function resetQuiz() {
            document.getElementById('quizResults').classList.add('hidden');
            currentQuizIndex = 0;
            quizScore = 0;
        }

        // ============================================
        // AI TUTOR FEATURES
        // ============================================
        document.getElementById('analyzeChar')?.addEventListener('input', function(e) {
            const char = e.target.value;
            if (char.length === 1) {
                analyzeCharacter(char);
            }
        });

        function analyzeCharacter(char) {
            const radicals = {
                '‰Ω†': ['‰∫∫ (r√©n - manusia)', 'Â∞î (ƒõr)'],
                'Â•Ω': ['Â•≥ (n«ö - wanita)', 'Â≠ê (z«ê - anak)'],
                'Ê±™': ['Ê∞¥ (shu«ê - air)', 'Áéã (w√°ng - raja)'],
                'Ëµö': ['Ë¥ù (b√®i - kerang/uang)', 'ÂÖº (jiƒÅn)']
            };
            
            const etymology = {
                'Â•Ω': 'Karakter "Â•Ω" menggambarkan seorang wanita (Â•≥) dengan anak (Â≠ê), melambangkan sesuatu yang baik.',
                'Ê±™': 'Kombinasi radikal air (Ê∞¥) dan raja (Áéã), menggambarkan air yang melimpah seperti kerajaan.'
            };
            
            document.getElementById('radicals').innerHTML = radicals[char] 
                ? radicals[char].map(r => `<div class="radical-part">${r}</div>`).join('')
                : 'Radikal tidak ditemukan dalam database';
                
            document.getElementById('etymology').textContent = etymology[char] || 'Etimologi tidak tersedia';
            document.getElementById('strokeOrder').textContent = 'Lihat animasi goresan untuk detail urutan';
        }

        function playTone(tone) {
            const toneTexts = ['mƒÅ', 'm√°', 'm«é', 'm√†'];
            spk(toneTexts[tone - 1]);
        }

        function startToneQuiz() {
            alert('üéµ Tone Quiz akan segera hadir! Fitur ini dalam pengembangan.');
        }

        function loadContextSentences() {
            const topic = document.getElementById('contextTopic').value;
            const sentences = {
                'Perkenalan': [
                    {zh: '‰Ω†Â•ΩÔºåÊàëÂè´Áéã‰∏∫Ê≥Ω„ÄÇ', py: 'N«ê h«éo, w«í ji√†o W√°ng W√©iz√©.', id: 'Halo, nama saya Wang Weize.'},
                    {zh: 'ÂæàÈ´òÂÖ¥ËÆ§ËØÜ‰Ω†„ÄÇ', py: 'Hƒõn gƒÅox√¨ng r√®nshi n«ê.', id: 'Senang berkenalan denganmu.'}
                ],
                'Bisnis': [
                    {zh: 'Ëøô‰∏™‰ª∑Ê†ºÊÄé‰πàÊ†∑Ôºü', py: 'Zh√®ge ji√†g√© zƒõnmey√†ng?', id: 'Bagaimana dengan harga ini?'},
                    {zh: 'Êàë‰ª¨ÂèØ‰ª•Âêà‰Ωú„ÄÇ', py: 'W«ímen kƒõy«ê h√©zu√≤.', id: 'Kita bisa bekerjasama.'}
                ],
                'Makanan': [
                    {zh: '‰Ω†ÊÉ≥ÂêÉ‰ªÄ‰πàÔºü', py: 'N«ê xi«éng chƒ´ sh√©nme?', id: 'Mau makan apa?'},
                    {zh: 'Ëøô‰∏™ËèúÂæàÂ•ΩÂêÉ„ÄÇ', py: 'Zh√®ge c√†i hƒõn h«éochƒ´.', id: 'Makanan ini enak sekali.'}
                ]
            };
            
            const selected = sentences[topic] || sentences['Perkenalan'];
            document.getElementById('contextSentences').innerHTML = selected.map(s => `
                <div class="context-sentence">
                    <div class="font-bold text-red-900 text-xl mb-2">${s.zh}</div>
                    <div class="text-purple-700 mb-1">${s.py}</div>
                    <div class="text-gray-700">${s.id}</div>
                </div>
            `).join('');
        }

        // ============================================
        // PROGRESS FEATURES
        // ============================================
        function initProgress() {
            renderStreakCalendar();
        }

        function renderStreakCalendar() {
            const calendar = document.getElementById('streakCalendar');
            const days = 30;
            let html = '';
            
            for (let i = 0; i < days; i++) {
                const isComplete = Math.random() > 0.3;
                html += `<div class="streak-day ${isComplete ? 'streak-complete' : 'streak-incomplete'}" title="Hari ${i + 1}"></div>`;
            }
            
            calendar.innerHTML = html;
        }

        // ============================================
        // INITIALIZE APPLICATION
        // ============================================
        window.addEventListener('load', function() {
            initDraw(); 
            renderVocab(vocabData);
            loadUserData();
            updateStatsDisplay();
            updateWritingHistory();
            updateFlashcard();
            loadContextSentences();
            initProgress();
            
            // IMLEK PARTICLES - MODIFIED
            const pc = document.getElementById('particle-container');
            const imlek_symbols = ['üèÆ', 'üßß', 'ü™ô', 'üêâ', 'üß®'];
            for(let i=0; i<30; i++) {
                const p = document.createElement('div'); 
                p.className = 'imperial-particle';
                p.style.left = Math.random()*100+'%'; 
                p.style.animationDuration = (5 + Math.random()*10)+'s';
                p.style.animationDelay = Math.random()*5+'s';
                p.textContent = imlek_symbols[Math.floor(Math.random()*imlek_symbols.length)];
                pc.appendChild(p);
            }
            
            // Study streak update
            const lastStudy = localStorage.getItem('lastStudyDate');
            const today = new Date().toDateString();
            if (lastStudy !== today) {
                if (lastStudy && new Date(lastStudy).getTime() === new Date(today).getTime() - 86400000) {
                    userStats.studyStreak++;
                } else if (!lastStudy) {
                    userStats.studyStreak = 1;
                } else {
                    userStats.studyStreak = 1;
                }
                localStorage.setItem('lastStudyDate', today);
                saveUserData();
            }
            
            startQuiz();
        });
    </script>
</body>
</html>
