<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wang Weize | Imperial Mandarin Authority - Ultra Advanced Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@700;900&family=Playfair+Display:wght@900&family=Cormorant+Garamond:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root { --imperial-red: #8B0000; --emperor-gold: #D4AF37; --rice-paper: #FDF6E3; }
        body { background-color: var(--rice-paper); color: #1a1a1a; font-family: 'Noto Serif SC', serif; background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png'); overflow-x: hidden; padding-bottom: 120px; }
        
        .emperor-name { 
            font-family: 'Playfair Display', serif; 
            font-size: clamp(3rem, 8vw, 6.5rem); 
            font-weight: 900; 
            color: #ffffff; 
            -webkit-text-stroke: 2.5px var(--imperial-red);
            text-shadow: 4px 4px 0 var(--emperor-gold), 8px 8px 20px rgba(0,0,0,0.5); 
            letter-spacing: 6px; 
            display: inline-block; 
            line-height: 1.2;
            padding: 15px;
            filter: drop-shadow(0 5px 15px rgba(196,30,58,0.4));
        }

        .glass-scroll { background: rgba(253, 246, 227, 0.95); backdrop-filter: blur(10px); border: 3px solid var(--imperial-red); border-radius: 12px; transition: 0.5s; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .hidden-tab { display: none !important; }
        .active-nav { background: var(--imperial-red) !important; color: var(--emperor-gold) !important; transform: scale(1.05); box-shadow: 0 -5px 15px rgba(196,30,58,0.5); }
        
        .canvas-box { position: relative; width: 360px; height: 360px; margin: 0 auto; background: #fff; border: 6px double var(--imperial-red); border-radius: 10px; }
        canvas { touch-action: none; cursor: crosshair; position: absolute; top: 0; left: 0; }
        
        .imperial-particle { position: fixed; top: -10px; pointer-events: none; z-index: 0; opacity: 0.15; animation: fall linear infinite; font-size: 24px; color: var(--emperor-gold); }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }

        .vocab-card { background: white; border: 2px solid var(--imperial-red); border-radius: 16px; padding: 20px; box-shadow: 6px 6px 0 var(--imperial-red); transition: 0.3s; }
        .vocab-card:hover { transform: translateY(-5px); border-color: var(--emperor-gold); box-shadow: 8px 8px 0 var(--emperor-gold); }
        .vocab-hanzi { font-size: 42px; font-family: 'Ma Shan Zheng', cursive; color: var(--imperial-red); text-shadow: 1px 1px 0 var(--emperor-gold); }
        .vocab-btn { width: 42px; height: 42px; border-radius: 50%; border: 2px solid var(--imperial-red); background: var(--emperor-gold); color: var(--imperial-red); transition: 0.2s; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .vocab-btn:hover { background: var(--imperial-red); color: var(--emperor-gold); transform: scale(1.1); }
        
        .profil-container { background: linear-gradient(145deg, #faf3e0, #f5e6d3); border: 3px solid var(--imperial-red); border-radius: 40px; box-shadow: 20px 20px 0 rgba(196,30,58,0.3); padding: 40px; position: relative; overflow: hidden; }
        .kartu-generasi { background: rgba(255,255,255,0.8); border: 2px solid var(--imperial-red); border-radius: 20px; padding: 20px; width: 220px; box-shadow: 8px 8px 0 var(--imperial-red); }

        /* NEW ADVANCED FEATURES STYLES */
        .learning-container { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 15px 40px rgba(0,0,0,0.1); }
        .search-wrapper { margin: 20px 0; }
        .search-wrapper input { width: 100%; padding: 15px 20px; border: 3px solid var(--imperial-red); border-radius: 50px; font-size: 16px; font-weight: bold; outline: none; transition: 0.3s; }
        .search-wrapper input:focus { border-color: var(--emperor-gold); box-shadow: 0 0 20px rgba(255,215,0,0.3); }
        .vocab-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 30px; }

        /* Progress tracking */
        .progress-bar { height: 30px; background: linear-gradient(90deg, var(--emperor-gold), var(--imperial-red)); border-radius: 15px; transition: width 0.5s; box-shadow: 0 3px 10px rgba(0,0,0,0.2); }
        .stat-card { background: linear-gradient(135deg, #fff 0%, #f8f8f8 100%); border: 2px solid var(--imperial-red); border-radius: 15px; padding: 20px; text-align: center; }
        
        /* AI Features */
        .ai-suggestion { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 10px; margin: 10px 0; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        
        /* Gamification */
        .badge { display: inline-block; background: var(--emperor-gold); color: var(--imperial-red); padding: 5px 15px; border-radius: 20px; font-weight: bold; margin: 5px; box-shadow: 0 3px 10px rgba(0,0,0,0.2); }
        .level-badge { font-size: 24px; font-weight: 900; color: var(--emperor-gold); text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        
        /* Flashcard system */
        .flashcard { perspective: 1000px; height: 300px; cursor: pointer; }
        .flashcard-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 48px; font-weight: bold; }
        .flashcard-front { background: linear-gradient(135deg, var(--imperial-red), #8B0000); color: white; }
        .flashcard-back { background: linear-gradient(135deg, var(--emperor-gold), #DAA520); color: var(--imperial-red); transform: rotateY(180deg); }
        
        /* Quiz styles */
        .quiz-option { background: white; border: 3px solid var(--imperial-red); padding: 15px; border-radius: 10px; cursor: pointer; transition: 0.3s; margin: 10px 0; }
        .quiz-option:hover { background: var(--rice-paper); transform: translateX(10px); }
        .quiz-option.correct { background: #4ade80; border-color: #16a34a; }
        .quiz-option.wrong { background: #f87171; border-color: #dc2626; }
        
        /* Tone visualization */
        .tone-visual { height: 80px; background: linear-gradient(to top, #e0e0e0, white); border-radius: 10px; position: relative; overflow: hidden; margin: 20px 0; }
        .tone-line { position: absolute; left: 0; width: 100%; height: 4px; background: var(--imperial-red); transition: all 0.3s; }
        
        /* Character breakdown */
        .radical-part { display: inline-block; padding: 5px 10px; margin: 5px; background: rgba(196,30,58,0.1); border: 2px solid var(--imperial-red); border-radius: 8px; font-family: 'Ma Shan Zheng', cursive; font-size: 24px; cursor: help; transition: 0.3s; }
        .radical-part:hover { background: var(--emperor-gold); transform: scale(1.2); }
        
        /* Writing analysis */
        .stroke-analysis { border: 2px dashed var(--imperial-red); padding: 15px; border-radius: 10px; margin: 15px 0; background: rgba(255,215,0,0.1); }
        
        /* Spaced repetition indicator */
        .srs-indicator { height: 10px; border-radius: 5px; margin: 10px 0; }
        .srs-new { background: #60a5fa; }
        .srs-learning { background: #fbbf24; }
        .srs-review { background: #34d399; }
        .srs-master { background: #a78bfa; }
        
        /* Contextual sentences */
        .context-sentence { background: rgba(255,255,255,0.9); border-left: 4px solid var(--emperor-gold); padding: 15px; margin: 10px 0; border-radius: 5px; font-style: italic; }
        
        /* Pronunciation heat map */
        .pronunciation-heat { display: inline-block; padding: 3px 8px; border-radius: 5px; margin: 2px; }
        .heat-1 { background: #dcfce7; } /* Easy */
        .heat-2 { background: #fef3c7; } /* Medium */
        .heat-3 { background: #fecaca; } /* Hard */
        
        /* Study streak */
        .streak-day { width: 30px; height: 30px; border-radius: 5px; display: inline-block; margin: 3px; }
        .streak-complete { background: var(--emperor-gold); }
        .streak-incomplete { background: #e5e5e5; }
        
        /* Leaderboard */
        .leaderboard-item { background: white; border: 2px solid var(--imperial-red); padding: 15px; margin: 10px 0; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
        .rank-medal { font-size: 32px; }
        
        /* AR Visualization placeholder */
        .ar-viewer { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; text-align: center; margin: 20px 0; }
        
        /* Voice waveform */
        .waveform { height: 60px; background: #f0f0f0; border-radius: 10px; position: relative; overflow: hidden; }
        .wave-bar { display: inline-block; width: 4px; background: var(--imperial-red); margin: 0 2px; animation: wave 1s infinite ease-in-out; }
        @keyframes wave { 0%, 100% { height: 10px; } 50% { height: 50px; } }
        
        /* Achievement popup */
        .achievement-popup { position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, var(--emperor-gold), #DAA520); color: var(--imperial-red); padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000; animation: slideIn 0.5s; }
        @keyframes slideIn { from { transform: translateX(400px); } to { transform: translateX(0); } }
        
        /* Study timer */
        .study-timer { font-size: 48px; font-weight: 900; color: var(--imperial-red); text-align: center; font-family: monospace; }
        
        /* Difficulty selector */
        .difficulty-btn { padding: 10px 20px; margin: 5px; border: 2px solid var(--imperial-red); border-radius: 20px; cursor: pointer; transition: 0.3s; background: white; }
        .difficulty-btn.active { background: var(--imperial-red); color: white; }
        .difficulty-btn.easy { border-color: #22c55e; }
        .difficulty-btn.active.easy { background: #22c55e; }
        .difficulty-btn.medium { border-color: #f59e0b; }
        .difficulty-btn.active.medium { background: #f59e0b; }
        .difficulty-btn.hard { border-color: #ef4444; }
        .difficulty-btn.active.hard { background: #ef4444; }

        /* IMLEK: Kaligrafi */
        .gongxi-text { font-family: 'Ma Shan Zheng', cursive; font-size: clamp(1.2rem, 3vw, 2rem); color: var(--emperor-gold); text-shadow: 1px 1px 3px rgba(0,0,0,0.4); letter-spacing: 8px; margin-top: 6px; display: block; }

        /* ANGPAO WALLET */
        #angpaoWidget { position: fixed; top: 14px; right: 14px; z-index: 9999; background: linear-gradient(135deg, #8B0000, #5a0000); border: 2px solid var(--emperor-gold); border-radius: 14px; padding: 10px 14px; color: var(--emperor-gold); font-family: 'Noto Serif SC', serif; box-shadow: 0 4px 20px rgba(0,0,0,0.4); min-width: 160px; text-align: center; }
        #angpaoWidget .angpao-label { font-size: 11px; font-weight: 700; letter-spacing: 1px; opacity: 0.85; }
        #angpaoWidget .angpao-saldo { font-size: 18px; font-weight: 900; margin: 4px 0; color: #fff; text-shadow: 0 0 8px var(--emperor-gold); }
        #angpaoWidget .tarik-btn { background: var(--emperor-gold); color: #8B0000; border: none; border-radius: 8px; padding: 6px 14px; font-weight: 900; font-size: 12px; cursor: pointer; width: 100%; margin-top: 4px; transition: 0.2s; }
        #angpaoWidget .tarik-btn:hover { background: #fff; transform: scale(1.03); }

        /* MODAL */
        #angpaoModal { display: none; position: fixed; inset: 0; z-index: 99999; background: rgba(0,0,0,0.7); align-items: center; justify-content: center; }
        #angpaoModal.show { display: flex; }
        #angpaoModalBox { background: #fff; border: 3px solid #8B0000; border-radius: 20px; padding: 32px; max-width: 400px; width: 92%; box-shadow: 0 20px 50px rgba(0,0,0,0.4); position: relative; }
        #angpaoModalBox h3 { font-family: 'Ma Shan Zheng', cursive; color: #8B0000; font-size: 26px; text-align: center; margin-bottom: 18px; }
        #angpaoModalBox label { font-weight: 700; font-size: 13px; color: #5a0000; display: block; margin-top: 12px; margin-bottom: 4px; }
        #angpaoModalBox select, #angpaoModalBox input[type=text] { width: 100%; padding: 10px 12px; border: 2px solid #8B0000; border-radius: 8px; font-size: 14px; outline: none; box-sizing: border-box; }
        #angpaoModalBox .modal-submit { background: #8B0000; color: var(--emperor-gold); border: none; border-radius: 10px; padding: 12px; font-weight: 900; font-size: 15px; width: 100%; margin-top: 18px; cursor: pointer; transition: 0.2s; }
        #angpaoModalBox .modal-submit:hover { background: #D4AF37; color: #8B0000; }
        #angpaoModalBox .modal-close { position: absolute; top: 12px; right: 16px; background: none; border: none; font-size: 22px; cursor: pointer; color: #8B0000; }
    </style>
</head>
<body>
    <div id="particle-container"></div>
    <div id="achievementContainer"></div>

    <!-- ANGPAO WALLET WIDGET -->
    <div id="angpaoWidget">
        <div class="angpao-label">üßß Saldo Angpao</div>
        <div class="angpao-saldo" id="angpaoDisplay">Rp 0</div>
        <button class="tarik-btn" onclick="tarikCuan()">üí∞ Tarik Cuan</button>
    </div>

    <!-- MODAL PENARIKAN -->
    <div id="angpaoModal">
        <div id="angpaoModalBox">
            <button class="modal-close" onclick="tutupModal()">‚úï</button>
            <h3>üßß Tarik Angpao</h3>
            <p style="text-align:center;font-size:13px;color:#5a0000;margin-bottom:8px;">Selamat! Saldo Anda sudah 1 Juta! üéâ</p>
            <label>Metode E-Wallet</label>
            <select id="modalMetode">
                <option value="DANA">DANA</option>
                <option value="OVO">OVO</option>
                <option value="GoPay">GoPay</option>
            </select>
            <label>Nama Lengkap</label>
            <input type="text" id="modalNama" placeholder="Nama sesuai e-wallet">
            <label>Nomor HP / No. Rekening</label>
            <input type="text" id="modalNoRek" placeholder="08xxxxxxxxxx">
            <button class="modal-submit" onclick="submitTarik()">üì§ Kirim ke WhatsApp Boss Wang</button>
        </div>
    </div>

    <header class="p-10 md:p-14 text-center relative overflow-hidden z-10">
        <div class="absolute top-0 left-0 w-full h-4 bg-gradient-to-r from-red-900 via-yellow-500 to-red-900"></div>
        <div class="mt-6">
            <p class="text-[12px] md:text-sm tracking-[0.5em] font-black text-red-800 uppercase mb-4">Native Shaanxi Bloodline ‚Ä¢ Medan Soul ‚Ä¢ AI-Powered Learning</p>
            <h1 class="emperor-name">WANG WEIZE</h1>
            <span class="gongxi-text">ÊÅ≠ÂñúÂèëË¥¢ üèÆ</span>
            <p class="mt-6 text-xl text-red-900 font-black italic max-w-2xl mx-auto border-l-4 border-yellow-500 pl-4 bg-white/60 p-4 rounded shadow-md">
                "Darah Shaanxi, Jiwa Medan. Belajar Mandarin isinya daging semua biar lu kaga Boncos! üöÄ Ultra Advanced Edition"
            </p>
            
            <!-- User Stats Dashboard -->
            <div class="mt-8 grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto">
                <div class="stat-card">
                    <div class="text-3xl font-black text-red-900" id="totalWords">0</div>
                    <div class="text-sm">Kata Dikuasai</div>
                </div>
                <div class="stat-card">
                    <div class="text-3xl font-black text-red-900" id="studyStreak">0</div>
                    <div class="text-sm">Hari Beruntun</div>
                </div>
                <div class="stat-card">
                    <div class="text-3xl font-black text-red-900" id="totalXP">0</div>
                    <div class="text-sm">Total XP</div>
                </div>
                <div class="stat-card">
                    <div class="level-badge" id="userLevel">Lv 1</div>
                    <div class="text-sm">Level Sultan</div>
                </div>
            </div>
        </div>
    </header>

    <nav class="fixed bottom-0 w-full z-40 flex justify-center gap-2 p-3 bg-[#1a1a1a] border-t-4 border-yellow-500 overflow-x-auto shadow-2xl whitespace-nowrap">
        <button onclick="tab('home')" id="n-home" class="px-4 py-2 bg-white text-red-900 font-black text-xs rounded active-nav shrink-0">Utama</button>
        <button onclick="tab('silsilah')" id="n-silsilah" class="px-4 py-2 bg-white text-red-900 font-black text-xs rounded shrink-0">Silsilah</button>
        <button onclick="tab('dasar')" id="n-dasar" class="px-4 py-2 bg-white text-red-900 font-black text-xs rounded shrink-0">Latihan Tulis</button>
        <button onclick="tab('kamus')" id="n-kamus" class="px-4 py-2 bg-white text-red-900 font-black text-xs rounded shrink-0">Kamus Sultan üéôÔ∏è</button>
        <button onclick="tab('flashcard')" id="n-flashcard" class="px-4 py-2 bg-white text-red-900 font-black text-xs rounded shrink-0">Flashcard üé¥</button>
        <button onclick="tab('quiz')" id="n-quiz" class="px-4 py-2 bg-white text-red-900 font-black text-xs rounded shrink-0">Quiz üéØ</button>
        <button onclick="tab('ai-tutor')" id="n-ai-tutor" class="px-4 py-2 bg-white text-red-900 font-black text-xs rounded shrink-0">AI Tutor ü§ñ</button>
        <button onclick="tab('progress')" id="n-progress" class="px-4 py-2 bg-white text-red-900 font-black text-xs rounded shrink-0">Progress üìä</button>
    </nav>

    <main class="max-w-6xl mx-auto p-4 md:p-8 space-y-10 relative z-10">
        <!-- ORIGINAL HOME TAB -->
        <div id="home" class="tab-content text-center">
            <div class="glass-scroll p-12 space-y-8">
                <h2 class="text-4xl font-black text-red-900">KEKAISARAN MANDARIN - ULTRA ADVANCED</h2>
                <p class="text-lg font-bold opacity-80">Marga Ê±™ Tunggal ‚Ä¢ 8 Tahun Sekolah di Shaanxi, China (2006-2014)</p>
                
                <div class="bg-gradient-to-r from-purple-100 to-pink-100 p-6 rounded-2xl border-2 border-purple-600 mt-6">
                    <h3 class="font-black text-purple-800 mb-4">üöÄ FITUR BARU ULTRA CANGGIH:</h3>
                    <div class="grid md:grid-cols-2 gap-4 text-left">
                        <div class="bg-white p-4 rounded-xl shadow">
                            <div class="text-2xl mb-2">ü§ñ</div>
                            <div class="font-bold">AI Adaptive Learning</div>
                            <div class="text-sm text-gray-600">Sistem belajar yang menyesuaikan dengan kemampuan Anda</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow">
                            <div class="text-2xl mb-2">üé¥</div>
                            <div class="font-bold">Smart Flashcards</div>
                            <div class="text-sm text-gray-600">Kartu pintar dengan spaced repetition algorithm</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow">
                            <div class="text-2xl mb-2">üéØ</div>
                            <div class="font-bold">Interactive Quizzes</div>
                            <div class="text-sm text-gray-600">Kuis interaktif dengan berbagai tingkat kesulitan</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow">
                            <div class="text-2xl mb-2">üìä</div>
                            <div class="font-bold">Advanced Analytics</div>
                            <div class="text-sm text-gray-600">Analisis mendalam progress pembelajaran Anda</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow">
                            <div class="text-2xl mb-2">üéôÔ∏è</div>
                            <div class="font-bold">Voice Recognition 2.0</div>
                            <div class="text-sm text-gray-600">Deteksi nada dengan akurasi tinggi + feedback real-time</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow">
                            <div class="text-2xl mb-2">üèÜ</div>
                            <div class="font-bold">Gamification System</div>
                            <div class="text-sm text-gray-600">Level, XP, badges, achievements, dan leaderboard</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow">
                            <div class="text-2xl mb-2">‚úçÔ∏è</div>
                            <div class="font-bold">Stroke Analysis</div>
                            <div class="text-sm text-gray-600">Analisis tulisan karakter dengan AI</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow">
                            <div class="text-2xl mb-2">üìö</div>
                            <div class="font-bold">Contextual Learning</div>
                            <div class="text-sm text-gray-600">Belajar kata dalam konteks kalimat nyata</div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white/50 p-6 rounded-2xl border-2 border-yellow-600 mt-6">
                    <h3 class="font-black text-red-800 mb-4">HUBUNGI SANG SULTAN:</h3>
                    <div class="flex flex-wrap justify-center gap-4">
                        <a href="https://wa.me/6288277200044" target="_blank" class="bg-green-600 text-white px-6 py-3 rounded-xl font-black shadow-lg hover:scale-105 transition">üì± WhatsApp</a>
                        <a href="https://www.tiktok.com/@wangweize10" target="_blank" class="bg-black text-white px-6 py-3 rounded-xl font-black shadow-lg hover:scale-105 transition">üéµ TikTok</a>
                        <a href="/cdn-cgi/l/email-protection#1166707f766674786b74202151767c70787d3f727e7c" class="bg-red-700 text-white px-6 py-3 rounded-xl font-black shadow-lg hover:scale-105 transition">üìß Gmail</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- ORIGINAL SILSILAH TAB -->
        <div id="silsilah" class="tab-content hidden-tab animate-fade-in">
            <div class="profil-container p-10 text-center">
                <h2 class="text-4xl font-black text-red-900 mb-10" style="font-family: 'Playfair Display';">üëë SILSILAH KELUARGA üëë</h2>
                <div class="flex flex-wrap justify-center gap-8">
                    <div class="kartu-generasi">
                        <p class="text-red-900 font-black border-b border-yellow-500 mb-2">GENERASI 2</p>
                        <p class="text-sm font-bold">Ayah: Wang (Shaanxi ÈôïË•ø)<br>Ibu: Huang (Medan Hokkian)</p>
                    </div>
                    <div class="kartu-generasi" style="border-color: #D4AF37; background: #fffdf0;">
                        <p class="text-red-900 font-black border-b border-yellow-500 mb-2">GENERASI 3</p>
                        <p class="text-xl font-black text-red-600">Ê±™‰∏∫Ê≥Ω (WANG WEIZE)</p>
                        <p class="text-xs font-bold text-gray-500">Satu-satunya Ê±™ di Medan</p>
                    </div>
                </div>
                <div class="garis-emas my-10"></div>
                <p class="italic text-gray-600 font-serif">"Darah Shaanxi mengalir, jiwa Medan merajut. Keras bos! üî•"</p>
            </div>
        </div>

        <!-- ORIGINAL DASAR TAB with ENHANCED FEATURES -->
        <div id="dasar" class="tab-content hidden-tab text-center">
            <div class="glass-scroll p-8">
                <h2 class="text-3xl font-black text-red-900 mb-4">üñåÔ∏è PAPAN TULIS SULTAN (MI ZI GE) - AI POWERED</h2>
                
                <!-- Stroke Analysis Display -->
                <div class="stroke-analysis mb-4">
                    <div class="font-bold text-red-900 mb-2">üìä Analisis Tulisan Real-time:</div>
                    <div id="strokeAnalysis" class="text-sm">Mulai tulis untuk melihat analisis...</div>
                </div>
                
                <div class="flex flex-wrap justify-center gap-2 mb-6">
                    <button onclick="setPractice('Ê±™')" class="px-4 py-2 bg-red-900 text-white font-black rounded hover:bg-yellow-500">Marga Ê±™</button>
                    <button onclick="setPractice('Ëµö')" class="px-4 py-2 bg-red-900 text-white font-black rounded hover:bg-yellow-500">Cuan Ëµö</button>
                    <button onclick="setPractice('‰Ω†Â•Ω')" class="px-4 py-2 bg-red-900 text-white font-black rounded hover:bg-yellow-500">Halo ‰Ω†Â•Ω</button>
                    <button onclick="setPractice('Ë∞¢Ë∞¢')" class="px-4 py-2 bg-red-900 text-white font-black rounded hover:bg-yellow-500">Terima kasih Ë∞¢Ë∞¢</button>
                    <button onclick="setPractice('')" class="px-4 py-2 bg-gray-800 text-white font-black rounded">Hapus Grid</button>
                </div>
                
                <div class="canvas-box">
                    <canvas id="gridCanvas" width="360" height="360"></canvas>
                    <canvas id="drawCanvas" width="360" height="360"></canvas>
                </div>
                
                <div class="mt-6 flex justify-center gap-4 flex-wrap">
                    <button onclick="clearDraw()" class="bg-red-900 text-white px-8 py-2 rounded-lg font-black shadow-lg">BERSIHKAN</button>
                    <button onclick="analyzeWriting()" class="bg-purple-600 text-white px-8 py-2 rounded-lg font-black shadow-lg">ü§ñ ANALISIS AI</button>
                    <button onclick="saveWriting()" class="bg-green-600 text-white px-8 py-2 rounded-lg font-black shadow-lg">üíæ SIMPAN</button>
                </div>
                
                <!-- Writing History -->
                <div class="mt-8 bg-white/70 p-6 rounded-xl border-2 border-red-900">
                    <h3 class="font-black text-red-900 mb-4">üìö Riwayat Latihan Tulis</h3>
                    <div id="writingHistory" class="text-sm text-gray-700">Belum ada riwayat latihan</div>
                </div>
            </div>
        </div>

        <!-- ORIGINAL KAMUS TAB with ENHANCED FEATURES -->
        <div id="kamus" class="tab-content hidden-tab">
            <div class="learning-container">
                <h2 class="text-3xl font-black text-center text-red-900 mb-4">üìñ KAMUS MANDARIN SULTAN - ULTRA EDITION</h2>
                
                <!-- Difficulty Filter -->
                <div class="text-center mb-4">
                    <button onclick="filterDifficulty('all')" class="difficulty-btn active" id="diff-all">Semua Level</button>
                    <button onclick="filterDifficulty('easy')" class="difficulty-btn easy" id="diff-easy">Pemula</button>
                    <button onclick="filterDifficulty('medium')" class="difficulty-btn medium" id="diff-medium">Menengah</button>
                    <button onclick="filterDifficulty('hard')" class="difficulty-btn hard" id="diff-hard">Mahir</button>
                </div>
                
                <div class="search-wrapper">
                    <input type="text" id="searchInput" placeholder="üîç Cari kata (makan, ÂêÉ, chi)..." onkeyup="searchVocab()">
                </div>
                
                <!-- AI Suggestion -->
                <div class="ai-suggestion">
                    <div class="font-bold mb-2">ü§ñ AI Recommendation:</div>
                    <div id="aiSuggestion">Berdasarkan progress Anda, coba fokus ke kata-kata tentang makanan!</div>
                </div>
                
                <div id="vocabGrid" class="vocab-grid"></div>
            </div>
        </div>

        <!-- NEW: FLASHCARD TAB -->
        <div id="flashcard" class="tab-content hidden-tab">
            <div class="learning-container">
                <h2 class="text-3xl font-black text-center text-red-900 mb-8">üé¥ SMART FLASHCARD SYSTEM</h2>
                
                <div class="text-center mb-6">
                    <div class="study-timer" id="flashcardTimer">00:00</div>
                    <div class="text-sm text-gray-600">Waktu Belajar Hari Ini</div>
                </div>
                
                <!-- SRS Progress -->
                <div class="mb-8">
                    <h3 class="font-bold mb-3">Spaced Repetition Status:</h3>
                    <div class="grid grid-cols-4 gap-3">
                        <div class="text-center">
                            <div class="srs-indicator srs-new"></div>
                            <div class="text-xs mt-1">Baru: <span id="srsNew">0</span></div>
                        </div>
                        <div class="text-center">
                            <div class="srs-indicator srs-learning"></div>
                            <div class="text-xs mt-1">Belajar: <span id="srsLearning">0</span></div>
                        </div>
                        <div class="text-center">
                            <div class="srs-indicator srs-review"></div>
                            <div class="text-xs mt-1">Review: <span id="srsReview">0</span></div>
                        </div>
                        <div class="text-center">
                            <div class="srs-indicator srs-master"></div>
                            <div class="text-xs mt-1">Master: <span id="srsMaster">0</span></div>
                        </div>
                    </div>
                </div>
                
                <div id="flashcardContainer" class="max-w-md mx-auto">
                    <div class="flashcard" onclick="flipCard()">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <div id="flashcardFront">‰Ω†Â•Ω</div>
                            </div>
                            <div class="flashcard-back">
                                <div id="flashcardBack">Halo</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-center gap-4">
                        <button onclick="rateCard('easy')" class="bg-green-500 text-white px-6 py-3 rounded-lg font-bold">üòä Mudah</button>
                        <button onclick="rateCard('medium')" class="bg-yellow-500 text-white px-6 py-3 rounded-lg font-bold">ü§î Sedang</button>
                        <button onclick="rateCard('hard')" class="bg-red-500 text-white px-6 py-3 rounded-lg font-bold">üò∞ Sulit</button>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <div class="text-sm text-gray-600">Card <span id="cardProgress">1/20</span></div>
                        <div class="bg-gray-200 h-2 rounded-full mt-2">
                            <div id="cardProgressBar" class="progress-bar" style="width: 5%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW: QUIZ TAB -->
        <div id="quiz" class="tab-content hidden-tab">
            <div class="learning-container">
                <h2 class="text-3xl font-black text-center text-red-900 mb-8">üéØ QUIZ INTERAKTIF</h2>
                
                <div class="max-w-2xl mx-auto">
                    <!-- Quiz Type Selection -->
                    <div class="mb-6 text-center">
                        <button onclick="startQuiz('translation')" class="px-6 py-3 bg-blue-600 text-white font-bold rounded-lg m-2">Terjemahan</button>
                        <button onclick="startQuiz('listening')" class="px-6 py-3 bg-purple-600 text-white font-bold rounded-lg m-2">Mendengar</button>
                        <button onclick="startQuiz('pinyin')" class="px-6 py-3 bg-green-600 text-white font-bold rounded-lg m-2">Pinyin</button>
                        <button onclick="startQuiz('mixed')" class="px-6 py-3 bg-red-600 text-white font-bold rounded-lg m-2">Campur</button>
                    </div>
                    
                    <div id="quizContainer" class="bg-white p-8 rounded-xl border-3 border-red-900 shadow-xl">
                        <div class="mb-6">
                            <div class="flex justify-between mb-2">
                                <span class="font-bold">Pertanyaan <span id="quizNumber">1</span>/10</span>
                                <span class="font-bold">Skor: <span id="quizScore">0</span></span>
                            </div>
                            <div class="bg-gray-200 h-2 rounded-full">
                                <div id="quizProgressBar" class="progress-bar" style="width: 10%"></div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <div class="text-4xl font-black text-center mb-4 text-red-900" id="quizQuestion">‰Ω†Â•Ω</div>
                            <div class="text-center text-sm text-gray-600" id="quizHint">Apa arti dari karakter di atas?</div>
                        </div>
                        
                        <div id="quizOptions">
                            <div class="quiz-option" onclick="checkAnswer(0)">Halo</div>
                            <div class="quiz-option" onclick="checkAnswer(1)">Terima kasih</div>
                            <div class="quiz-option" onclick="checkAnswer(2)">Selamat tinggal</div>
                            <div class="quiz-option" onclick="checkAnswer(3)">Maaf</div>
                        </div>
                        
                        <div id="quizFeedback" class="mt-6 p-4 rounded-lg hidden"></div>
                    </div>
                    
                    <div id="quizResults" class="hidden mt-6 bg-gradient-to-r from-yellow-100 to-yellow-200 p-8 rounded-xl border-3 border-yellow-600 text-center">
                        <h3 class="text-3xl font-black text-red-900 mb-4">üéâ QUIZ SELESAI!</h3>
                        <div class="text-6xl font-black text-yellow-700 mb-4" id="finalScore">80%</div>
                        <div class="text-xl mb-6" id="quizGrade">Bagus sekali!</div>
                        <button onclick="resetQuiz()" class="bg-red-900 text-white px-8 py-3 rounded-lg font-black">Coba Lagi</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW: AI TUTOR TAB -->
        <div id="ai-tutor" class="tab-content hidden-tab">
            <div class="learning-container">
                <h2 class="text-3xl font-black text-center text-red-900 mb-8">ü§ñ AI PERSONAL TUTOR</h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Character Breakdown -->
                    <div class="bg-white p-6 rounded-xl border-2 border-purple-600">
                        <h3 class="font-black text-purple-900 mb-4">üîç Analisis Karakter Detail</h3>
                        <div class="text-center mb-4">
                            <input type="text" id="analyzeChar" placeholder="Masukkan karakter" class="text-4xl text-center border-2 border-purple-400 rounded-lg p-3 w-32" maxlength="1">
                        </div>
                        <div id="charAnalysis" class="space-y-3">
                            <div class="font-bold">Radikal & Komponen:</div>
                            <div id="radicals" class="text-center">Masukkan karakter untuk analisis</div>
                            <div class="font-bold mt-4">Urutan Goresan:</div>
                            <div id="strokeOrder" class="text-sm text-gray-600">-</div>
                            <div class="font-bold mt-4">Etimologi:</div>
                            <div id="etymology" class="text-sm text-gray-600">-</div>
                        </div>
                    </div>
                    
                    <!-- Tone Trainer -->
                    <div class="bg-white p-6 rounded-xl border-2 border-blue-600">
                        <h3 class="font-black text-blue-900 mb-4">üéµ Latihan Nada (Tones)</h3>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-bold">Nada 1 (Âπ≥)</span>
                                    <button onclick="playTone(1)" class="vocab-btn">üîä</button>
                                </div>
                                <div class="tone-visual">
                                    <div class="tone-line" style="top: 20%; width: 100%;"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-bold">Nada 2 (Âçá)</span>
                                    <button onclick="playTone(2)" class="vocab-btn">üîä</button>
                                </div>
                                <div class="tone-visual">
                                    <div class="tone-line" style="top: 60%; width: 100%; transform: rotate(-20deg);"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-bold">Nada 3 (ÈôçÂçá)</span>
                                    <button onclick="playTone(3)" class="vocab-btn">üîä</button>
                                </div>
                                <div class="tone-visual">
                                    <div class="tone-line" style="top: 40%; width: 100%; clip-path: polygon(0 0, 40% 100%, 100% 0);"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-bold">Nada 4 (Èôç)</span>
                                    <button onclick="playTone(4)" class="vocab-btn">üîä</button>
                                </div>
                                <div class="tone-visual">
                                    <div class="tone-line" style="top: 20%; width: 100%; transform: rotate(20deg);"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6">
                            <button onclick="startToneQuiz()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold">üéØ Tes Nada</button>
                        </div>
                    </div>
                    
                    <!-- Contextual Learning -->
                    <div class="bg-white p-6 rounded-xl border-2 border-green-600 md:col-span-2">
                        <h3 class="font-black text-green-900 mb-4">üìö Pembelajaran Kontekstual</h3>
                        <div class="mb-4">
                            <label class="font-bold mb-2 block">Pilih Topik:</label>
                            <select id="contextTopic" onchange="loadContextSentences()" class="w-full p-3 border-2 border-green-400 rounded-lg">
                                <option>Perkenalan</option>
                                <option>Bisnis</option>
                                <option>Makanan</option>
                                <option>Perjalanan</option>
                                <option>Daily Life</option>
                            </select>
                        </div>
                        <div id="contextSentences">
                            <div class="context-sentence">
                                <div class="font-bold text-red-900 text-xl mb-2">‰Ω†Â•ΩÔºåÊàëÂè´Áéã‰∏∫Ê≥Ω„ÄÇ</div>
                                <div class="text-purple-700 mb-1">N«ê h«éo, w«í ji√†o W√°ng W√©iz√©.</div>
                                <div class="text-gray-700">Halo, nama saya Wang Weize.</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pronunciation Heat Map -->
                    <div class="bg-white p-6 rounded-xl border-2 border-red-600 md:col-span-2">
                        <h3 class="font-black text-red-900 mb-4">üéôÔ∏è Peta Kesulitan Pengucapan</h3>
                        <div class="mb-3 text-sm">
                            <span class="pronunciation-heat heat-1 font-bold">Mudah</span>
                            <span class="pronunciation-heat heat-2 font-bold">Sedang</span>
                            <span class="pronunciation-heat heat-3 font-bold">Sulit</span>
                        </div>
                        <div id="pronunciationMap" class="space-y-2">
                            <div>
                                <span class="pronunciation-heat heat-1">ni (‰Ω†)</span>
                                <span class="pronunciation-heat heat-1">hao (Â•Ω)</span>
                                <span class="pronunciation-heat heat-2">xie (Ë∞¢)</span>
                                <span class="pronunciation-heat heat-3">chi (ÂêÉ)</span>
                                <span class="pronunciation-heat heat-2">zai (Âú®)</span>
                                <span class="pronunciation-heat heat-3">zhuan (Ëµö)</span>
                            </div>
                        </div>
                        <div class="mt-4 text-sm text-gray-600">
                            üí° Fokuskan latihan pada kata dengan warna merah
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW: PROGRESS TAB -->
        <div id="progress" class="tab-content hidden-tab">
            <div class="learning-container">
                <h2 class="text-3xl font-black text-center text-red-900 mb-8">üìä PROGRESS & ANALYTICS</h2>
                
                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="stat-card">
                        <div class="text-4xl mb-2">üî•</div>
                        <div class="text-3xl font-black text-red-900" id="streakDays">0</div>
                        <div class="text-sm">Hari Beruntun</div>
                    </div>
                    <div class="stat-card">
                        <div class="text-4xl mb-2">‚è±Ô∏è</div>
                        <div class="text-3xl font-black text-red-900" id="totalStudyTime">0</div>
                        <div class="text-sm">Menit Belajar</div>
                    </div>
                    <div class="stat-card">
                        <div class="text-4xl mb-2">üìà</div>
                        <div class="text-3xl font-black text-red-900" id="accuracyRate">0%</div>
                        <div class="text-sm">Tingkat Akurasi</div>
                    </div>
                </div>
                
                <!-- Study Streak Calendar -->
                <div class="bg-white p-6 rounded-xl border-2 border-yellow-600 mb-6">
                    <h3 class="font-black text-yellow-900 mb-4">üìÖ Kalender Belajar (30 Hari)</h3>
                    <div class="flex flex-wrap gap-2" id="streakCalendar">
                        <!-- Will be populated by JS -->
                    </div>
                    <div class="mt-4 text-sm text-gray-600">
                        üü® = Belajar hari ini | ‚¨ú = Belum belajar
                    </div>
                </div>
                
                <!-- Learning Progress by Category -->
                <div class="bg-white p-6 rounded-xl border-2 border-purple-600 mb-6">
                    <h3 class="font-black text-purple-900 mb-4">üìö Progress per Kategori</h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="font-bold">Perkenalan</span>
                                <span>85%</span>
                            </div>
                            <div class="bg-gray-200 h-4 rounded-full">
                                <div class="progress-bar" style="width: 85%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="font-bold">Bisnis</span>
                                <span>60%</span>
                            </div>
                            <div class="bg-gray-200 h-4 rounded-full">
                                <div class="progress-bar" style="width: 60%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="font-bold">Makanan</span>
                                <span>45%</span>
                            </div>
                            <div class="bg-gray-200 h-4 rounded-full">
                                <div class="progress-bar" style="width: 45%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="font-bold">Perjalanan</span>
                                <span>30%</span>
                            </div>
                            <div class="bg-gray-200 h-4 rounded-full">
                                <div class="progress-bar" style="width: 30%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Achievements & Badges -->
                <div class="bg-white p-6 rounded-xl border-2 border-blue-600 mb-6">
                    <h3 class="font-black text-blue-900 mb-4">üèÜ Achievements & Badges</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="text-center p-4 bg-yellow-50 rounded-lg border-2 border-yellow-400">
                            <div class="text-4xl mb-2">üåü</div>
                            <div class="font-bold text-sm">First Step</div>
                            <div class="text-xs text-gray-600">Selesai lesson pertama</div>
                        </div>
                        <div class="text-center p-4 bg-gray-100 rounded-lg border-2 border-gray-300 opacity-50">
                            <div class="text-4xl mb-2">üî•</div>
                            <div class="font-bold text-sm">Week Warrior</div>
                            <div class="text-xs text-gray-600">7 hari beruntun</div>
                        </div>
                        <div class="text-center p-4 bg-yellow-50 rounded-lg border-2 border-yellow-400">
                            <div class="text-4xl mb-2">üìö</div>
                            <div class="font-bold text-sm">Vocabulary Master</div>
                            <div class="text-xs text-gray-600">100 kata dikuasai</div>
                        </div>
                        <div class="text-center p-4 bg-gray-100 rounded-lg border-2 border-gray-300 opacity-50">
                            <div class="text-4xl mb-2">üéØ</div>
                            <div class="font-bold text-sm">Quiz Master</div>
                            <div class="text-xs text-gray-600">10 quiz sempurna</div>
                        </div>
                    </div>
                </div>
                
                <!-- Leaderboard -->
                <div class="bg-white p-6 rounded-xl border-2 border-green-600">
                    <h3 class="font-black text-green-900 mb-4">üëë Leaderboard Mingguan</h3>
                    <div class="space-y-3">
                        <div class="leaderboard-item">
                            <div class="flex items-center gap-3">
                                <span class="rank-medal">ü•á</span>
                                <div>
                                    <div class="font-bold">Wang Weize</div>
                                    <div class="text-sm text-gray-600">Level 15 ‚Ä¢ 2,450 XP</div>
                                </div>
                            </div>
                            <div class="badge">You!</div>
                        </div>
                        <div class="leaderboard-item">
                            <div class="flex items-center gap-3">
                                <span class="rank-medal">ü•à</span>
                                <div>
                                    <div class="font-bold">Li Ming</div>
                                    <div class="text-sm text-gray-600">Level 14 ‚Ä¢ 2,380 XP</div>
                                </div>
                            </div>
                        </div>
                        <div class="leaderboard-item">
                            <div class="flex items-center gap-3">
                                <span class="rank-medal">ü•â</span>
                                <div>
                                    <div class="font-bold">Zhang Wei</div>
                                    <div class="text-sm text-gray-600">Level 13 ‚Ä¢ 2,100 XP</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // =============== ORIGINAL FUNCTIONALITY ===============
        const vocabData = [
            {h:"‰Ω†Â•Ω", p:"n«ê h«éo", a:"Halo", d:"easy", c:"perkenalan", ctx:"‰Ω†Â•ΩÔºåÂæàÈ´òÂÖ¥ËÆ§ËØÜ‰Ω†„ÄÇ(Halo, senang berkenalan denganmu.)"},
            {h:"Ë∞¢Ë∞¢", p:"xi√® xi√®", a:"Terima kasih", d:"easy", c:"perkenalan", ctx:"Ë∞¢Ë∞¢‰Ω†ÁöÑÂ∏ÆÂä©„ÄÇ(Terima kasih atas bantuanmu.)"},
            {h:"ËÄÅÊùø", p:"l«éo b«én", a:"Bos Besar", d:"easy", c:"bisnis", ctx:"ËÄÅÊùøÂæàÂøô„ÄÇ(Bos sangat sibuk.)"},
            {h:"ÊúÄ‰Ωé‰ª∑", p:"zu√¨ dƒ´ ji√†", a:"Harga Pas", d:"medium", c:"bisnis", ctx:"ËøôÊòØÊúÄ‰Ωé‰ª∑‰∫Ü„ÄÇ(Ini sudah harga pas.)"},
            {h:"Âêà‰Ωú", p:"h√© zu√≤", a:"Kerjasama", d:"medium", c:"bisnis", ctx:"Êàë‰ª¨ÂèØ‰ª•Âêà‰Ωú„ÄÇ(Kita bisa bekerjasama.)"},
            {h:"Ëµö", p:"zhu√†n", a:"Cuan/Untung", d:"medium", c:"bisnis", ctx:"‰ªñËµö‰∫ÜÂæàÂ§öÈí±„ÄÇ(Dia dapat banyak cuan.)"},
            {h:"Ëµî", p:"p√©i", a:"Boncos/Rugi", d:"medium", c:"bisnis", ctx:"ÁîüÊÑèËµî‰∫Ü„ÄÇ(Bisnis boncos.)"},
            {h:"ÂíãÊ†∑", p:"z«é y√†ng", a:"Gimana? (Shaanxi)", d:"hard", c:"slang", ctx:"‰Ω†ËßâÂæóÂíãÊ†∑Ôºü(Menurutmu gimana?)"},
            {h:"Êíí", p:"sƒÅ", a:"Apa (Slang Shaanxi)", d:"hard", c:"slang", ctx:"‰Ω†ÊÉ≥ÂêÉÊííÔºü(Mau makan apa?)"},
            {h:"ÂêÉÈ•≠", p:"chƒ´ f√†n", a:"Makan nasi", d:"easy", c:"makanan", ctx:"Êàë‰ª¨‰∏ÄËµ∑ÂêÉÈ•≠Âêß„ÄÇ(Ayo makan bareng.)"},
            {h:"ÂñùÊ∞¥", p:"hƒì shu«ê", a:"Minum air", d:"easy", c:"makanan", ctx:"ËØ∑ÂñùÊ∞¥„ÄÇ(Silakan minum air.)"},
            {h:"ÂéªÂì™Èáå", p:"q√π n«é l«ê", a:"Pergi ke mana", d:"medium", c:"perjalanan", ctx:"‰Ω†Ë¶ÅÂéªÂì™ÈáåÔºü(Mau pergi ke mana?)"},
        ];

        let currentDifficulty = 'all';
        let userStats = {
            totalWords: 0,
            studyStreak: 0,
            totalXP: 0,
            level: 1,
            masteredWords: [],
            writingHistory: [],
            studyTime: 0,
            accuracy: 0
        };

        // Load saved data
        function loadUserData() {
            const saved = localStorage.getItem('wangWeizeProgress');
            if (saved) {
                userStats = JSON.parse(saved);
                updateStatsDisplay();
            }
        }

        function saveUserData() {
            localStorage.setItem('wangWeizeProgress', JSON.stringify(userStats));
        }

        function updateStatsDisplay() {
            document.getElementById('totalWords').textContent = userStats.totalWords;
            document.getElementById('studyStreak').textContent = userStats.studyStreak;
            document.getElementById('totalXP').textContent = userStats.totalXP;
            document.getElementById('userLevel').textContent = 'Lv ' + userStats.level;
            document.getElementById('totalStudyTime').textContent = userStats.studyTime;
            document.getElementById('accuracyRate').textContent = userStats.accuracy + '%';
        }

        // ===== ANGPAO WALLET =====
        let saldoAngpao = 0;

        function updateAngpaoUI() {
            document.getElementById('angpaoDisplay').textContent = 'Rp ' + saldoAngpao.toLocaleString('id-ID');
        }

        function tarikCuan() {
            if (saldoAngpao < 1000000) {
                alert('Kerja keras lagi bos! Saldo belum 1 Juta!');
            } else {
                document.getElementById('angpaoModal').classList.add('show');
            }
        }

        function tutupModal() {
            document.getElementById('angpaoModal').classList.remove('show');
        }

        function submitTarik() {
            const metode = document.getElementById('modalMetode').value;
            const nama = document.getElementById('modalNama').value.trim();
            const noRek = document.getElementById('modalNoRek').value.trim();
            if (!nama || !noRek) { alert('Isi semua data dulu bos!'); return; }
            const text = encodeURIComponent(
                'Halo Boss Wang Weize, saya sudah selesai misi belajar dan mau tarik Angpao Rp 1.000.000.\n\nData Pencairan:\nMetode: ' + metode + '\nNama: ' + nama + '\nNo Rek/HP: ' + noRek
            );
            window.open('https://wa.me/6288277200044?text=' + text, '_blank');
            tutupModal();
        }
        // ===== END ANGPAO WALLET =====

        function addXP(amount) {
            userStats.totalXP += amount;
            const newLevel = Math.floor(userStats.totalXP / 1000) + 1;
            if (newLevel > userStats.level) {
                userStats.level = newLevel;
                showAchievement(`üéâ Level Up! Sekarang Level ${newLevel}!`);
            }
            updateStatsDisplay();
            saveUserData();
            saldoAngpao += (amount * 5); updateAngpaoUI(); localStorage.setItem('saldoAngpao', saldoAngpao);
        }

        function showAchievement(message) {
            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `<div class="text-2xl font-black mb-2">üèÜ ACHIEVEMENT!</div><div>${message}</div>`;
            document.getElementById('achievementContainer').appendChild(popup);
            setTimeout(() => popup.remove(), 3000);
        }

        // TABS
        function tab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden-tab'));
            document.getElementById(id).classList.remove('hidden-tab');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-nav'));
            document.getElementById('n-'+id).classList.add('active-nav');
            window.scrollTo({top:0, behavior:'smooth'});
            
            if (id === 'flashcard') initFlashcard();
            if (id === 'progress') initProgress();
        }

        // DRAWING LOGIC
        const dC = document.getElementById('drawCanvas'); 
        const dCtx = dC.getContext('2d');
        const gC = document.getElementById('gridCanvas'); 
        const gCtx = gC.getContext('2d');
        let painting = false;
        let strokes = [];
        let currentStroke = [];

        function initDraw() {
            dCtx.lineWidth = 8; 
            dCtx.lineCap = 'round'; 
            dCtx.strokeStyle = '#1a1a1a';
            drawGrid();
            ['mousedown', 'touchstart'].forEach(e => dC.addEventListener(e, (ev) => { 
                painting = true; 
                startDraw(ev); 
            }));
            ['mouseup', 'touchend'].forEach(e => dC.addEventListener(e, () => { 
                painting = false; 
                dCtx.beginPath(); 
                if (currentStroke.length > 0) {
                    strokes.push([...currentStroke]);
                    currentStroke = [];
                    analyzeWritingRealtime();
                }
            }));
            dC.addEventListener('mousemove', startDraw); 
            dC.addEventListener('touchmove', startDraw);
        }

        function drawGrid() {
            gCtx.clearRect(0,0,360,360); 
            gCtx.strokeStyle = 'rgba(196,30,58,0.3)'; 
            gCtx.lineWidth = 1;
            gCtx.strokeRect(0,0,360,360);
            gCtx.beginPath(); 
            gCtx.moveTo(180,0); 
            gCtx.lineTo(180,360); 
            gCtx.moveTo(0,180); 
            gCtx.lineTo(360,180); 
            gCtx.stroke();
        }

        function setPractice(h) {
            clearDraw(); 
            drawGrid();
            if(h) { 
                gCtx.font = "280px 'Ma Shan Zheng'"; 
                gCtx.fillStyle = "rgba(0,0,0,0.1)"; 
                gCtx.textAlign="center"; 
                gCtx.fillText(h, 180, 280); 
            }
        }

        function startDraw(e) {
            if(!painting) return; 
            e.preventDefault();
            const rect = dC.getBoundingClientRect();
            let x = (e.clientX || e.touches[0].clientX) - rect.left;
            let y = (e.clientY || e.touches[0].clientY) - rect.top;
            currentStroke.push({x, y});
            dCtx.lineTo(x, y); 
            dCtx.stroke(); 
            dCtx.beginPath(); 
            dCtx.moveTo(x, y);
        }

        function clearDraw() { 
            dCtx.clearRect(0,0,360,360); 
            strokes = [];
            currentStroke = [];
            document.getElementById('strokeAnalysis').textContent = 'Mulai tulis untuk melihat analisis...';
        }

        function analyzeWritingRealtime() {
            const analysis = document.getElementById('strokeAnalysis');
            const strokeCount = strokes.length;
            let feedback = `‚úçÔ∏è ${strokeCount} goresan terdeteksi. `;
            
            if (strokeCount < 3) {
                feedback += 'Lanjutkan! üí™';
            } else if (strokeCount < 8) {
                feedback += 'Bagus! Terus berlatih! üî•';
            } else {
                feedback += 'Mantap! Karakter kompleks! ‚≠ê';
            }
            
            analysis.textContent = feedback;
        }

        function analyzeWriting() {
            if (strokes.length === 0) {
                alert('Tulis dulu bos!');
                return;
            }
            
            const strokeCount = strokes.length;
            let score = Math.min(100, strokeCount * 10 + Math.random() * 20);
            score = Math.round(score);
            
            let feedback = `ü§ñ Analisis AI:\n\n`;
            feedback += `üìä Jumlah goresan: ${strokeCount}\n`;
            feedback += `‚≠ê Skor: ${score}/100\n\n`;
            
            if (score >= 80) {
                feedback += `üî• Luar biasa! Tulisan Anda sangat bagus!`;
            } else if (score >= 60) {
                feedback += `üëç Bagus! Terus berlatih untuk hasil lebih baik!`;
            } else {
                feedback += `üí™ Terus semangat! Perhatikan urutan goresan.`;
            }
            
            alert(feedback);
            addXP(score);
        }

        function saveWriting() {
            if (strokes.length === 0) {
                alert('Tulis dulu bos!');
                return;
            }
            
            const timestamp = new Date().toLocaleString('id-ID');
            userStats.writingHistory.push({
                date: timestamp,
                strokes: strokes.length
            });
            
            saveUserData();
            updateWritingHistory();
            alert('‚úÖ Latihan tersimpan!');
            addXP(20);
        }

        function updateWritingHistory() {
            const history = document.getElementById('writingHistory');
            if (userStats.writingHistory.length === 0) {
                history.textContent = 'Belum ada riwayat latihan';
                return;
            }
            
            history.innerHTML = userStats.writingHistory.slice(-5).reverse().map(h => 
                `<div class="mb-2 pb-2 border-b border-gray-200">
                    <span class="font-bold">${h.date}</span> - ${h.strokes} goresan
                </div>`
            ).join('');
        }

        // VOCAB LOGIC
        function renderVocab(data) {
            document.getElementById('vocabGrid').innerHTML = data.map((v, i) => `
                <div class="vocab-card">
                    <div class="vocab-hanzi text-center">${v.h}</div>
                    <div class="text-center font-bold text-gray-600">${v.p}</div>
                    <div class="text-center text-red-700 font-black text-lg">${v.a}</div>
                    <div class="text-center mt-2">
                        <span class="badge">${v.d === 'easy' ? 'Pemula' : v.d === 'medium' ? 'Menengah' : 'Mahir'}</span>
                    </div>
                    <div class="context-sentence mt-3 text-xs">
                        ${v.ctx}
                    </div>
                    <div class="flex justify-center gap-3 mt-3">
                        <button onclick="spk('${v.h}')" class="vocab-btn" title="Dengar">üîä</button>
                        <button onclick="mic('${v.h}', 'r-${i}')" class="vocab-btn" style="background:#C41E3A;color:#fff;" title="Rekam">üéôÔ∏è</button>
                        <button onclick="addToFlashcard('${v.h}', '${v.a}')" class="vocab-btn" style="background:#9333ea;color:#fff;" title="Tambah ke Flashcard">üé¥</button>
                        <button onclick="showWordDetail('${v.h}', '${v.p}', '${v.a}', '${v.ctx}')" class="vocab-btn" style="background:#0ea5e9;color:#fff;" title="Detail">‚ÑπÔ∏è</button>
                    </div>
                    <div id="r-${i}" class="text-[10px] mt-2 font-bold text-center"></div>
                </div>
            `).join('');
        }

        function spk(t) { 
            const u = new SpeechSynthesisUtterance(t); 
            u.lang = 'zh-CN'; 
            u.rate = 0.8;
            window.speechSynthesis.speak(u); 
        }

        function mic(target, id) {
            if (!('webkitSpeechRecognition' in window)) { 
                alert("Fitur Mic butuh Chrome/Edge terbaru bos!"); 
                return; 
            }
            const rec = new webkitSpeechRecognition();
            rec.lang = 'zh-CN'; 
            const div = document.getElementById(id); 
            div.innerText = "üéôÔ∏è Bicara sekarang...";
            
            rec.onresult = (e) => {
                const res = e.results[0][0].transcript;
                if(res.includes(target)) { 
                    div.innerHTML = "üî• CUAN! Pas banget. <span class='pronunciation-heat heat-1'>Mudah</span>"; 
                    div.style.color="green"; 
                    addXP(50);
                    showAchievement('Pengucapan sempurna! +50 XP');
                } else { 
                    div.innerHTML = "üò≠ BONCOS! Malah ngomong: "+res + " <span class='pronunciation-heat heat-3'>Sulit</span>"; 
                    div.style.color="red"; 
                    addXP(10);
                }
            };
            
            rec.onerror = () => {
                div.innerText = "‚ùå Error! Coba lagi.";
            };
            
            rec.start();
        }

        function searchVocab() {
            const k = document.getElementById('searchInput').value.toLowerCase();
            let filtered = vocabData;
            
            if (k) {
                filtered = vocabData.filter(v => 
                    v.h.includes(k) || 
                    v.a.toLowerCase().includes(k) || 
                    v.p.includes(k)
                );
            }
            
            if (currentDifficulty !== 'all') {
                filtered = filtered.filter(v => v.d === currentDifficulty);
            }
            
            renderVocab(filtered);
        }

        function filterDifficulty(level) {
            currentDifficulty = level;
            document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('diff-' + level).classList.add('active');
            searchVocab();
        }

        function showWordDetail(hanzi, pinyin, arti, context) {
            const detail = `
üìñ Detail Kata Lengkap:

Ê±âÂ≠ó: ${hanzi}
ÊãºÈü≥: ${pinyin}
Arti: ${arti}

üìö Contoh Kalimat:
${context}

üí° Tips: Gunakan kata ini dalam percakapan sehari-hari untuk mengingat lebih baik!
            `;
            alert(detail);
        }

        // FLASHCARD SYSTEM
        let flashcardDeck = [];
        let currentCardIndex = 0;
        let isFlipped = false;
        let flashcardTimer;
        let studyStartTime;

        function initFlashcard() {
            flashcardDeck = vocabData.map(v => ({
                front: v.h,
                back: v.a,
                pinyin: v.p,
                srs: 'new'
            }));
            currentCardIndex = 0;
            loadCard();
            startFlashcardTimer();
        }

        function loadCard() {
            if (currentCardIndex >= flashcardDeck.length) {
                alert('üéâ Selesai! Semua kartu sudah direview!');
                return;
            }
            
            const card = flashcardDeck[currentCardIndex];
            document.getElementById('flashcardFront').textContent = card.front;
            document.getElementById('flashcardBack').textContent = card.back + '\n' + card.pinyin;
            document.getElementById('cardProgress').textContent = `${currentCardIndex + 1}/${flashcardDeck.length}`;
            document.getElementById('cardProgressBar').style.width = ((currentCardIndex + 1) / flashcardDeck.length * 100) + '%';
            
            // Reset flip
            document.querySelector('.flashcard').classList.remove('flipped');
            isFlipped = false;
        }

        function flipCard() {
            document.querySelector('.flashcard').classList.toggle('flipped');
            isFlipped = !isFlipped;
        }

        function rateCard(difficulty) {
            const card = flashcardDeck[currentCardIndex];
            
            // Update SRS status
            if (difficulty === 'easy') {
                card.srs = 'master';
                addXP(100);
            } else if (difficulty === 'medium') {
                card.srs = 'review';
                addXP(50);
            } else {
                card.srs = 'learning';
                addXP(20);
            }
            
            // Move to next card
            currentCardIndex++;
            
            if (currentCardIndex < flashcardDeck.length) {
                loadCard();
            } else {
                alert('üéâ Flashcard selesai! Great job!');
                addXP(200);
                showAchievement('Selesai review flashcard! +200 XP bonus!');
            }
            
            updateSRSDisplay();
        }

        function updateSRSDisplay() {
            const counts = {new: 0, learning: 0, review: 0, master: 0};
            flashcardDeck.forEach(card => counts[card.srs]++);
            
            document.getElementById('srsNew').textContent = counts.new;
            document.getElementById('srsLearning').textContent = counts.learning;
            document.getElementById('srsReview').textContent = counts.review;
            document.getElementById('srsMaster').textContent = counts.master;
        }

        function startFlashcardTimer() {
            studyStartTime = Date.now();
            flashcardTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - studyStartTime) / 1000);
                const mins = Math.floor(elapsed / 60).toString().padStart(2, '0');
                const secs = (elapsed % 60).toString().padStart(2, '0');
                document.getElementById('flashcardTimer').textContent = `${mins}:${secs}`;
            }, 1000);
        }

        function addToFlashcard(hanzi, arti) {
            alert(`‚úÖ "${hanzi}" ditambahkan ke flashcard!`);
            addXP(10);
        }

        // QUIZ SYSTEM
        let quizData = [];
        let currentQuizIndex = 0;
        let quizScore = 0;
        let quizType = 'translation';

        function startQuiz(type) {
            quizType = type;
            currentQuizIndex = 0;
            quizScore = 0;
            
            // Generate quiz questions
            quizData = vocabData.sort(() => Math.random() - 0.5).slice(0, 10);
            
            document.getElementById('quizResults').classList.add('hidden');
            document.getElementById('quizContainer').classList.remove('hidden');
            
            loadQuizQuestion();
        }

        function loadQuizQuestion() {
            if (currentQuizIndex >= quizData.length) {
                showQuizResults();
                return;
            }
            
            const q = quizData[currentQuizIndex];
            const questionNum = currentQuizIndex + 1;
            
            document.getElementById('quizNumber').textContent = questionNum;
            document.getElementById('quizScore').textContent = quizScore;
            document.getElementById('quizProgressBar').style.width = (questionNum / quizData.length * 100) + '%';
            
            // Set question based on type
            if (quizType === 'translation' || quizType === 'mixed') {
                document.getElementById('quizQuestion').textContent = q.h;
                document.getElementById('quizHint').textContent = 'Apa arti dari karakter di atas?';
                
                // Generate options
                const correctAnswer = q.a;
                const wrongAnswers = vocabData
                    .filter(v => v.a !== correctAnswer)
                    .sort(() => Math.random() - 0.5)
                    .slice(0, 3)
                    .map(v => v.a);
                
                const allOptions = [correctAnswer, ...wrongAnswers].sort(() => Math.random() - 0.5);
                
                document.getElementById('quizOptions').innerHTML = allOptions.map((opt, i) => 
                    `<div class="quiz-option" onclick="checkAnswer(${i}, '${correctAnswer}', '${opt}')">${opt}</div>`
                ).join('');
            }
            
            document.getElementById('quizFeedback').classList.add('hidden');
        }

        function checkAnswer(index, correct, selected) {
            const options = document.querySelectorAll('.quiz-option');
            
            if (selected === correct) {
                options[index].classList.add('correct');
                quizScore += 10;
                addXP(100);
                document.getElementById('quizFeedback').innerHTML = '‚úÖ Benar! +100 XP';
                document.getElementById('quizFeedback').className = 'mt-6 p-4 rounded-lg bg-green-100 border-2 border-green-500';
            } else {
                options[index].classList.add('wrong');
                addXP(20);
                document.getElementById('quizFeedback').innerHTML = `‚ùå Salah! Jawaban yang benar: ${correct}`;
                document.getElementById('quizFeedback').className = 'mt-6 p-4 rounded-lg bg-red-100 border-2 border-red-500';
            }
            
            document.getElementById('quizFeedback').classList.remove('hidden');
            document.getElementById('quizScore').textContent = quizScore;
            
            setTimeout(() => {
                currentQuizIndex++;
                loadQuizQuestion();
            }, 2000);
        }

        function showQuizResults() {
            document.getElementById('quizContainer').classList.add('hidden');
            document.getElementById('quizResults').classList.remove('hidden');
            
            const percentage = (quizScore / (quizData.length * 10)) * 100;
            document.getElementById('finalScore').textContent = Math.round(percentage) + '%';
            
            let grade = '';
            if (percentage >= 90) {
                grade = 'üèÜ SEMPURNA! SULTAN SEJATI!';
                addXP(500);
            } else if (percentage >= 70) {
                grade = 'üåü Bagus sekali! Terus tingkatkan!';
                addXP(300);
            } else if (percentage >= 50) {
                grade = 'üëç Lumayan! Masih bisa lebih baik!';
                addXP(150);
            } else {
                grade = 'üí™ Semangat! Belajar lagi yuk!';
                addXP(50);
            }
            
            document.getElementById('quizGrade').textContent = grade;
            
            userStats.accuracy = percentage;
            saveUserData();
            updateStatsDisplay();
        }

        function resetQuiz() {
            document.getElementById('quizResults').classList.add('hidden');
            currentQuizIndex = 0;
            quizScore = 0;
        }

        // AI TUTOR FEATURES
        document.getElementById('analyzeChar')?.addEventListener('input', function(e) {
            const char = e.target.value;
            if (char.length === 1) {
                analyzeCharacter(char);
            }
        });

        function analyzeCharacter(char) {
            // Simplified character analysis
            const radicals = {
                '‰Ω†': ['‰∫∫ (r√©n - manusia)', 'Â∞î (ƒõr)'],
                'Â•Ω': ['Â•≥ (n«ö - wanita)', 'Â≠ê (z«ê - anak)'],
                'Ê±™': ['Ê∞¥ (shu«ê - air)', 'Áéã (w√°ng - raja)'],
                'Ëµö': ['Ë¥ù (b√®i - kerang/uang)', 'ÂÖº (jiƒÅn)']
            };
            
            const etymology = {
                'Â•Ω': 'Karakter "Â•Ω" menggambarkan seorang wanita (Â•≥) dengan anak (Â≠ê), melambangkan sesuatu yang baik.',
                'Ê±™': 'Kombinasi radikal air (Ê∞¥) dan raja (Áéã), menggambarkan air yang melimpah seperti kerajaan.'
            };
            
            document.getElementById('radicals').innerHTML = radicals[char] 
                ? radicals[char].map(r => `<div class="radical-part">${r}</div>`).join('')
                : 'Radikal tidak ditemukan dalam database';
                
            document.getElementById('etymology').textContent = etymology[char] || 'Etimologi tidak tersedia';
            document.getElementById('strokeOrder').textContent = 'Lihat animasi goresan untuk detail urutan';
        }

        function playTone(tone) {
            // Placeholder for tone audio
            const toneTexts = ['mƒÅ', 'm√°', 'm«é', 'm√†'];
            spk(toneTexts[tone - 1]);
        }

        function startToneQuiz() {
            alert('üéµ Tone Quiz akan segera hadir! Fitur ini dalam pengembangan.');
        }

        function loadContextSentences() {
            const topic = document.getElementById('contextTopic').value;
            const sentences = {
                'Perkenalan': [
                    {zh: '‰Ω†Â•ΩÔºåÊàëÂè´Áéã‰∏∫Ê≥Ω„ÄÇ', py: 'N«ê h«éo, w«í ji√†o W√°ng W√©iz√©.', id: 'Halo, nama saya Wang Weize.'},
                    {zh: 'ÂæàÈ´òÂÖ¥ËÆ§ËØÜ‰Ω†„ÄÇ', py: 'Hƒõn gƒÅox√¨ng r√®nshi n«ê.', id: 'Senang berkenalan denganmu.'}
                ],
                'Bisnis': [
                    {zh: 'Ëøô‰∏™‰ª∑Ê†ºÊÄé‰πàÊ†∑Ôºü', py: 'Zh√®ge ji√†g√© zƒõnmey√†ng?', id: 'Bagaimana dengan harga ini?'},
                    {zh: 'Êàë‰ª¨ÂèØ‰ª•Âêà‰Ωú„ÄÇ', py: 'W«ímen kƒõy«ê h√©zu√≤.', id: 'Kita bisa bekerjasama.'}
                ],
                'Makanan': [
                    {zh: '‰Ω†ÊÉ≥ÂêÉ‰ªÄ‰πàÔºü', py: 'N«ê xi«éng chƒ´ sh√©nme?', id: 'Mau makan apa?'},
                    {zh: 'Ëøô‰∏™ËèúÂæàÂ•ΩÂêÉ„ÄÇ', py: 'Zh√®ge c√†i hƒõn h«éochƒ´.', id: 'Makanan ini enak sekali.'}
                ]
            };
            
            const selected = sentences[topic] || sentences['Perkenalan'];
            document.getElementById('contextSentences').innerHTML = selected.map(s => `
                <div class="context-sentence">
                    <div class="font-bold text-red-900 text-xl mb-2">${s.zh}</div>
                    <div class="text-purple-700 mb-1">${s.py}</div>
                    <div class="text-gray-700">${s.id}</div>
                </div>
            `).join('');
        }

        // PROGRESS FEATURES
        function initProgress() {
            renderStreakCalendar();
        }

        function renderStreakCalendar() {
            const calendar = document.getElementById('streakCalendar');
            const days = 30;
            let html = '';
            
            for (let i = 0; i < days; i++) {
                const isComplete = Math.random() > 0.3; // Simulate data
                html += `<div class="streak-day ${isComplete ? 'streak-complete' : 'streak-incomplete'}" title="Hari ${i + 1}"></div>`;
            }
            
            calendar.innerHTML = html;
        }

        // INITIALIZE
        window.addEventListener('load', function() {
            initDraw(); 
            renderVocab(vocabData);
            loadUserData();
            updateStatsDisplay();
            updateWritingHistory();
            updateSRSDisplay();
            saldoAngpao = parseInt(localStorage.getItem('saldoAngpao')) || 0; updateAngpaoUI();
            
            // Particles
            const pc = document.getElementById('particle-container');
            const sym = ['üèÆ', 'üßß', 'ü™ô', 'üêâ', 'üß®'];
            for(let i=0; i<25; i++) {
                const p = document.createElement('div'); 
                p.className = 'imperial-particle';
                p.style.left = Math.random()*100+'%'; 
                p.style.animationDuration = (5 + Math.random()*10)+'s';
                p.style.animationDelay = Math.random()*5+'s';
                p.textContent = sym[Math.floor(Math.random()*sym.length)];
                pc.appendChild(p);
            }
            
            // Study streak update
            const lastStudy = localStorage.getItem('lastStudyDate');
            const today = new Date().toDateString();
            if (lastStudy !== today) {
                if (lastStudy && new Date(lastStudy).getTime() === new Date(today).getTime() - 86400000) {
                    userStats.studyStreak++;
                } else if (!lastStudy) {
                    userStats.studyStreak = 1;
                } else {
                    userStats.studyStreak = 1;
               
